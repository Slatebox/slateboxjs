import t from"lodash.uniq";import e from"deepmerge";import o from"lodash.omit";import s from"lodash.invoke";import i from"static-kdtree";import n from"lodash.throttle";import r from"lodash.clone";import l from"lodash.clonedeep";import{WheelGestures as d}from"wheel-gestures";const c=function(){var t,e,o="0.5.4",s="hasOwnProperty",i=/[\.\/]/,n=/\s*,\s*/,a=function(t,e){return t-e},r={n:{}},l=function(){for(var t=0,e=this.length;t<e;t++)if(void 0!==this[t])return this[t]},d=function(){for(var t=this.length;--t;)if(void 0!==this[t])return this[t]},c=Object.prototype.toString,h=String,p=Array.isArray||function(t){return t instanceof Array||"[object Array]"==c.call(t)},u=function(o,s){var i,n=e,r=Array.prototype.slice.call(arguments,2),c=u.listeners(o),h=0,p=[],f={},g=[],m=t;g.firstDefined=l,g.lastDefined=d,t=o,e=0;for(var y=0,x=c.length;y<x;y++)"zIndex"in c[y]&&(p.push(c[y].zIndex),c[y].zIndex<0&&(f[c[y].zIndex]=c[y]));for(p.sort(a);p[h]<0;)if(i=f[p[h++]],g.push(i.apply(s,r)),e)return e=n,g;for(y=0;y<x;y++)if("zIndex"in(i=c[y]))if(i.zIndex==p[h]){if(g.push(i.apply(s,r)),e)break;do{if((i=f[p[++h]])&&g.push(i.apply(s,r)),e)break}while(i)}else f[i.zIndex]=i;else if(g.push(i.apply(s,r)),e)break;return e=n,t=m,g};return u._events=r,u.listeners=function(t){var e,o,s,n,a,l,d,c,h=p(t)?t:t.split(i),u=r,f=[u],g=[];for(n=0,a=h.length;n<a;n++){for(c=[],l=0,d=f.length;l<d;l++)for(o=[(u=f[l].n)[h[n]],u["*"]],s=2;s--;)(e=o[s])&&(c.push(e),g=g.concat(e.f||[]));f=c}return g},u.separator=function(t){t?(t="["+(t=h(t).replace(/(?=[\.\^\]\[\-])/g,"\\"))+"]",i=new RegExp(t)):i=/[\.\/]/},u.on=function(t,e){if("function"!=typeof e)return function(){};for(var o=p(t)?p(t[0])?t:[t]:h(t).split(n),s=0,a=o.length;s<a;s++)!function(t){for(var o,s=p(t)?t:h(t).split(i),n=r,a=0,l=s.length;a<l;a++)n=(n=n.n).hasOwnProperty(s[a])&&n[s[a]]||(n[s[a]]={n:{}});for(n.f=n.f||[],a=0,l=n.f.length;a<l;a++)if(n.f[a]==e){o=!0;break}!o&&n.f.push(e)}(o[s]);return function(t){+t==+t&&(e.zIndex=+t)}},u.f=function(t){var e=[].slice.call(arguments,1);return function(){u.apply(null,[t,null].concat(e).concat([].slice.call(arguments,0)))}},u.stop=function(){e=1},u.nt=function(e){var o=p(t)?t.join("."):t;return e?new RegExp("(?:\\.|\\/|^)"+e+"(?:\\.|\\/|$)").test(o):o},u.nts=function(){return p(t)?t:t.split(i)},u.off=u.unbind=function(t,e){if(t){var o=p(t)?p(t[0])?t:[t]:h(t).split(n);if(o.length>1)for(var a=0,l=o.length;a<l;a++)u.off(o[a],e);else{o=p(t)?t:h(t).split(i);var d,c,f,g,m,y=[r],x=[];for(a=0,l=o.length;a<l;a++)for(g=0;g<y.length;g+=f.length-2){if(f=[g,1],d=y[g].n,"*"!=o[a])d[o[a]]&&(f.push(d[o[a]]),x.unshift({n:d,name:o[a]}));else for(c in d)d[s](c)&&(f.push(d[c]),x.unshift({n:d,name:c}));y.splice.apply(y,f)}for(a=0,l=y.length;a<l;a++)for(d=y[a];d.n;){if(e){if(d.f){for(g=0,m=d.f.length;g<m;g++)if(d.f[g]==e){d.f.splice(g,1);break}!d.f.length&&delete d.f}for(c in d.n)if(d.n[s](c)&&d.n[c].f){var b=d.n[c].f;for(g=0,m=b.length;g<m;g++)if(b[g]==e){b.splice(g,1);break}!b.length&&delete d.n[c].f}}else for(c in delete d.f,d.n)d.n[s](c)&&d.n[c].f&&delete d.n[c].f;d=d.n}t:for(a=0,l=x.length;a<l;a++){for(c in(d=x[a]).n[d.name].f)continue t;for(c in d.n[d.name].n)continue t;delete d.n[d.name]}}}else u._events=r={n:{}}},u.once=function(t,e){var o=function(){return u.off(t,o),e.apply(this,arguments)};return u.on(t,o)},u.version=o,u.toString=function(){return"You are running Eve 0.5.4"},u}(),h=function(){function t(o){if(t.is(o,"function"))return e?o():c.on("raphael.DOMload",o);if(t.is(o,E))return t._engine.create[h](t,o.splice(0,3+t.is(o[0],P))).add(o);const s=Array.prototype.slice.call(arguments,0);if(t.is(s[s.length-1],"function")){const o=s.pop();return e?o.call(t._engine.create[h](t,s)):c.on("raphael.DOMload",(()=>{o.call(t._engine.create[h](t,s))}))}return t._engine.create[h](t,arguments)}let e;t.version="2.2.0",t.eve=c;const o=/[, ]+/,s={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},i=/\{(\d+)\}/g,n="hasOwnProperty",a={doc:document,win:window},r={was:Object.prototype[n].call(a.win,"Raphael"),is:a.win.Raphael},l=function(){this.ca=this.customAttributes={}};let d;var h="apply";const p="ontouchstart"in a.win||a.win.DocumentTouch&&a.doc instanceof DocumentTouch,u="",f=" ",g=String,m="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel".split(f),y={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},x=g.prototype.toLowerCase,b=Math,v=b.max,w=b.min,{abs:k}=b,{pow:C}=b,{PI:_}=b;var P="number";const S="string";var E="array";const A=Object.prototype.toString,T=(t._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),B={NaN:1,Infinity:1,"-Infinity":1},O=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,{round:z}=b,N=parseFloat,M=parseInt,$=g.prototype.toUpperCase,R=t._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:"",filter:""},L=t._availableAnimAttrs={blur:P,"clip-rect":"csv",cx:P,cy:P,fill:"colour","fill-opacity":P,"font-size":P,height:P,opacity:P,path:"path",r:P,rx:P,ry:P,stroke:"colour","stroke-opacity":P,"stroke-width":P,transform:"transform",width:P,x:P,y:P},I=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,F={hs:1,rg:1},D=/,?([achlmqrstvxz]),?/gi,j=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,W=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,H=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,G=(t._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),U=function(t,e){return N(t)-N(e)},V=function(t){return t},q=t._rectPath=function(t,e,o,s,i){return i?[["M",t+i,e],["l",o-2*i,0],["a",i,i,0,0,1,i,i],["l",0,s-2*i],["a",i,i,0,0,1,-i,i],["l",2*i-o,0],["a",i,i,0,0,1,-i,-i],["l",0,2*i-s],["a",i,i,0,0,1,i,-i],["z"]]:[["M",t,e],["l",o,0],["l",0,s],["l",-o,0],["z"]]},Y=function(t,e,o,s){return null==s&&(s=o),[["M",t,e],["m",0,-s],["a",o,s,0,1,1,0,2*s],["a",o,s,0,1,1,0,-2*s],["z"]]},X=t._getPath={path:t=>t.attr("path"),circle(t){const e=t.attrs;return Y(e.cx,e.cy,e.r)},ellipse(t){const e=t.attrs;return Y(e.cx,e.cy,e.rx,e.ry)},rect(t){const e=t.attrs;return q(e.x,e.y,e.width,e.height,e.r)},image(t){const e=t.attrs;return q(e.x,e.y,e.width,e.height)},text(t){const e=t._getBBox();return q(e.x,e.y,e.width,e.height)},set(t){const e=t._getBBox();return q(e.x,e.y,e.width,e.height)},g(t){const e=t._getBBox();return q(e.x,e.y,e.width,e.height)}},J=t.mapPath=function(t,e){if(!e)return t;let o,s,i,n,a,r,l;for(i=0,a=(t=St(t)).length;i<a;i++)for(l=t[i],n=1,r=l.length;n<r;n+=2)o=e.x(l[n],l[n+1]),s=e.y(l[n],l[n+1]),l[n]=o,l[n+1]=s;return t};function Z(t){if("function"==typeof t||Object(t)!==t)return t;const e=new t.constructor;for(const o in t)t[n](o)&&(e[o]=Z(t[o]));return e}t._g=a,t.type="SVG",t.svg=!0,t._Paper=l,t.fn=d=l.prototype=t.prototype,t._id=0,t.is=function(t,e){return"finite"==(e=x.call(e))?!B[n](+t):"array"==e?t instanceof Array:"null"==e&&null===t||e===typeof t&&null!==t||"object"==e&&t===Object(t)||"array"==e&&Array.isArray&&Array.isArray(t)||A.call(t).slice(8,-1).toLowerCase()==e},t.angle=function(e,o,s,i,n,a){if(null==n){const t=e-s,n=o-i;return t||n?(180+180*b.atan2(-n,-t)/_+360)%360:0}return t.angle(e,o,n,a)-t.angle(s,i,n,a)},t.rad=function(t){return t%360*_/180},t.deg=function(t){return Math.round(180*t/_%360*1e3)/1e3},t.snapTo=function(e,o,s){if(s=t.is(s,"finite")?s:10,t.is(e,E)){let t=e.length;for(;t--;)if(k(e[t]-o)<=s)return e[t]}else{const t=o%(e=+e);if(t<s)return o-t;if(t>e-s)return o-t+e}return o};t.createUUID=(K=/[xy]/g,Q=t=>{const e=16*b.random()|0;return("x"==t?e:3&e|8).toString(16)},function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(K,Q).toUpperCase()});var K,Q;t.setWindow=function(e){c("raphael.setWindow",t,a.win,e),a.win=e,a.doc=a.win.document,t._engine.initWin&&t._engine.initWin(a.win)};var tt=function(t){const e=a.doc.createElement("i");return e.title="Raphaël Colour Picker",e.style.display="none",a.doc.body.appendChild(e),(tt=lt("toHex",(t=>(e.style.color=t,a.doc.defaultView.getComputedStyle(e,u).getPropertyValue("color")))))(t)};const et=function(){return`hsb(${[this.h,this.s,this.b]})`},ot=function(){return`hsl(${[this.h,this.s,this.l]})`},st=function(){return this.hex},it=function(e,o,s){if(null==o&&t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(s=e.b,o=e.g,e=e.r),null==o&&t.is(e,S)){const i=t.getRGB(e);e=i.r,o=i.g,s=i.b}return(e>1||o>1||s>1)&&(e/=255,o/=255,s/=255),[e,o,s]},nt=function(e,o,s,i){const n={r:e*=255,g:o*=255,b:s*=255,hex:t.rgb(e,o,s),toString:st};return t.is(i,"finite")&&(n.opacity=i),n};function at(t,e){for(let o=0,s=t.length;o<s;o++)if(t[o]===e)return t.push(t.splice(o,1)[0])}t.color=function(e){let o;return t.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(o=t.hsb2rgb(e),e.r=o.r,e.g=o.g,e.b=o.b,e.hex=o.hex):t.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(o=t.hsl2rgb(e),e.r=o.r,e.g=o.g,e.b=o.b,e.hex=o.hex):(t.is(e,"string")&&(e=t.getRGB(e)),t.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(o=t.rgb2hsl(e),e.h=o.h,e.s=o.s,e.l=o.l,o=t.rgb2hsb(e),e.v=o.b):(e={hex:"none"}).r=e.g=e.b=e.h=e.s=e.v=e.l=-1),e.toString=st,e},t.hsb2rgb=function(t,e,o,s){let i,n,a,r,l;return this.is(t,"object")&&"h"in t&&"s"in t&&"b"in t&&(o=t.b,e=t.s,s=t.o,t=t.h),l=o*e,r=l*(1-k((t=(t*=360)%360/60)%2-1)),i=n=a=o-l,i+=[l,r,0,0,r,l][t=~~t],n+=[r,l,l,r,0,0][t],a+=[0,0,r,l,l,r][t],nt(i,n,a,s)},t.hsl2rgb=function(t,e,o,s){let i,n,a,r,l;return this.is(t,"object")&&"h"in t&&"s"in t&&"l"in t&&(o=t.l,e=t.s,t=t.h),(t>1||e>1||o>1)&&(t/=360,e/=100,o/=100),l=2*e*(o<.5?o:1-o),r=l*(1-k((t=(t*=360)%360/60)%2-1)),i=n=a=o-l/2,i+=[l,r,0,0,r,l][t=~~t],n+=[r,l,l,r,0,0][t],a+=[0,0,r,l,l,r][t],nt(i,n,a,s)},t.rgb2hsb=function(t,e,o){let s,i,n,a;return t=(o=it(t,e,o))[0],e=o[1],o=o[2],n=v(t,e,o),a=n-w(t,e,o),s=0==a?null:n==t?(e-o)/a:n==e?(o-t)/a+2:(t-e)/a+4,s=(s+360)%6*60/360,i=0==a?0:a/n,{h:s,s:i,b:n,toString:et}},t.rgb2hsl=function(t,e,o){let s,i,n,a,r,l;return t=(o=it(t,e,o))[0],e=o[1],o=o[2],a=v(t,e,o),r=w(t,e,o),l=a-r,s=0==l?null:a==t?(e-o)/l:a==e?(o-t)/l+2:(t-e)/l+4,s=(s+360)%6*60/360,n=(a+r)/2,i=0==l?0:n<.5?l/(2*n):l/(2-2*n),{h:s,s:i,l:n,toString:ot}},t._path2string=function(){return this.map((t=>[t[0],...t.slice(1).map((t=>Math.round(100*t)/100))])).join(",").replace(D,"$1")};const rt=t.CACHE={};function lt(t,e,o,s){function i(){const t=Array.prototype.slice.call(arguments,0),i=t.join("␀");if(a[n](i))return at(r,i),s?s(a[i]):a[i];r.length>=1e3&&delete a[r.shift()],r.push(i);const l=a[i]=e[h](o,t);return s?s(l):l}var a=i.cache={},r=i.count=[];return i.clear=function(){a=i.cache={},r=i.count=[]},rt[t]=i,i}t.clearCaches=function(){for(const t in rt)rt.hasOwnProperty(t)&&rt[t].clear()};t._preload=function(t,e){const o=a.doc.createElement("img");o.style.cssText="position:absolute;left:-9999em;top:-9999em",o.onload=function(){e.call(this),this.onload=null,a.doc.body.removeChild(this)},o.onerror=function(){a.doc.body.removeChild(this)},a.doc.body.appendChild(o),o.src=t};function dt(){return this.hex}function ct(t,e){const o=[];for(let s=0,i=t.length;i-2*!e>s;s+=2){const n=[{x:+t[s-2],y:+t[s-1]},{x:+t[s],y:+t[s+1]},{x:+t[s+2],y:+t[s+3]},{x:+t[s+4],y:+t[s+5]}];e?s?i-4==s?n[3]={x:+t[0],y:+t[1]}:i-2==s&&(n[2]={x:+t[0],y:+t[1]},n[3]={x:+t[2],y:+t[3]}):n[0]={x:+t[i-2],y:+t[i-1]}:i-4==s?n[3]=n[2]:s||(n[0]={x:+t[s],y:+t[s+1]}),o.push(["C",(-n[0].x+6*n[1].x+n[2].x)/6,(-n[0].y+6*n[1].y+n[2].y)/6,(n[1].x+6*n[2].x-n[3].x)/6,(n[1].y+6*n[2].y-n[3].y)/6,n[2].x,n[2].y])}return o}t.getRGB=lt("getRGB",(e=>{if(!e||(e=g(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:dt};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none",toString:dt};let o,s,i,a,r,l;!F[n](e.toLowerCase().substring(0,2))&&"#"!=e.charAt()&&(e=tt(e));let d=e.match(T);return d?(d[2]&&(i=M(d[2].substring(5),16),s=M(d[2].substring(3,5),16),o=M(d[2].substring(1,3),16)),d[3]&&(i=M((r=d[3].charAt(3))+r,16),s=M((r=d[3].charAt(2))+r,16),o=M((r=d[3].charAt(1))+r,16)),d[4]&&(l=d[4].split(I),o=N(l[0]),"%"==l[0].slice(-1)&&(o*=2.55),s=N(l[1]),"%"==l[1].slice(-1)&&(s*=2.55),i=N(l[2]),"%"==l[2].slice(-1)&&(i*=2.55),"rgba"==d[1].toLowerCase().slice(0,4)&&(a=N(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100)),d[5]?(l=d[5].split(I),o=N(l[0]),"%"==l[0].slice(-1)&&(o*=2.55),s=N(l[1]),"%"==l[1].slice(-1)&&(s*=2.55),i=N(l[2]),"%"==l[2].slice(-1)&&(i*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(o/=360),"hsba"==d[1].toLowerCase().slice(0,4)&&(a=N(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100),t.hsb2rgb(o,s,i,a)):d[6]?(l=d[6].split(I),o=N(l[0]),"%"==l[0].slice(-1)&&(o*=2.55),s=N(l[1]),"%"==l[1].slice(-1)&&(s*=2.55),i=N(l[2]),"%"==l[2].slice(-1)&&(i*=2.55),("deg"==l[0].slice(-3)||"°"==l[0].slice(-1))&&(o/=360),"hsla"==d[1].toLowerCase().slice(0,4)&&(a=N(l[3])),l[3]&&"%"==l[3].slice(-1)&&(a/=100),t.hsl2rgb(o,s,i,a)):(d={r:o,g:s,b:i,toString:dt},d.hex=`#${(16777216|i|s<<8|o<<16).toString(16).slice(1)}`,t.is(a,"finite")&&(d.opacity=a),d)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:dt}}),t),t.hsb=lt("hsb",((e,o,s)=>t.hsb2rgb(e,o,s).hex)),t.hsl=lt("hsl",((e,o,s)=>t.hsl2rgb(e,o,s).hex)),t.rgb=lt("rgb",((t,e,o)=>{function s(t){return t+.5|0}return`#${(16777216|s(o)|s(e)<<8|s(t)<<16).toString(16).slice(1)}`})),t.getColor=function(t){const e=this.getColor.start=this.getColor.start||{h:0,s:1,b:t||.75},o=this.hsb2rgb(e.h,e.s,e.b);return e.h+=.075,e.h>1&&(e.h=0,e.s-=.2,e.s<=0&&(this.getColor.start={h:0,s:1,b:e.b})),o.hex},t.getColor.reset=function(){delete this.start},t.parsePathString=function(e){if(!e)return null;const o=ht(e);if(o.arr)return xt(o.arr);const s={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};let i=[];return t.is(e,E)&&t.is(e[0],E)&&(i=xt(e)),i.length||g(e).replace(j,((t,e,o)=>{const n=[];let a=e.toLowerCase();if(o.replace(H,((t,e)=>{e&&n.push(+e)})),"m"==a&&n.length>2&&(i.push([e].concat(n.splice(0,2))),a="l",e="m"==e?"l":"L"),"r"==a)i.push([e].concat(n));else for(;n.length>=s[a]&&(i.push([e].concat(n.splice(0,s[a]))),s[a]););})),i.toString=t._path2string,o.arr=xt(i),i},t.parseTransformString=lt("parseTransformString",(e=>{if(!e)return null;let o=[];return t.is(e,E)&&t.is(e[0],E)&&(o=xt(e)),o.length||g(e).replace(W,((t,e,s)=>{const i=[];x.call(e);s.replace(H,((t,e)=>{e&&i.push(+e)})),o.push([e].concat(i))})),o.toString=t._path2string,o}));var ht=function(t){const e=ht.ps=ht.ps||{};return e[t]?e[t].sleep=100:e[t]={sleep:100},setTimeout((()=>{for(const o in e)e[n](o)&&o!=t&&(e[o].sleep--,!e[o].sleep&&delete e[o])})),e[t]};function pt(t,e,o,s,i){return t*(t*(-3*e+9*o-9*s+3*i)+6*e-12*o+6*s)-3*e+3*o}function ut(t,e,o,s,i,n,a,r,l){null==l&&(l=1);const d=(l=l>1?1:l<0?0:l)/2,c=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],h=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472];let p=0;for(let l=0;l<12;l++){const u=d*c[l]+d,f=pt(u,t,o,i,a),g=pt(u,e,s,n,r),m=f*f+g*g;p+=h[l]*b.sqrt(m)}return d*p}function ft(t,e,o,s,i,n,a,r){if(v(t,o)<w(i,a)||w(t,o)>v(i,a)||v(e,s)<w(n,r)||w(e,s)>v(n,r))return;const l=(t-o)*(n-r)-(e-s)*(i-a);if(!l)return;const d=((t*s-e*o)*(i-a)-(t-o)*(i*r-n*a))/l,c=((t*s-e*o)*(n-r)-(e-s)*(i*r-n*a))/l,h=+d.toFixed(2),p=+c.toFixed(2);return h<+w(t,o).toFixed(2)||h>+v(t,o).toFixed(2)||h<+w(i,a).toFixed(2)||h>+v(i,a).toFixed(2)||p<+w(e,s).toFixed(2)||p>+v(e,s).toFixed(2)||p<+w(n,r).toFixed(2)||p>+v(n,r).toFixed(2)?void 0:{x:d,y:c}}function gt(e,o,s){const i=t.bezierBBox(e),n=t.bezierBBox(o);if(!t.isBBoxIntersect(i,n))return s?0:[];const a=ut.apply(0,e),r=ut.apply(0,o),l=v(~~(a/5),1),d=v(~~(r/5),1),c=[],h=[],p={};let u=s?0:[];for(var f=0;f<l+1;f++){var g=t.findDotsAtSegment.apply(t,e.concat(f/l));c.push({x:g.x,y:g.y,t:f/l})}for(f=0;f<d+1;f++)g=t.findDotsAtSegment.apply(t,o.concat(f/d)),h.push({x:g.x,y:g.y,t:f/d});for(f=0;f<l;f++)for(let t=0;t<d;t++){const e=c[f],o=c[f+1],i=h[t],n=h[t+1],a=k(o.x-e.x)<.001?"y":"x",r=k(n.x-i.x)<.001?"y":"x",l=ft(e.x,e.y,o.x,o.y,i.x,i.y,n.x,n.y);if(l){if(p[l.x.toFixed(4)]==l.y.toFixed(4))continue;p[l.x.toFixed(4)]=l.y.toFixed(4);const t=e.t+k((l[a]-e[a])/(o[a]-e[a]))*(o.t-e.t),d=i.t+k((l[r]-i[r])/(n[r]-i[r]))*(n.t-i.t);t>=0&&t<=1.001&&d>=0&&d<=1.001&&(s?u++:u.push({x:l.x,y:l.y,t1:w(t,1),t2:w(d,1)}))}}return u}function mt(e,o,s){let i,n,a,r,l,d,c,h,p,u;e=t._path2curve(e),o=t._path2curve(o);let f=s?0:[];for(let t=0,g=e.length;t<g;t++){const g=e[t];if("M"==g[0])i=l=g[1],n=d=g[2];else{"C"==g[0]?(p=[i,n].concat(g.slice(1)),i=p[6],n=p[7]):(p=[i,n,i,n,l,d,l,d],i=l,n=d);for(let e=0,i=o.length;e<i;e++){const i=o[e];if("M"==i[0])a=c=i[1],r=h=i[2];else{"C"==i[0]?(u=[a,r].concat(i.slice(1)),a=u[6],r=u[7]):(u=[a,r,a,r,c,h,c,h],a=c,r=h);const o=gt(p,u,s);if(s)f+=o;else{for(let s=0,i=o.length;s<i;s++)o[s].segment1=t,o[s].segment2=e,o[s].bez1=p,o[s].bez2=u;f=f.concat(o)}}}}}return f}t.findDotsAtSegment=function(t,e,o,s,i,n,a,r,l){const d=1-l,c=d**3,h=d**2,p=l*l,u=p*l,f=c*t+3*h*l*o+3*d*l*l*i+u*a,g=c*e+3*h*l*s+3*d*l*l*n+u*r,m=t+2*l*(o-t)+p*(i-2*o+t),y=e+2*l*(s-e)+p*(n-2*s+e),x=o+2*l*(i-o)+p*(a-2*i+o),v=s+2*l*(n-s)+p*(r-2*n+s),w=d*t+l*o,k=d*e+l*s,C=d*i+l*a,P=d*n+l*r;let S=90-180*b.atan2(m-x,y-v)/_;return(m>x||y<v)&&(S+=180),{x:f,y:g,m:{x:m,y:y},n:{x:x,y:v},start:{x:w,y:k},end:{x:C,y:P},alpha:S}},t.bezierBBox=function(e,o,s,i,n,a,r,l){t.is(e,"array")||(e=[e,o,s,i,n,a,r,l]);const d=Pt.apply(null,e);return{x:d.min.x,y:d.min.y,x2:d.max.x,y2:d.max.y,width:d.max.x-d.min.x,height:d.max.y-d.min.y}},t.isPointInsideBBox=function(t,e,o){return e>=t.x&&e<=t.x2&&o>=t.y&&o<=t.y2},t.isBBoxIntersect=function(e,o){const s=t.isPointInsideBBox;return s(o,e.x,e.y)||s(o,e.x2,e.y)||s(o,e.x,e.y2)||s(o,e.x2,e.y2)||s(e,o.x,o.y)||s(e,o.x2,o.y)||s(e,o.x,o.y2)||s(e,o.x2,o.y2)||(e.x<o.x2&&e.x>o.x||o.x<e.x2&&o.x>e.x)&&(e.y<o.y2&&e.y>o.y||o.y<e.y2&&o.y>e.y)},t.pathIntersection=function(t,e){return mt(t,e)},t.pathIntersectionNumber=function(t,e){return mt(t,e,1)},t.isPointInsidePath=function(e,o,s){const i=t.pathBBox(e);return t.isPointInsideBBox(i,o,s)&&mt(e,[["M",o,s],["H",i.x2+10]],1)%2==1},t._removedFactory=function(t){return function(){c("raphael.log",null,`Raphaël: you are calling to method “${t}” of removed object`,t)}};const yt=t.pathBBox=function(t){const e=ht(t);if(e.bbox)return Z(e.bbox);if(!t)return{x:0,y:0,width:0,height:0,x2:0,y2:0};let o,s=0,i=0,n=[],a=[];for(let e=0,r=(t=St(t)).length;e<r;e++)if(o=t[e],"M"==o[0])s=o[1],i=o[2],n.push(s),a.push(i);else{const t=Pt(s,i,o[1],o[2],o[3],o[4],o[5],o[6]);n=n.concat(t.min.x,t.max.x),a=a.concat(t.min.y,t.max.y),s=o[5],i=o[6]}const r=w[h](0,n),l=w[h](0,a),d=v[h](0,n),c=v[h](0,a),p=d-r,u=c-l,f={x:r,y:l,x2:d,y2:c,width:p,height:u,cx:r+p/2,cy:l+u/2};return e.bbox=Z(f),f};var xt=function(e){const o=e.slice(0);for(let t=0,s=e.length;t<s;++t)o[t]=e[t].slice(0);return o.toString=t._path2string,o};const bt=t._pathToRelative=function(e){const o=ht(e);if(o.rel)return xt(o.rel);t.is(e,E)&&t.is(e&&e[0],E)||(e=t.parsePathString(e));const s=[];let i=0,n=0,a=0,r=0,l=0;"M"==e[0][0]&&(i=e[0][1],n=e[0][2],a=i,r=n,l++,s.push(["M",i,n]));for(let t=l,o=e.length;t<o;t++){let o=s[t]=[];const l=e[t];if(l[0]!=x.call(l[0]))switch(o[0]=x.call(l[0]),o[0]){case"a":o[1]=l[1],o[2]=l[2],o[3]=l[3],o[4]=l[4],o[5]=l[5],o[6]=+(l[6]-i).toFixed(3),o[7]=+(l[7]-n).toFixed(3);break;case"v":o[1]=+(l[1]-n).toFixed(3);break;case"m":a=l[1],r=l[2];default:for(let t=1,e=l.length;t<e;t++)o[t]=+(l[t]-(t%2?i:n)).toFixed(3)}else{o=s[t]=[],"m"==l[0]&&(a=l[1]+i,r=l[2]+n);for(let e=0,o=l.length;e<o;e++)s[t][e]=l[e]}const d=s[t].length;switch(s[t][0]){case"z":i=a,n=r;break;case"h":i+=+s[t][d-1];break;case"v":n+=+s[t][d-1];break;default:i+=+s[t][d-2],n+=+s[t][d-1]}}return s.toString=t._path2string,o.rel=xt(s),s},vt=t._pathToAbsolute=function(e){const o=ht(e);if(o.abs)return xt(o.abs);if(t.is(e,E)&&t.is(e&&e[0],E)||(e=t.parsePathString(e)),!e||!e.length)return[["M",0,0]];let s=[],i=0,n=0,a=0,r=0,l=0;"M"==e[0][0]&&(i=+e[0][1],n=+e[0][2],a=i,r=n,l++,s[0]=["M",i,n]);const d=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase();for(var c,h,p=l,u=e.length;p<u;p++){if(s.push(c=[]),(h=e[p])[0]!=$.call(h[0]))switch(c[0]=$.call(h[0]),c[0]){case"A":c[1]=h[1],c[2]=h[2],c[3]=h[3],c[4]=h[4],c[5]=h[5],c[6]=+(h[6]+i),c[7]=+(h[7]+n);break;case"V":c[1]=+h[1]+n;break;case"H":c[1]=+h[1]+i;break;case"R":for(var f=[i,n].concat(h.slice(1)),g=2,m=f.length;g<m;g++)f[g]=+f[g]+i,f[++g]=+f[g]+n;s.pop(),s=s.concat(ct(f,d));break;case"M":a=+h[1]+i,r=+h[2]+n;default:for(g=1,m=h.length;g<m;g++)c[g]=+h[g]+(g%2?i:n)}else if("R"==h[0])f=[i,n].concat(h.slice(1)),s.pop(),s=s.concat(ct(f,d)),c=["R"].concat(h.slice(-2));else for(let t=0,e=h.length;t<e;t++)c[t]=h[t];switch(c[0]){case"Z":i=a,n=r;break;case"H":i=c[1];break;case"V":n=c[1];break;case"M":a=c[c.length-2],r=c[c.length-1];default:i=c[c.length-2],n=c[c.length-1]}}return s.toString=t._path2string,o.abs=xt(s),s},wt=function(t,e,o,s){return[t,e,o,s,o,s]},kt=function(t,e,o,s,i,n){const a=1/3,r=2/3;return[a*t+r*o,a*e+r*s,a*i+r*o,a*n+r*s,i,n]};var Ct=function(t,e,o,s,i,n,a,r,l,d){const c=120*_/180,h=_/180*(+i||0);let p,u=[];const f=lt("a2c.rotate",((t,e,o)=>({x:t*b.cos(o)-e*b.sin(o),y:t*b.sin(o)+e*b.cos(o)})));if(d)y=d[0],x=d[1],g=d[2],m=d[3];else{p=f(t,e,-h),t=p.x,e=p.y,p=f(r,l,-h),r=p.x,l=p.y;b.cos(_/180*i),b.sin(_/180*i);const d=(t-r)/2,c=(e-l)/2;let u=d*d/(o*o)+c*c/(s*s);u>1&&(u=b.sqrt(u),o*=u,s*=u);const v=o*o,w=s*s,C=(n==a?-1:1)*b.sqrt(k((v*w-v*c*c-w*d*d)/(v*c*c+w*d*d)));var g=C*o*c/s+(t+r)/2,m=C*-s*d/o+(e+l)/2,y=b.asin(((e-m)/s).toFixed(9)),x=b.asin(((l-m)/s).toFixed(9));(y=t<g?_-y:y)<0&&(y=2*_+y),(x=r<g?_-x:x)<0&&(x=2*_+x),a&&y>x&&(y-=2*_),!a&&x>y&&(x-=2*_)}let v=x-y;if(k(v)>c){const t=x,e=r,n=l;x=y+c*(a&&x>y?1:-1),r=g+o*b.cos(x),l=m+s*b.sin(x),u=Ct(r,l,o,s,i,0,a,e,n,[x,t,g,m])}v=x-y;const w=b.cos(y),C=b.sin(y),P=b.cos(x),S=b.sin(x),E=b.tan(v/4),A=4/3*o*E,T=4/3*s*E,B=[t,e],O=[t+A*C,e-T*w],z=[r+A*S,l-T*P],N=[r,l];if(O[0]=2*B[0]-O[0],O[1]=2*B[1]-O[1],d)return[O,z,N].concat(u);u=[O,z,N].concat(u).join().split(",");const M=[];for(let t=0,e=u.length;t<e;t++)M[t]=t%2?f(u[t-1],u[t],h).y:f(u[t],u[t+1],h).x;return M};const _t=function(t,e,o,s,i,n,a,r,l){const d=1-l;return{x:d**3*t+d**2*3*l*o+3*d*l*l*i+l**3*a,y:d**3*e+d**2*3*l*s+3*d*l*l*n+l**3*r}};var Pt=lt("curveDim",((t,e,o,s,i,n,a,r)=>{let l=i-2*o+t-(a-2*i+o),d=2*(o-t)-2*(i-o),c=t-o,p=(-d+b.sqrt(d*d-4*l*c))/2/l,u=(-d-b.sqrt(d*d-4*l*c))/2/l;const f=[e,r],g=[t,a];let m;return k(p)>"1e12"&&(p=.5),k(u)>"1e12"&&(u=.5),p>0&&p<1&&(m=_t(t,e,o,s,i,n,a,r,p),g.push(m.x),f.push(m.y)),u>0&&u<1&&(m=_t(t,e,o,s,i,n,a,r,u),g.push(m.x),f.push(m.y)),l=n-2*s+e-(r-2*n+s),d=2*(s-e)-2*(n-s),c=e-s,p=(-d+b.sqrt(d*d-4*l*c))/2/l,u=(-d-b.sqrt(d*d-4*l*c))/2/l,k(p)>"1e12"&&(p=.5),k(u)>"1e12"&&(u=.5),p>0&&p<1&&(m=_t(t,e,o,s,i,n,a,r,p),g.push(m.x),f.push(m.y)),u>0&&u<1&&(m=_t(t,e,o,s,i,n,a,r,u),g.push(m.x),f.push(m.y)),{min:{x:w[h](0,g),y:w[h](0,f)},max:{x:v[h](0,g),y:v[h](0,f)}}})),St=t._path2curve=lt("path2curve",((t,e)=>{const o=!e&&ht(t);if(!e&&o.curve)return xt(o.curve);const s=vt(t),i=e&&vt(e),n={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},r=function(t,e,o){let s,i;if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in{T:1,Q:1})&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(Ct[h](0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==o||"S"==o?(s=2*e.x-e.bx,i=2*e.y-e.by):(s=e.x,i=e.y),t=["C",s,i].concat(t.slice(1));break;case"T":"Q"==o||"T"==o?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(kt(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(kt(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(wt(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(wt(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(wt(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(wt(e.x,e.y,e.X,e.Y))}return t},l=function(t,e){if(t[e].length>7){t[e].shift();const o=t[e];for(;o.length;)c[e]="A",i&&(p[e]="A"),t.splice(e++,0,["C"].concat(o.splice(0,6)));t.splice(e,1),m=v(s.length,i&&i.length||0)}},d=function(t,e,o,n,a){t&&e&&"M"==t[a][0]&&"M"!=e[a][0]&&(e.splice(a,0,["M",n.x,n.y]),o.bx=0,o.by=0,o.x=t[a][1],o.y=t[a][2],m=v(s.length,i&&i.length||0))};var c=[],p=[];let u="",f="";for(var g=0,m=v(s.length,i&&i.length||0);g<m;g++){s[g]&&(u=s[g][0]),"C"!=u&&(c[g]=u,g&&(f=c[g-1])),s[g]=r(s[g],n,f),"A"!=c[g]&&"C"==u&&(c[g]="C"),l(s,g),i&&(i[g]&&(u=i[g][0]),"C"!=u&&(p[g]=u,g&&(f=p[g-1])),i[g]=r(i[g],a,f),"A"!=p[g]&&"C"==u&&(p[g]="C"),l(i,g)),d(s,i,n,a,g),d(i,s,a,n,g);const t=s[g],e=i&&i[g],o=t.length,h=i&&e.length;n.x=t[o-2],n.y=t[o-1],n.bx=N(t[o-4])||n.x,n.by=N(t[o-3])||n.y,a.bx=i&&(N(e[h-4])||a.x),a.by=i&&(N(e[h-3])||a.y),a.x=i&&e[h-2],a.y=i&&e[h-1]}return i||(o.curve=xt(s)),i?[s,i]:s}),null,xt);t._parseDots=lt("parseDots",(e=>{const o=[];for(var s=0,i=e.length;s<i;s++){const i={},n=e[s].match(/^([^:]*):?([\d\.]*)/);if(i.color=t.getRGB(n[1]),i.color.error)return null;i.opacity=i.color.opacity,i.color=i.color.hex,n[2]&&(i.offset=`${n[2]}%`),o.push(i)}for(s=1,i=o.length-1;s<i;s++)if(!o[s].offset){let t=N(o[s-1].offset||0),e=0;for(var n=s+1;n<i;n++)if(o[n].offset){e=o[n].offset;break}e||(e=100,n=i),e=N(e);const a=(e-t)/(n-s+1);for(;s<n;s++)t+=a,o[s].offset=`${t}%`}return o}));const Et=t._tear=function(t,e){t==e.top&&(e.top=t.prev),t==e.bottom&&(e.bottom=t.next),t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next)},At=(t._tofront=function(t,e){e.top!==t&&(Et(t,e),t.next=null,t.prev=e.top,e.top.next=t,e.top=t)},t._toback=function(t,e){e.bottom!==t&&(Et(t,e),t.next=e.bottom,t.prev=null,e.bottom.prev=t,e.bottom=t)},t._insertafter=function(t,e,o){Et(t,o),e==o.top&&(o.top=t),e.next&&(e.next.prev=t),t.next=e.next,t.prev=e,e.next=t},t._insertbefore=function(t,e,o){Et(t,o),e==o.bottom&&(o.bottom=t),e.prev&&(e.prev.next=t),t.prev=e.prev,e.prev=t,t.next=e},t.toMatrix=function(t,e){const o=yt(t),s={_:{transform:u},getBBox:()=>o};return Tt(s,e),s.matrix});t.transformPath=function(t,e){return J(t,At(t,e))};var Tt=t._extractTransform=function(e,o){if(null==o)return e._.transform;o=g(o).replace(/\.{3}|\u2026/g,e._.transform||u);const s=t.parseTransformString(o);let i=0,n=0,a=0,r=1,l=1;const{_:d}=e,c=new zt;if(d.transform=s||[],s)for(let t=0,o=s.length;t<o;t++){const o=s[t],n=o.length,a=g(o[0]).toLowerCase(),u=o[0]!=a,x=u?c.invert():0;var h,p,f,m,y;"t"==a&&3==n?u?(h=x.x(0,0),p=x.y(0,0),f=x.x(o[1],o[2]),m=x.y(o[1],o[2]),c.translate(f-h,m-p)):c.translate(o[1],o[2]):"r"==a?2==n?(y=y||e.getBBox(1),c.rotate(o[1],y.x+y.width/2,y.y+y.height/2),i+=o[1]):4==n&&(u?(f=x.x(o[2],o[3]),m=x.y(o[2],o[3]),c.rotate(o[1],f,m)):c.rotate(o[1],o[2],o[3]),i+=o[1]):"s"==a?2==n||3==n?(y=y||e.getBBox(1),c.scale(o[1],o[n-1],y.x+y.width/2,y.y+y.height/2),r*=o[1],l*=o[n-1]):5==n&&(u?(f=x.x(o[3],o[4]),m=x.y(o[3],o[4]),c.scale(o[1],o[2],f,m)):c.scale(o[1],o[2],o[3],o[4]),r*=o[1],l*=o[2]):"m"==a&&7==n&&c.add(o[1],o[2],o[3],o[4],o[5],o[6]),d.dirtyT=1,e.matrix=c}e.matrix=c,d.sx=r,d.sy=l,d.deg=i,d.dx=n=c.e,d.dy=a=c.f,1==r&&1==l&&!i&&d.bbox?(d.bbox.x+=+n,d.bbox.y+=+a):d.dirtyT=1};const Bt=function(t){const e=t[0];switch(e.toLowerCase()){case"t":return[e,0,0];case"m":return[e,1,0,0,1,0,0];case"r":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"s":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}},Ot=t._equaliseTransform=function(e,o){o=g(o).replace(/\.{3}|\u2026/g,e),e=t.parseTransformString(e)||[],o=t.parseTransformString(o)||[];const s=v(e.length,o.length),i=[],n=[];let a,r,l,d,c=0;for(;c<s;c++){if(l=e[c]||Bt(o[c]),d=o[c]||Bt(l),l[0]!=d[0]||"r"==l[0].toLowerCase()&&(l[2]!=d[2]||l[3]!=d[3])||"s"==l[0].toLowerCase()&&(l[3]!=d[3]||l[4]!=d[4]))return;for(i[c]=[],n[c]=[],a=0,r=v(l.length,d.length);a<r;a++)a in l&&(i[c][a]=l[a]),a in d&&(n[c][a]=d[a])}return{from:i,to:n}};function zt(t,e,o,s,i,n){null!=t?(this.a=+t,this.b=+e,this.c=+o,this.d=+s,this.e=+i,this.f=+n):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}t._getContainer=function(e,o,s,i){let n;if(n=null!=i||t.is(e,"object")?e:a.doc.getElementById(e),null!=n)return n.tagName?null==o?{container:n,width:n.style.pixelWidth||n.offsetWidth,height:n.style.pixelHeight||n.offsetHeight}:{container:n,width:o,height:s}:{container:1,x:e,y:o,width:s,height:i}},t.pathToRelative=bt,t._engine={},t.path2curve=St,t.matrix=function(t,e,o,s,i,n){return new zt(t,e,o,s,i,n)},function(e){function o(t){return t[0]*t[0]+t[1]*t[1]}function s(t){const e=b.sqrt(o(t));t[0]&&(t[0]/=e),t[1]&&(t[1]/=e)}e.add=function(t,e,o,s,i,n){const a=[[],[],[]],r=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]];let l,d,c,h,p=[[t,o,i],[e,s,n],[0,0,1]];for(t&&t instanceof zt&&(p=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]),l=0;l<3;l++)for(d=0;d<3;d++){for(h=0,c=0;c<3;c++)h+=r[l][c]*p[c][d];a[l][d]=h}this.a=a[0][0],this.b=a[1][0],this.c=a[0][1],this.d=a[1][1],this.e=a[0][2],this.f=a[1][2]},e.invert=function(){const t=this,e=t.a*t.d-t.b*t.c;return new zt(t.d/e,-t.b/e,-t.c/e,t.a/e,(t.c*t.f-t.d*t.e)/e,(t.b*t.e-t.a*t.f)/e)},e.clone=function(){return new zt(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(t,e){this.add(1,0,0,1,t,e)},e.scale=function(t,e,o,s){null==e&&(e=t),(o||s)&&this.add(1,0,0,1,o,s),this.add(t,0,0,e,0,0),(o||s)&&this.add(1,0,0,1,-o,-s)},e.rotate=function(e,o,s){e=t.rad(e),o=o||0,s=s||0;const i=+b.cos(e).toFixed(9),n=+b.sin(e).toFixed(9);this.add(i,n,-n,i,o,s),this.add(1,0,0,1,-o,-s)},e.x=function(t,e){return t*this.a+e*this.c+this.e},e.y=function(t,e){return t*this.b+e*this.d+this.f},e.get=function(t){return+this[g.fromCharCode(97+t)].toFixed(4)},e.toString=function(){return t.svg?`matrix(${[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()})`:[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return`progid:DXImageTransform.Microsoft.Matrix(M11=${this.get(0)}, M12=${this.get(2)}, M21=${this.get(1)}, M22=${this.get(3)}, Dx=${this.get(4)}, Dy=${this.get(5)}, sizingmethod='auto expand')`},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){const e={};e.dx=this.e,e.dy=this.f;const i=[[this.a,this.c],[this.b,this.d]];e.scalex=b.sqrt(o(i[0])),s(i[0]),e.shear=i[0][0]*i[1][0]+i[0][1]*i[1][1],i[1]=[i[1][0]-i[0][0]*e.shear,i[1][1]-i[0][1]*e.shear],e.scaley=b.sqrt(o(i[1])),s(i[1]),e.shear/=e.scaley;const n=-i[0][1],a=i[1][1];return a<0?(e.rotate=t.deg(b.acos(a)),n<0&&(e.rotate=360-e.rotate)):e.rotate=t.deg(b.asin(n)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(t){const e=t||this.split();return e.isSimple?(e.scalex=+e.scalex.toFixed(4),e.scaley=+e.scaley.toFixed(4),e.rotate=+e.rotate.toFixed(4),(e.dx||e.dy?`t${[e.dx,e.dy]}`:u)+(1!=e.scalex||1!=e.scaley?`s${[e.scalex,e.scaley,0,0]}`:u)+(e.rotate?`r${[e.rotate,0,0]}`:u)):`m${[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}`}}(zt.prototype);const Nt=function(){this.returnValue=!1},Mt=function(){return this.originalEvent.preventDefault()},$t=function(){this.cancelBubble=!0},Rt=function(){return this.originalEvent.stopPropagation()},Lt=function(t){const e=a.doc.documentElement.scrollTop||a.doc.body.scrollTop,o=a.doc.documentElement.scrollLeft||a.doc.body.scrollLeft;return{x:t.clientX+o,y:t.clientY+e}},It=a.doc.addEventListener?function(t,e,o,s){const i=function(t){const e=Lt(t);return o.call(s,t,e.x,e.y)};if(t.addEventListener(e,i,!1),p&&y[e]){var n=function(e){const i=Lt(e),n=e;for(let o=0,s=e.targetTouches&&e.targetTouches.length;o<s;o++)if(e.targetTouches[o].target==t){(e=e.targetTouches[o]).originalEvent=n,e.preventDefault=Mt,e.stopPropagation=Rt;break}return o.call(s,e,i.x,i.y)};t.addEventListener(y[e],n,!1)}return function(){return t.removeEventListener(e,i,!1),p&&y[e]&&t.removeEventListener(y[e],n,!1),!0}}:a.doc.attachEvent?function(t,e,o,s){const i=function(t){t=t||a.win.event;const e=a.doc.documentElement.scrollTop||a.doc.body.scrollTop,i=a.doc.documentElement.scrollLeft||a.doc.body.scrollLeft,n=t.clientX+i,r=t.clientY+e;return t.preventDefault=t.preventDefault||Nt,t.stopPropagation=t.stopPropagation||$t,o.call(s,t,n,r)};return t.attachEvent(`on${e}`,i),function(){return t.detachEvent(`on${e}`,i),!0}}:void 0;let Ft=[];const Dt=function(t){let e=t.clientX,o=t.clientY;const s=a.doc.documentElement.scrollTop||a.doc.body.scrollTop,i=a.doc.documentElement.scrollLeft||a.doc.body.scrollLeft;let n,r=Ft.length;for(;r--;){if(n=Ft[r],p&&t.touches){let s=t.touches.length;for(var l;s--;)if((l=t.touches[s]).identifier==n.el._drag.id){e=l.clientX,o=l.clientY,(t.originalEvent?t.originalEvent:t).preventDefault();break}}else t.preventDefault();const{node:h}=n.el;var d;const u=h.nextSibling,f=h.parentNode,{display:g}=h.style;a.win.opera&&f.removeChild(h),h.style.display="none",d=n.el.paper.getElementByPoint(e,o),h.style.display=g,a.win.opera&&(u?f.insertBefore(h,u):f.appendChild(h)),d&&c(`raphael.drag.over.${n.el.id}`,n.el,d),e+=i,o+=s,c(`raphael.drag.move.${n.el.id}`,n.move_scope||n.el,e-n.el._drag.x,o-n.el._drag.y,e,o,t)}};var jt=function(e){t.unmousemove(Dt).unmouseup(jt);let o,s=Ft.length;for(;s--;)o=Ft[s],o.el._drag={},c(`raphael.drag.end.${o.el.id}`,o.end_scope||o.start_scope||o.move_scope||o.el,e);Ft=[]};const Wt=t.el={};for(let e=m.length;e--;)!function(e){t[e]=Wt[e]=function(o,s){return t.is(o,"function")&&(this.events=this.events||[],this.events.push({name:e,f:o,unbind:It(this.shape||this.node||a.doc,e,o,s||this)})),this},t[`un${e}`]=Wt[`un${e}`]=function(o){const s=this.events||[];let i=s.length;for(;i--;)s[i].name!=e||!t.is(o,"undefined")&&s[i].f!=o||(s[i].unbind(),s.splice(i,1),!s.length&&delete this.events);return this}}(m[e]);Wt.data=function(e,o){const s=G[this.id]=G[this.id]||{};if(0==arguments.length)return s;if(1==arguments.length){if(t.is(e,"object")){for(const t in e)e[n](t)&&this.data(t,e[t]);return this}return c(`raphael.data.get.${this.id}`,this,s[e],e),s[e]}return s[e]=o,c(`raphael.data.set.${this.id}`,this,o,e),this},Wt.removeData=function(t){return null==t?G[this.id]={}:G[this.id]&&delete G[this.id][t],this},Wt.getData=function(){return Z(G[this.id]||{})},Wt.hover=function(t,e,o,s){return this.mouseover(t,o).mouseout(e,s||o)},Wt.unhover=function(t,e){return this.unmouseover(t).unmouseout(e)};const Ht=[];Wt.drag=function(e,o,s,i,n,r){function l(l){(l.originalEvent||l).preventDefault();let d=l.clientX,h=l.clientY;const u=a.doc.documentElement.scrollTop||a.doc.body.scrollTop,f=a.doc.documentElement.scrollLeft||a.doc.body.scrollLeft;if(this._drag.id=l.identifier,p&&l.touches){let t,e=l.touches.length;for(;e--;)if(t=l.touches[e],this._drag.id=t.identifier,t.identifier==this._drag.id){d=t.clientX,h=t.clientY;break}}this._drag.x=d+f,this._drag.y=h+u,!Ft.length&&t.mousemove(Dt).mouseup(jt),Ft.push({el:this,move_scope:i,start_scope:n,end_scope:r}),o&&c.on(`raphael.drag.start.${this.id}`,o),e&&c.on(`raphael.drag.move.${this.id}`,e),s&&c.on(`raphael.drag.end.${this.id}`,s),c(`raphael.drag.start.${this.id}`,n||i||this,l.clientX+f,l.clientY+u,l)}return this.start=l,this._drag={},Ht.push({el:this,start:l}),this.mousedown(l),this},Wt.onDragOver=function(t){t?c.on(`raphael.drag.over.${this.id}`,t):c.unbind(`raphael.drag.over.${this.id}`)},Wt.undrag=function(){let e=Ht.length;for(;e--;)Ht[e].el==this&&(this.unmousedown(Ht[e].start),Ht.splice(e,1),c.unbind(`raphael.drag.*.${this.id}`));!Ht.length&&t.unmousemove(Dt).unmouseup(jt),Ft=[]},d.circle=function(e,o,s){const i=t._engine.circle(this,e||0,o||0,s||0);return this.__set__&&this.__set__.push(i),i},d.rect=function(e,o,s,i,n){const a=t._engine.rect(this,e||0,o||0,s||0,i||0,n||0);return this.__set__&&this.__set__.push(a),a},d.g=function(){const e=t._engine.g(this);return this.__set__&&this.__set__.push(e),e},d.def=function(e){t._engine.def.call(this,e)},d.ellipse=function(e,o,s,i){const n=t._engine.ellipse(this,e||0,o||0,s||0,i||0);return this.__set__&&this.__set__.push(n),n},d.path=function(e){e&&!t.is(e,S)&&!t.is(e[0],E)&&(e+=u);const o=t._engine.path(t.format[h](t,arguments),this);return this.__set__&&this.__set__.push(o),o},d.image=function(e,o,s,i,n){const a=t._engine.image(this,e||"about:blank",o||0,s||0,i||0,n||0);return this.__set__&&this.__set__.push(a),a},d.text=function(e,o,s){const i=t._engine.text(this,e||0,o||0,g(s));return this.__set__&&this.__set__.push(i),i},d.set=function(e){!t.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));const o=new ne(e);return this.__set__&&this.__set__.push(o),o.paper=this,o.type="set",o},d.setStart=function(t){this.__set__=t||this.set()},d.setFinish=function(t){const e=this.__set__;return delete this.__set__,e},d.getSize=function(){const t=this.canvas.parentNode;return{width:t.offsetWidth,height:t.offsetHeight}},d.setSize=function(e,o){return t._engine.setSize.call(this,e,o)},d.setViewBox=function(e,o,s,i,n){return t._engine.setViewBox.call(this,e,o,s,i,n)},d.top=d.bottom=null,d.raphael=t;function Gt(){return`${this.x+f+this.y+f+this.width} × ${this.height}`}d.getElementByPoint=function(t,e){const o=this,s=o.canvas;let i=a.doc.elementFromPoint(t,e);if(a.win.opera&&"svg"==i.tagName){const o=function(t){const e=t.getBoundingClientRect(),o=t.ownerDocument,{body:s}=o,i=o.documentElement,n=i.clientTop||s.clientTop||0,r=i.clientLeft||s.clientLeft||0;return{y:e.top+(a.win.pageYOffset||i.scrollTop||s.scrollTop)-n,x:e.left+(a.win.pageXOffset||i.scrollLeft||s.scrollLeft)-r}}(s),n=s.createSVGRect();n.x=t-o.x,n.y=e-o.y,n.width=n.height=1;const r=s.getIntersectionList(n,null);r.length&&(i=r[r.length-1])}if(!i)return null;for(;i.parentNode&&i!=s.parentNode&&!i.raphael;)i=i.parentNode;return i==o.canvas.parentNode&&(i=s),i=i&&i.raphael?o.getById(i.raphaelid):null,i},d.getElementsByBBox=function(e){const o=this.set();return this.forEach((s=>{t.isBBoxIntersect(s.getBBox(),e)&&o.push(s)})),o},d.getById=function(t){let e=this.bottom;for(;e;){if(e.id==t)return e;e=e.next}return null},d.forEach=function(t,e){let o=this.bottom;for(;o;){if(!1===t.call(e,o))return this;o=o.next}return this},d.getElementsByPoint=function(t,e){const o=this.set();return this.forEach((s=>{s.isPointInside(t,e)&&o.push(s)})),o},Wt.isPointInside=function(e,o){let s=this.realPath=X[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(s=t.transformPath(s,this.attr("transform"))),t.isPointInsidePath(s,e,o)},Wt.getBBox=function(t){if(this.removed)return{};const{_:e}=this;return t?(!e.dirty&&e.bboxwt||(this.realPath=X[this.type](this),e.bboxwt=yt(this.realPath),e.bboxwt.toString=Gt,e.dirty=0),e.bboxwt):((e.dirty||e.dirtyT||!e.bbox)&&(!e.dirty&&this.realPath||(e.bboxwt=0,this.realPath=X[this.type](this)),e.bbox=yt(J(this.realPath,this.matrix)),e.bbox.toString=Gt,e.dirty=e.dirtyT=0),e.bbox)},Wt.clone=function(){if(this.removed)return null;const t=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(t),t},Wt.glow=function(t){if("text"==this.type)return null;const e={width:((t=t||{}).width||10)+(+this.attr("stroke-width")||1),fill:t.fill||!1,opacity:null==t.opacity?.5:t.opacity,offsetx:t.offsetx||0,offsety:t.offsety||0,color:t.color||"#000"},o=e.width/2,s=this.paper,i=s.set();let n=this.realPath||X[this.type](this);n=this.matrix?J(n,this.matrix):n;for(let t=1;t<o+1;t++)i.push(s.path(n).attr({stroke:e.color,fill:e.fill?e.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(e.width/o*t).toFixed(3),opacity:+(e.opacity/o).toFixed(3)}));return i.insertBefore(this).translate(e.offsetx,e.offsety)};const Ut=function(e,o,s,i,n,a,r,l,d){return null==d?ut(e,o,s,i,n,a,r,l):t.findDotsAtSegment(e,o,s,i,n,a,r,l,function(t,e,o,s,i,n,a,r,l){if(l<0||ut(t,e,o,s,i,n,a,r)<l)return;let d,c=.5,h=1-c;for(d=ut(t,e,o,s,i,n,a,r,h);k(d-l)>.01;)c/=2,h+=(d<l?1:-1)*c,d=ut(t,e,o,s,i,n,a,r,h);return h}(e,o,s,i,n,a,r,l,d))},Vt=function(e,o){return function(s,i,n){let a,r,l,d,c="";const h={};let p,u=0;for(let t=0,f=(s=St(s)).length;t<f;t++){if(l=s[t],"M"==l[0])a=+l[1],r=+l[2];else{if(d=Ut(a,r,l[1],l[2],l[3],l[4],l[5],l[6]),u+d>i){if(o&&!h.start){if(p=Ut(a,r,l[1],l[2],l[3],l[4],l[5],l[6],i-u),c+=[`C${p.start.x}`,p.start.y,p.m.x,p.m.y,p.x,p.y],n)return c;h.start=c,c=[`M${p.x}`,`${p.y}C${p.n.x}`,p.n.y,p.end.x,p.end.y,l[5],l[6]].join(),u+=d,a=+l[5],r=+l[6];continue}if(!e&&!o)return p=Ut(a,r,l[1],l[2],l[3],l[4],l[5],l[6],i-u),{x:p.x,y:p.y,alpha:p.alpha}}u+=d,a=+l[5],r=+l[6]}c+=l.shift()+l}return h.end=c,p=e?u:o?h:t.findDotsAtSegment(a,r,l[0],l[1],l[2],l[3],l[4],l[5],1),p.alpha&&(p={x:p.x,y:p.y,alpha:p.alpha}),p}},qt=Vt(1),Yt=Vt(),Xt=Vt(0,1);t.getTotalLength=qt,t.getPointAtLength=Yt,t.getSubpath=function(t,e,o){if(this.getTotalLength(t)-o<1e-6)return Xt(t,e).end;const s=Xt(t,o,1);return e?Xt(s,e).end:s},Wt.getTotalLength=function(){const t=this.getPath();if(t)return this.node.getTotalLength?this.node.getTotalLength():qt(t)},Wt.getPointAtLength=function(t){const e=this.getPath();if(e)return Yt(e,t)},Wt.getPath=function(){let e;const o=t._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return o&&(e=o(this)),e},Wt.getSubpath=function(e,o){const s=this.getPath();if(s)return t.getSubpath(s,e,o)};const Jt=t.easing_formulas={linear:t=>t,"<":function(t){return t**1.7},">":function(t){return t**.48},"<>":function(t){const e=.48-t/1.04,o=b.sqrt(.1734+e*e),s=o-e,i=-o-e,n=k(s)**(1/3)*(s<0?-1:1)+k(i)**(1/3)*(i<0?-1:1)+.5;return 3*(1-n)*n*n+n*n*n},backIn(t){const e=1.70158;return t*t*((e+1)*t-e)},backOut(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},elastic:t=>t==!!t?t:2**(-10*t)*b.sin(2*_*(t-.075)/.3)+1,bounce(t){const e=7.5625,o=2.75;let s;return s=t<1/o?e*t*t:t<2/o?e*(t-=1.5/o)*t+.75:t<2.5/o?e*(t-=2.25/o)*t+.9375:e*(t-=2.625/o)*t+.984375,s}};Jt.easeIn=Jt["ease-in"]=Jt["<"],Jt.easeOut=Jt["ease-out"]=Jt[">"],Jt.easeInOut=Jt["ease-in-out"]=Jt["<>"],Jt["back-in"]=Jt.backIn,Jt["back-out"]=Jt.backOut;const Zt=[],Kt=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,16)};var Qt=function(){const e=+new Date;let o=0;for(;o<Zt.length;o++){const x=Zt[o];if(x.el.removed||x.paused)continue;let b=e-x.start;var{ms:s}=x;const{easing:v}=x;var{from:i}=x,{diff:a}=x;const{to:w}=x,{t:k}=x,C=x.el,_={};var r;const S={};var l;if(x.initstatus?(b=(x.initstatus*x.anim.top-x.prev)/(x.percent-x.prev)*s,x.status=x.initstatus,delete x.initstatus,x.stop&&Zt.splice(o--,1)):x.status=(x.prev+(x.percent-x.prev)*(b/s))/x.anim.top,!(b<0))if(b<s){var d=v(b/s);for(var h in i)if(i[n](h)){switch(L[h]){case P:r=+i[h]+d*s*a[h];break;case"colour":r=`rgb(${[te(z(i[h].r+d*s*a[h].r)),te(z(i[h].g+d*s*a[h].g)),te(z(i[h].b+d*s*a[h].b))].join(",")})`;break;case"path":r=[];for(var p=0,u=i[h].length;p<u;p++){r[p]=[i[h][p][0]];for(var g=1,m=i[h][p].length;g<m;g++)r[p][g]=+i[h][p][g]+d*s*a[h][p][g];r[p]=r[p].join(f)}r=r.join(f);break;case"transform":if(a[h].real)for(r=[],p=0,u=i[h].length;p<u;p++)for(r[p]=[i[h][p][0]],g=1,m=i[h][p].length;g<m;g++)r[p][g]=i[h][p][g]+d*s*a[h][p][g];else{const t=function(t){return+i[h][t]+d*s*a[h][t]};r=[["m",t(0),t(1),t(2),t(3),t(4),t(5)]]}break;case"csv":if("clip-rect"==h)for(r=[],p=4;p--;)r[p]=+i[h][p]+d*s*a[h][p];break;default:var y=[].concat(i[h]);for(r=[],p=C.paper.customAttributes[h].length;p--;)r[p]=+y[p]+d*s*a[h][p]}_[h]=r}C.attr(_),function(t,e,o){setTimeout((()=>{c(`raphael.anim.frame.${t}`,e,o)}))}(C.id,C,x.anim)}else{if(function(e,o,s){setTimeout((()=>{c(`raphael.anim.frame.${o.id}`,o,s),c(`raphael.anim.finish.${o.id}`,o,s),t.is(e,"function")&&e.call(o)}))}(x.callback,C,x.anim),C.attr(w),Zt.splice(o--,1),x.repeat>1&&!x.next){for(l in w)w[n](l)&&(S[l]=x.totalOrigin[l]);x.el.attr(S),se(x.anim,x.el,x.anim.percents[0],null,x.totalOrigin,x.repeat-1)}x.next&&!x.stop&&se(x.anim,x.el,x.next,null,x.totalOrigin,x.repeat)}}Zt.length&&Kt(Qt)},te=function(t){return t>255?255:t<0?0:t};function ee(t,e,o,s,i,n){const a=3*e,r=3*(s-e)-a,l=1-a-r,d=3*o,c=3*(i-o)-d,h=1-d-c;function p(t){return((l*t+r)*t+a)*t}return function(t,e){const o=function(t,e){let o,s,i,n,d,c;for(i=t,c=0;c<8;c++){if(n=p(i)-t,k(n)<e)return i;if(d=(3*l*i+2*r)*i+a,k(d)<1e-6)break;i-=n/d}if(o=0,s=1,i=t,i<o)return o;if(i>s)return s;for(;o<s;){if(n=p(i),k(n-t)<e)return i;t>n?o=i:s=i,i=(s-o)/2+o}return i}(t,e);return((h*o+c)*o+d)*o}(t,1/(200*n))}function oe(t,e){const o=[],s={};if(this.ms=e,this.times=1,t){for(const e in t)t[n](e)&&(s[N(e)]=t[e],o.push(N(e)));o.sort(U)}this.anim=s,this.top=o[o.length-1],this.percents=o}function se(e,s,i,a,r,l){let d,h,p;i=N(i);let u,f,m,{ms:y}=e;const x={},b={},v={};if(a)for(k=0,C=Zt.length;k<C;k++){var w=Zt[k];if(w.el.id==s.id&&w.anim==e){w.percent!=i?(Zt.splice(k,1),p=1):h=w,s.attr(w.totalOrigin);break}}else a=+b;for(var k=0,C=e.percents.length;k<C;k++){if(e.percents[k]==i||e.percents[k]>a*e.top){i=e.percents[k],f=e.percents[k-1]||0,y=y/e.top*(i-f),u=e.percents[k+1],d=e.anim[i];break}a&&s.attr(e.anim[e.percents[k]])}if(d){if(h)h.initstatus=a,h.start=new Date-h.ms*a;else{for(const e in d)if(d[n](e)&&(L[n](e)||s.paper.customAttributes[n](e)))switch(x[e]=s.attr(e),null==x[e]&&(x[e]=R[e]),b[e]=d[e],L[e]){case P:v[e]=(b[e]-x[e])/y;break;case"colour":x[e]=t.getRGB(x[e]);var _=t.getRGB(b[e]);v[e]={r:(_.r-x[e].r)/y,g:(_.g-x[e].g)/y,b:(_.b-x[e].b)/y};break;case"path":var S=St(x[e],b[e]),E=S[1];for(x[e]=S[0],v[e]=[],k=0,C=x[e].length;k<C;k++){v[e][k]=[0];for(var A=1,T=x[e][k].length;A<T;A++)v[e][k][A]=(E[k][A]-x[e][k][A])/y}break;case"transform":var{_:B}=s,z=Ot(B[e],b[e]);if(z)for(x[e]=z.from,b[e]=z.to,v[e]=[],v[e].real=!0,k=0,C=x[e].length;k<C;k++)for(v[e][k]=[x[e][k][0]],A=1,T=x[e][k].length;A<T;A++)v[e][k][A]=(b[e][k][A]-x[e][k][A])/y;else{const t=s.matrix||new zt,o={_:{transform:B.transform},getBBox:()=>s.getBBox(1)};x[e]=[t.a,t.b,t.c,t.d,t.e,t.f],Tt(o,b[e]),b[e]=o._.transform,v[e]=[(o.matrix.a-t.a)/y,(o.matrix.b-t.b)/y,(o.matrix.c-t.c)/y,(o.matrix.d-t.d)/y,(o.matrix.e-t.e)/y,(o.matrix.f-t.f)/y]}break;case"csv":var M=g(d[e]).split(o),$=g(x[e]).split(o);if("clip-rect"==e)for(x[e]=$,v[e]=[],k=$.length;k--;)v[e][k]=(M[k]-x[e][k])/y;b[e]=M;break;default:for(M=[].concat(d[e]),$=[].concat(x[e]),v[e]=[],k=s.paper.customAttributes[e].length;k--;)v[e][k]=((M[k]||0)-($[k]||0))/y}const{easing:c}=d;let N=t.easing_formulas[c];if(!N)if(N=g(c).match(O),N&&5==N.length){const t=N;N=function(e){return ee(e,+t[1],+t[2],+t[3],+t[4],y)}}else N=V;if(m=d.start||e.start||+new Date,w={anim:e,percent:i,timestamp:m,start:m+(e.del||0),status:0,initstatus:a||0,stop:!1,ms:y,easing:N,from:x,diff:v,to:b,el:s,callback:d.callback,prev:f,next:u,repeat:l||e.times,origin:s.attr(),totalOrigin:r},Zt.push(w),a&&!h&&!p&&(w.stop=!0,w.start=new Date-y*a,1==Zt.length))return Qt();p&&(w.start=new Date-w.ms*a),1==Zt.length&&Kt(Qt)}c(`raphael.anim.start.${s.id}`,s,e)}}function ie(t){for(let e=0;e<Zt.length;e++)Zt[e].el.paper==t&&Zt.splice(e--,1)}Wt.animateWith=function(e,o,s,i,n,a){const r=this;if(r.removed)return a&&a.call(r),r;const l=s instanceof oe?s:t.animation(s,i,n,a);se(l,r,l.percents[0],null,r.attr());for(let t=0,s=Zt.length;t<s;t++)if(Zt[t].anim==o&&Zt[t].el==e){Zt[s-1].start=Zt[t].start;break}return r},Wt.onAnimation=function(t){return t?c.on(`raphael.anim.frame.${this.id}`,t):c.unbind(`raphael.anim.frame.${this.id}`),this},oe.prototype.delay=function(t){const e=new oe(this.anim,this.ms);return e.times=this.times,e.del=+t||0,e},oe.prototype.repeat=function(t){const e=new oe(this.anim,this.ms);return e.del=this.del,e.times=b.floor(v(t,0))||1,e},t.animation=function(e,o,s,i){if(e instanceof oe)return e;!t.is(s,"function")&&s||(i=i||s||null,s=null),e=Object(e),o=+o||0;const a={};let r,l;for(l in e)e[n](l)&&N(l)!=l&&`${N(l)}%`!=l&&(r=!0,a[l]=e[l]);if(!r){if(i){let t=0;for(const o in e){const s=M(o);e[n](o)&&s>t&&(t=s)}t+="%",!e[t].callback&&(e[t].callback=i)}return new oe(e,o)}return s&&(a.easing=s),i&&(a.callback=i),new oe({100:a},o)},Wt.animate=function(e,o,s,i){const n=this;if(n.removed)return i&&i.call(n),n;const a=e instanceof oe?e:t.animation(e,o,s,i);return se(a,n,a.percents[0],null,n.attr()),n},Wt.setTime=function(t,e){return t&&null!=e&&this.status(t,w(e,t.ms)/t.ms),this},Wt.status=function(t,e){const o=[];let s,i,n=0;if(null!=e)return se(t,this,-1,w(e,1)),this;for(s=Zt.length;n<s;n++)if(i=Zt[n],i.el.id==this.id&&(!t||i.anim==t)){if(t)return i.status;o.push({anim:i.anim,status:i.status})}return t?0:o},Wt.pause=function(t){for(let e=0;e<Zt.length;e++)Zt[e].el.id!=this.id||t&&Zt[e].anim!=t||!1!==c(`raphael.anim.pause.${this.id}`,this,Zt[e].anim)&&(Zt[e].paused=!0);return this},Wt.resume=function(t){for(let e=0;e<Zt.length;e++)if(Zt[e].el.id==this.id&&(!t||Zt[e].anim==t)){const t=Zt[e];!1!==c(`raphael.anim.resume.${this.id}`,this,t.anim)&&(delete t.paused,this.status(t.anim,t.status))}return this},Wt.stop=function(t){for(let e=0;e<Zt.length;e++)Zt[e].el.id!=this.id||t&&Zt[e].anim!=t||!1!==c(`raphael.anim.stop.${this.id}`,this,Zt[e].anim)&&Zt.splice(e--,1);return this},c.on("raphael.remove",ie),c.on("raphael.clear",ie),Wt.toString=function(){return"Raphaël’s object"};var ne=function(t){if(this.items=[],this.length=0,this.type="set",t)for(let e=0,o=t.length;e<o;e++)!t[e]||t[e].constructor!=Wt.constructor&&t[e].constructor!=ne||(this[this.items.length]=this.items[this.items.length]=t[e],this.length++)};const ae=ne.prototype;ae.push=function(){let t,e;for(let o=0,s=arguments.length;o<s;o++)t=arguments[o],!t||t.constructor!=Wt.constructor&&t.constructor!=ne||(e=this.items.length,this[e]=this.items[e]=t,this.length++);return this},ae.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},ae.forEach=function(t,e){for(let o=0,s=this.items.length;o<s;o++)if(!1===t.call(e,this.items[o],o))return this;return this};for(const t in Wt)Wt[n](t)&&(ae[t]=function(t){return function(){const e=arguments;return this.forEach((o=>{o[t][h](o,e)}))}}(t));var re,le,de;return ae.attr=function(e,o){if(e&&t.is(e,E)&&t.is(e[0],"object"))for(let t=0,o=e.length;t<o;t++)this.items[t].attr(e[t]);else for(let t=0,s=this.items.length;t<s;t++)this.items[t].attr(e,o);return this},ae.clear=function(){for(;this.length;)this.pop()},ae.splice=function(t,e,o){t=t<0?v(this.length+t,0):t,e=v(0,w(this.length-t,e));const s=[],i=[],n=[];let a;for(a=2;a<arguments.length;a++)n.push(arguments[a]);for(a=0;a<e;a++)i.push(this[t+a]);for(;a<this.length-t;a++)s.push(this[t+a]);const r=n.length;for(a=0;a<r+s.length;a++)this.items[t+a]=this[t+a]=a<r?n[a]:s[a-r];for(a=this.items.length=this.length-=e-r;this[a];)delete this[a++];return new ne(i)},ae.exclude=function(t){for(let e=0,o=this.length;e<o;e++)if(this[e]==t)return this.splice(e,1),!0},ae.animate=function(e,o,s,i){(t.is(s,"function")||!s)&&(i=s||null);let n,a=this.items.length,r=a;const l=this;let d;if(!a)return this;i&&(d=function(){!--a&&i.call(l)}),s=t.is(s,S)?s:d;const c=t.animation(e,o,s,d);for(n=this.items[--r].animate(c);r--;)this.items[r]&&!this.items[r].removed&&this.items[r].animateWith(n,c,c),this.items[r]&&!this.items[r].removed||a--;return this},ae.insertAfter=function(t){let e=this.items.length;for(;e--;)this.items[e].insertAfter(t);return this},ae.getBBox=function(){let t=[],e=[],o=[],s=[];for(let i=this.items.length;i--;)if(!this.items[i].removed){const n=this.items[i].getBBox();t.push(n.x),e.push(n.y),o.push(n.x+n.width),s.push(n.y+n.height)}return t=w[h](0,t),e=w[h](0,e),o=v[h](0,o),s=v[h](0,s),{x:t,y:e,x2:o,y2:s,width:o-t,height:s-e}},ae.clone=function(t){t=this.paper.set();for(let e=0,o=this.items.length;e<o;e++)t.push(this.items[e].clone());return t},ae.toString=function(){return"Raphaël‘s set"},ae.glow=function(t){const e=this.paper.set();return this.forEach(((o,s)=>{const i=o.glow(t);null!=i&&i.forEach(((t,o)=>{e.push(t)}))})),e},ae.isPointInside=function(t,e){let o=!1;return this.forEach((s=>{if(s.isPointInside(t,e))return o=!0,!1})),o},t.registerFont=function(t){if(!t.face)return t;this.fonts=this.fonts||{};const e={w:t.w,face:{},glyphs:{}},o=t.face["font-family"];for(const o in t.face)t.face[n](o)&&(e.face[o]=t.face[o]);if(this.fonts[o]?this.fonts[o].push(e):this.fonts[o]=[e],!t.svg){e.face["units-per-em"]=M(t.face["units-per-em"],10);for(const o in t.glyphs)if(t.glyphs[n](o)){const s=t.glyphs[o];if(e.glyphs[o]={w:s.w,k:{},d:s.d&&`M${s.d.replace(/[mlcxtrv]/g,(t=>({l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[t]||"M")))}z`},s.k)for(const t in s.k)s[n](t)&&(e.glyphs[o].k[t]=s.k[t])}}return t},d.getFont=function(e,o,s,i){if(i=i||"normal",s=s||"normal",o=+o||{normal:400,bold:700,lighter:300,bolder:800}[o]||400,!t.fonts)return;let a,r=t.fonts[e];if(!r){const o=new RegExp(`(^|\\s)${e.replace(/[^\w\d\s+!~.:_-]/g,u)}(\\s|$)`,"i");for(const e in t.fonts)if(t.fonts[n](e)&&o.test(e)){r=t.fonts[e];break}}if(r)for(let t=0,e=r.length;t<e&&(a=r[t],a.face["font-weight"]!=o||a.face["font-style"]!=s&&a.face["font-style"]||a.face["font-stretch"]!=i);t++);return a},d.print=function(e,s,i,n,a,r,l,d){r=r||"middle",l=v(w(l||0,1),-1),d=v(w(d||1,3),1);const c=g(i).split(u);let h,p=0,f=0,m=u;if(t.is(n,"string")&&(n=this.getFont(n)),n){h=(a||16)/n.face["units-per-em"];const i=n.face.bbox.split(o),u=+i[0],g=i[3]-i[1];let x=0;const b=+i[1]+("baseline"==r?g+ +n.face.descent:g/2);for(let o=0,i=c.length;o<i;o++){if("\n"==c[o])p=0,y=0,f=0,x+=g*d;else{const t=f&&n.glyphs[c[o-1]]||{};var y=n.glyphs[c[o]];p+=f?(t.w||n.w)+(t.k&&t.k[c[o]]||0)+n.w*l:0,f=1}y&&y.d&&(m+=t.transformPath(y.d,["t",p*h,x*h,"s",h,h,u,b,"t",(e-u)/h,(s-b)/h]))}}return this.path(m).attr({fill:"#000",stroke:"none"})},d.add=function(e){if(t.is(e,"array")){var o=this.set();let t=0;const i=e.length;let a;for(;t<i;t++)a=e[t]||{},s[n](a.type)&&o.push(this[a.type]().attr(a))}return o},t.format=function(e,o){const s=t.is(o,E)?[0].concat(o):arguments;return e&&t.is(e,S)&&s.length-1&&(e=e.replace(i,((t,e)=>null==s[++e]?u:s[e]))),e||u},t.fullfill=function(){const t=/\{([^\}]+)\}/g,e=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g;return function(o,s){return String(o).replace(t,((t,o)=>function(t,o,s){let i=s;return o.replace(e,((t,e,o,s,n)=>{e=e||s,i&&(e in i&&(i=i[e]),"function"==typeof i&&n&&(i=i()))})),i=`${null==i||i==s?t:i}`,i}(t,o,s)))}}(),t.ninja=function(){if(r.was)a.win.Raphael=r.is;else{window.Raphael=void 0;try{delete window.Raphael}catch(t){}}return t},t.st=ae,c.on("raphael.DOMload",(()=>{e=!0})),re=document,le="DOMContentLoaded",null==re.readyState&&re.addEventListener&&(re.addEventListener(le,de=function(){re.removeEventListener(le,de,!1),re.readyState="complete"},!1),re.readyState="loading"),function e(){/in/.test(re&&re.readyState)?setTimeout(e,9):t.eve("raphael.DOMload")}(),t}(),p=function(){const t="hasOwnProperty",e=String,o=parseFloat,s=parseInt,i=Math,n=i.max,{abs:a}=i,{pow:r}=i,l=/[, ]+/,d="",p=" ",u="http://www.w3.org/1999/xlink",f={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},g={};var m=function(o,s){if(s){"string"==typeof o&&(o=m(o));for(const i in s)s[t](i)&&("xlink:"==i.substring(0,6)?o.setAttributeNS(u,i.substring(6),e(s[i])):o.setAttribute(i,e(s[i])))}else(o=h._g.doc.createElementNS("http://www.w3.org/2000/svg",o)).style&&(o.style.webkitTapHighlightColor="rgba(0,0,0,0)");return o};const y=function(t,s){let r="linear",l=t.id+s,c=.5,p=.5;const u=t.node,f=t.paper,g=u.style;let y=h._g.doc.getElementById(l);if(!y){if(s=(s=e(s).replace(h._radial_gradient,((t,e,s)=>{if(r="radial",e&&s){c=o(e),p=o(s);const t=2*(p>.5)-1(c-.5)**2+(p-.5)**2>.25&&(p=i.sqrt(.25-(c-.5)**2)*t+.5)&&.5!=p&&(p=p.toFixed(5)-1e-5*t)}return d}))).split(/\s*\-\s*/),"linear"==r){let t=s.shift();if(t=-o(t),isNaN(t))return null;var b=[0,0,i.cos(h.rad(t)),i.sin(h.rad(t))];const e=1/(n(a(b[2]),a(b[3]))||1);b[2]*=e,b[3]*=e,b[2]<0&&(b[0]=-b[2],b[2]=0),b[3]<0&&(b[1]=-b[3],b[3]=0)}const u=h._parseDots(s);if(!u)return null;if(l=l.replace(/[\(\)\s,\xb0#]/g,"_"),t.gradient&&l!=t.gradient.id&&(f.defs.removeChild(t.gradient),delete t.gradient),!t.gradient){y=m(`${r}Gradient`,{id:l}),t.gradient=y,m(y,"radial"==r?{fx:c,fy:p}:{x1:b[0],y1:b[1],x2:b[2],y2:b[3],gradientTransform:t.matrix.invert()}),f.defs.appendChild(y);for(let t=0,e=u.length;t<e;t++)y.appendChild(m("stop",{offset:u[t].offset?u[t].offset:t?"100%":"0%","stop-color":u[t].color||"#fff","stop-opacity":isFinite(u[t].opacity)?u[t].opacity:1}))}}return m(u,{fill:x(l),opacity:1,"fill-opacity":1}),g.fill=d,g.opacity=1,g.fillOpacity=1,1};var x=function(t){return`url('#${t}')`};const b=function(t){if(!t.data("relativeFill")){const e=t.getBBox(1);m(t.pattern,{patternTransform:`${t.matrix.invert()} translate(${e.x},${e.y})`})}},v=function(o,s,i){if("path"==o.type){const n=e(s).toLowerCase().split("-"),a=o.paper,r=i?"end":"start",{node:l}=o,{attrs:c}=o,p=c["stroke-width"];let u,y,x,b,v,w=n.length,k="classic",C=3,_=3,P=5;for(;w--;)switch(n[w]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":k=n[w];break;case"wide":_=5;break;case"narrow":_=2;break;case"long":C=5;break;case"short":C=2}if("open"==k?(C+=2,_+=2,P+=2,x=1,b=i?4:1,v={fill:"none",stroke:c.stroke}):(b=x=C/2,v={fill:c.stroke,stroke:"none"}),o._.arrows?i?(o._.arrows.endPath&&g[o._.arrows.endPath]--,o._.arrows.endMarker&&g[o._.arrows.endMarker]--):(o._.arrows.startPath&&g[o._.arrows.startPath]--,o._.arrows.startMarker&&g[o._.arrows.startMarker]--):o._.arrows={},"none"!=k){const t=`raphael-marker-${k}`,e=`raphael-marker-${r}${k}${C}${_}-obj${o.id}`;!h._g.doc.getElementById(t)||h._g.doc.getElementById(t)&&"none"===getComputedStyle(h._g.doc.getElementById(t)).display?(a.defs.appendChild(m(m("path"),{"stroke-linecap":"round",d:f[k],id:t})),g[t]=1):g[t]++;let n,w=h._g.doc.getElementById(e);w?(g[e]++,n=w.getElementsByTagName("use")[0]):(w=m(m("marker"),{id:e,markerHeight:_,markerWidth:C,orient:"auto",refX:b,refY:_/2}),n=m(m("use"),{"xlink:href":`#${t}`,transform:`${i?`rotate(180 ${C/2} ${_/2}) `:d}scale(${C/P},${_/P})`,"stroke-width":(1/((C/P+_/P)/2)).toFixed(4)}),w.appendChild(n),a.defs.appendChild(w),g[e]=1),m(n,v);const S=x*("diamond"!=k&&"oval"!=k);i?(u=o._.arrows.startdx*p||0,y=h.getTotalLength(c.path)-S*p):(u=S*p,y=h.getTotalLength(c.path)-(o._.arrows.enddx*p||0)),v={},v[`marker-${r}`]=`url(#${e})`,(y||u)&&(v.d=h.getSubpath(c.path,u,y)),m(l,v),o._.arrows[`${r}Path`]=t,o._.arrows[`${r}Marker`]=e,o._.arrows[`${r}dx`]=S,o._.arrows[`${r}Type`]=k,o._.arrows[`${r}String`]=s}else i?(u=o._.arrows.startdx*p||0,y=h.getTotalLength(c.path)-u):(u=0,y=h.getTotalLength(c.path)-(o._.arrows.enddx*p||0)),o._.arrows[`${r}Path`]&&m(l,{d:h.getSubpath(c.path,u,y)}),delete o._.arrows[`${r}Path`],delete o._.arrows[`${r}Marker`],delete o._.arrows[`${r}dx`],delete o._.arrows[`${r}Type`],delete o._.arrows[`${r}String`];for(v in g)if(g[t](v)&&!g[v]){const t=h._g.doc.getElementById(v);t&&t.parentNode.removeChild(t)}}},w={"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},k=function(t,o,s){if(o=w[e(o).toLowerCase()]){const e=t.attrs["stroke-width"]||"1",i={round:e,square:e,butt:0}[t.attrs["stroke-linecap"]||s["stroke-linecap"]]||0,n=[];let a=o.length;for(;a--;)n[a]=o[a]*e+(a%2?1:-1)*i;m(t.node,{"stroke-dasharray":n.join(",")})}else m(t.node,{"stroke-dasharray":"none"})},C=function(o,i){const{node:r}=o,{attrs:c}=o,p=r.style.visibility;r.style.visibility="hidden";for(let p in i)if(i[t](p)){if(!h._availableAttrs[t](p))continue;let _=i[p];switch(c[p]=_,p){case"blur":o.blur(_);break;case"title":var f=r.getElementsByTagName("title");if(f.length&&(f=f[0]))f.firstChild.nodeValue=_;else{f=m("title");const t=h._g.doc.createTextNode(_);f.appendChild(t),r.appendChild(f)}break;case"href":case"target":var g=r.parentNode;if("a"!=g.tagName.toLowerCase()){const t=m("a");g.insertBefore(t,r),t.appendChild(r),g=t}"target"==p?g.setAttributeNS(u,"show","blank"==_?"new":_):g.setAttributeNS(u,p,_);break;case"cursor":r.style.cursor=_;break;case"transform":o.transform(_);break;case"arrow-start":v(o,_);break;case"arrow-end":v(o,_,1);break;case"clip-rect":var x=e(_).split(l);if(4==x.length){o.clip&&o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);var w=m("clipPath");const t=m("rect");w.id=h.createUUID(),m(t,{x:x[0],y:x[1],width:x[2],height:x[3]}),w.appendChild(t),o.paper.defs.appendChild(w),m(r,{"clip-path":`url(#${w.id})`}),o.clip=t}if(!_){const t=r.getAttribute("clip-path");if(t){const e=h._g.doc.getElementById(t.replace(/(^url\(#|\)$)/g,d));e&&e.parentNode.removeChild(e),m(r,{"clip-path":d}),delete o.clip}}break;case"path":"path"==o.type&&(m(r,{d:_?c.path=_:"M0,0"}),o._.dirty=1,o._.arrows&&("startString"in o._.arrows&&v(o,o._.arrows.startString),"endString"in o._.arrows&&v(o,o._.arrows.endString,1)));break;case"width":if(r.setAttribute(p,_),o._.dirty=1,!c.fx)break;p="x",_=c.x;case"x":c.fx&&(_=-c.x-(c.width||0));case"rx":if("rx"==p&&"rect"==o.type)break;case"cx":r.setAttribute(p,_),o.pattern&&b(o),o._.dirty=1;break;case"height":if(r.setAttribute(p,_),o._.dirty=1,!c.fy)break;p="y",_=c.y;case"y":c.fy&&(_=-c.y-(c.height||0));case"ry":if("ry"==p&&"rect"==o.type)break;case"cy":r.setAttribute(p,_),o.pattern&&b(o),o._.dirty=1;break;case"r":"rect"==o.type?m(r,{rx:_,ry:_}):r.setAttribute(p,_),o._.dirty=1;break;case"src":"image"==o.type&&r.setAttributeNS(u,"href",_);break;case"stroke-width":1==o._.sx&&1==o._.sy||(_/=n(a(o._.sx),a(o._.sy))||1),r.setAttribute(p,_),c["stroke-dasharray"]&&k(o,c["stroke-dasharray"],i),o._.arrows&&("startString"in o._.arrows&&v(o,o._.arrows.startString),"endString"in o._.arrows&&v(o,o._.arrows.endString,1));break;case"stroke-dasharray":k(o,_,i);break;case"fill":var C=o.data("relativeFill"),P=e(_).match(h._ISURL);if(P){if(_.indexOf("(#")>-1)m(r,{fill:_});else{w=m("pattern");var S=m("image");w.id=h.createUUID(),m(w,{x:0,y:0,patternUnits:C?"objectBoundingBox":"userSpaceOnUse",height:1,width:1}),m(S,{x:0,y:0,"xlink:href":P[1]}),w.appendChild(S),function(t){h._preload(P[1],(function(){const e=this.offsetWidth,s=this.offsetHeight,i=o.paper.path(o.attr("path")),n=i.getBBox();m(t,{width:C?1:e,height:C?1:s}),m(S,{width:C?o.imageOrigWidth||n.width:e,height:C?o.imageOrigHeight||n.height:s}),delete o.imageOrigHeight,delete o.imageOrigWidth,i.remove()}))}(w),o.paper.defs.appendChild(w),m(r,{fill:`url(#${w.id})`}),o.pattern=w,o.pattern&&b(o)}break}var E=h.getRGB(_);if(E.error){if(("circle"==o.type||"ellipse"==o.type||"r"!=e(_).charAt())&&y(o,_)){if("opacity"in c||"fill-opacity"in c){var A=h._g.doc.getElementById(r.getAttribute("fill").replace(/^url\(#|\)$/g,d));if(A){var T=A.getElementsByTagName("stop");m(T[T.length-1],{"stop-opacity":("opacity"in c?c.opacity:1)*("fill-opacity"in c?c["fill-opacity"]:1)})}}c.gradient=_,c.fill="none";break}}else delete i.gradient,delete c.gradient,!h.is(c.opacity,"undefined")&&h.is(i.opacity,"undefined")&&m(r,{opacity:c.opacity}),!h.is(c["fill-opacity"],"undefined")&&h.is(i["fill-opacity"],"undefined")&&m(r,{"fill-opacity":c["fill-opacity"]});E[t]("opacity")&&m(r,{"fill-opacity":E.opacity>1?E.opacity/100:E.opacity});case"stroke":E=h.getRGB(_),r.setAttribute(p,E.hex),"stroke"==p&&E[t]("opacity")&&m(r,{"stroke-opacity":E.opacity>1?E.opacity/100:E.opacity}),"stroke"==p&&o._.arrows&&("startString"in o._.arrows&&v(o,o._.arrows.startString),"endString"in o._.arrows&&v(o,o._.arrows.endString,1));break;case"gradient":("circle"==o.type||"ellipse"==o.type||"r"!=e(_).charAt())&&y(o,_);break;case"opacity":c.gradient&&!c[t]("stroke-opacity")&&m(r,{"stroke-opacity":_>1?_/100:_});case"fill-opacity":if(c.gradient){(A=h._g.doc.getElementById(r.getAttribute("fill").replace(/^url\(#|\)$/g,d)))&&(T=A.getElementsByTagName("stop"),m(T[T.length-1],{"stop-opacity":_}));break}default:"font-size"==p&&(_=`${s(_,10)}px`);var B=p.replace(/(\-.)/g,(t=>t.substring(1).toUpperCase()));r.style[B]=_,o._.dirty=1,r.setAttribute(p,_)}}_(o,i),r.style.visibility=p};var _=function(o,i){if("text"!=o.type||!(i[t]("text")||i[t]("font")||i[t]("font-size")||i[t]("x")||i[t]("y")))return;const n=o.attrs,{node:a}=o,r=a.firstChild?s(h._g.doc.defaultView.getComputedStyle(a.firstChild,d).getPropertyValue("font-size"),10):10;if(i[t]("text")){for(n.text=i.text;a.firstChild;)a.removeChild(a.firstChild);const t=e(i.text).split("\n");var l=[];let o;for(var c=0,p=t.length;c<p;c++)o=m("tspan"),c&&m(o,{dy:1.2*r,x:n.x}),o.appendChild(h._g.doc.createTextNode(t[c])),a.appendChild(o),l[c]=o}else for(c=0,p=(l=a.getElementsByTagName("tspan")).length;c<p;c++)c?m(l[c],{dy:1.2*r,x:n.x}):m(l[0],{dy:0});m(a,{x:n.x,y:n.y}),o._.dirty=1;const u=o._getBBox(),f=n.y-(u.y+u.height/2);f&&h.is(f,"finite")&&m(l[0],{dy:f})};const P=function(t){return t.parentNode&&"a"===t.parentNode.tagName.toLowerCase()?t.parentNode:t},S=function(t,e){this[0]=this.node=t,t.raphael=!0,this.id=`0000${(Math.random()*36**5<<0).toString(36)}`.slice(-5),t.raphaelid=this.id,this.matrix=h.matrix(),this.realPath=null,this.paper=e,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!e.bottom&&(e.bottom=this),this.prev=e.top,e.top&&(e.top.next=this),e.top=this,this.next=null},E=h.el;S.prototype=E,E.constructor=S,h._engine.path=function(t,e){const o=m("path");e.canvas&&e.canvas.appendChild(o);const s=new S(o,e);return s.type="path",C(s,{fill:"none",stroke:"#000",path:t}),s},E.rotate=function(t,s,i){if(this.removed)return this;if((t=e(t).split(l)).length-1&&(s=o(t[1]),i=o(t[2])),t=o(t[0]),null==i&&(s=i),null==s||null==i){const t=this.getBBox(1);s=t.x+t.width/2,i=t.y+t.height/2}return this.transform(this._.transform.concat([["r",t,s,i]])),this},E.scale=function(t,s,i,n){if(this.removed)return this;if((t=e(t).split(l)).length-1&&(s=o(t[1]),i=o(t[2]),n=o(t[3])),t=o(t[0]),null==s&&(s=t),null==n&&(i=n),null==i||null==n)var a=this.getBBox(1);return i=null==i?a.x+a.width/2:i,n=null==n?a.y+a.height/2:n,this.transform(this._.transform.concat([["s",t,s,i,n]])),this},E.translate=function(t,s){return this.removed||((t=e(t).split(l)).length-1&&(s=o(t[1])),t=o(t[0])||0,s=+s||0,this.transform(this._.transform.concat([["t",t,s]]))),this},E.transform=function(e){const{_:o}=this;if(null==e)return o.transform;if(h._extractTransform(this,e),this.clip&&m(this.clip,{transform:this.matrix.invert()}),this.pattern&&b(this),this.node&&m(this.node,{transform:this.matrix}),1!=o.sx||1!=o.sy){const e=this.attrs[t]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":e})}return this},E.hide=function(){return this.removed||(this.node.style.display="none"),this},E.show=function(){return this.removed||(this.node.style.display=""),this},E.remove=function(){const t=P(this.node);if(this.removed||!t.parentNode)return;const{paper:e}=this;e.__set__&&e.__set__.exclude(this),c.unbind(`raphael.*.*.${this.id}`),this.gradient&&e.defs.removeChild(this.gradient),h._tear(this,e),t.parentNode.removeChild(t),this.removeData();for(const t in this)this[t]="function"==typeof this[t]?h._removedFactory(t):null;this.removed=!0},E._getBBox=function(){if("none"==this.node.style.display){this.show();var t=!0}let e,o=!1;this.paper.canvas.parentElement?e=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(e=this.paper.canvas.parentNode.style),e&&"none"==e.display&&(o=!0,e.display="");let s={};try{s=this.node.getBBox()}catch(t){s={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{s=s||{},o&&(e.display="none")}return t&&this.hide(),s},E.attr=function(e,o){if(this.removed)return this;if(null==e){const e={};for(const o in this.attrs)this.attrs[t](o)&&(e[o]=this.attrs[o]);return e.gradient&&"none"==e.fill&&(e.fill=e.gradient)&&delete e.gradient,e.transform=this._.transform,e}if(null==o&&h.is(e,"string")){if("fill"==e&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==e)return this._.transform;const t=e.split(l);for(var s={},i=0,n=t.length;i<n;i++)(e=t[i])in this.attrs?s[e]=this.attrs[e]:h.is(this.paper.customAttributes[e],"function")?s[e]=this.paper.customAttributes[e].def:s[e]=h._availableAttrs[e];return n-1?s:s[t[0]]}if(null==o&&h.is(e,"array")){for(s={},i=0,n=e.length;i<n;i++)s[e[i]]=this.attr(e[i]);return s}if(null!=o){var a={};a[e]=o}else null!=e&&h.is(e,"object")&&(a=e);for(var r in a)c(`raphael.attr.${r}.${this.id}`,this,a[r]);for(r in this.paper.customAttributes)if(this.paper.customAttributes[t](r)&&a[t](r)&&h.is(this.paper.customAttributes[r],"function")){const e=this.paper.customAttributes[r].apply(this,[].concat(a[r]));this.attrs[r]=a[r];for(const o in e)e[t](o)&&(a[o]=e[o])}return C(this,a),this},E.toFront=function(){if(this.removed)return this;const t=P(this.node);t.parentNode.appendChild(t);const e=this.paper;return e.top!=this&&h._tofront(this,e),this},E.toBack=function(){if(this.removed)return this;const t=P(this.node),{parentNode:e}=t;e.insertBefore(t,e.firstChild),h._toback(this,this.paper);this.paper;return this},E.insertAfter=function(t){if(this.removed||!t)return this;const e=P(this.node),o=P(t.node||t[t.length-1].node);return o.nextSibling?o.parentNode.insertBefore(e,o.nextSibling):o.parentNode.appendChild(e),h._insertafter(this,t,this.paper),this},E.insertBefore=function(t){if(this.removed||!t)return this;const e=P(this.node),o=P(t.node||t[0].node);return o.parentNode.insertBefore(e,o),h._insertbefore(this,t,this.paper),this},E.blur=function(t){const e=this;if(0!=+t){const o=m("filter"),s=m("feGaussianBlur");e.attrs.blur=t,o.id=h.createUUID(),m(s,{stdDeviation:+t||1.5}),o.appendChild(s),e.paper.defs.appendChild(o),e._blur=o,m(e.node,{filter:`url(#${o.id})`})}else e._blur&&(e._blur.parentNode.removeChild(e._blur),delete e._blur,delete e.attrs.blur),e.node.removeAttribute("filter");return e},h._engine.circle=function(t,e,o,s){const i=m("circle");t.canvas&&t.canvas.appendChild(i);const n=new S(i,t);return n.attrs={cx:e,cy:o,r:s,fill:"none",stroke:"#000"},n.type="circle",m(i,n.attrs),n},h._engine.rect=function(t,e,o,s,i,n){const a=m("rect");t.canvas&&t.canvas.appendChild(a);const r=new S(a,t);return r.attrs={x:e,y:o,width:s,height:i,rx:n||0,ry:n||0,fill:"none",stroke:"#000"},r.type="rect",m(a,r.attrs),r},h._engine.g=function(t){const e=m("g");t.canvas&&t.canvas.appendChild(e);const o=new S(e,t);o.type="g",o.canvas=o.node;return["circle","rect","ellipse","image","text","g","path"].forEach((t=>{o[t]=function(){const e=[o];for(let t=0;t<arguments.length;t++)e.push(arguments[t]);const s=h._engine[t].apply(this,e);return s}})),m(e,o.attrs),o},h._engine.def=function(t){const e=t.id||`raphael-def-${h.createUUID()}`,o=Array.prototype.slice.call(this.defs.children).find((t=>t.getAttribute("id")===e));o&&this.defs.removeChild(o);const s={id:e};Object.assign(s,{...t}),delete s.inside;const i=m(m(t.tag||"pattern"),s);t.inside&&t.inside.forEach((t=>{const e=m(m(t.type),t.attrs||{});i.appendChild(e),t.nested&&(t.nested.forEach?t.nested.forEach((t=>{const o=m(m(t.type),t.attrs||{});e.appendChild(o)})):Object.keys(t.nested).forEach((o=>{const s=m(m(o),t.nested[o]||{});e.appendChild(s)})))})),this.defs.appendChild(i)},h._engine.ellipse=function(t,e,o,s,i){const n=m("ellipse");t.canvas&&t.canvas.appendChild(n);const a=new S(n,t);return a.attrs={cx:e,cy:o,rx:s,ry:i,fill:"none",stroke:"#000"},a.type="ellipse",m(n,a.attrs),a},h._engine.image=function(t,e,o,s,i,n){const a=m("image");m(a,{x:o,y:s,width:i,height:n,preserveAspectRatio:"none"}),a.setAttributeNS(u,"href",e),t.canvas&&t.canvas.appendChild(a);const r=new S(a,t);return r.attrs={x:o,y:s,width:i,height:n,src:e},r.type="image",r},h._engine.text=function(t,e,o,s){const i=m("text");t.canvas&&t.canvas.appendChild(i);const n=new S(i,t);return n.attrs={x:e,y:o,"text-anchor":"middle",text:s,"font-family":h._availableAttrs["font-family"],"font-size":h._availableAttrs["font-size"],stroke:"none",fill:"#000"},n.type="text",C(n,n.attrs),n},h._engine.setSize=function(t,e){return this.width=t||this.width,this.height=e||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},h._engine.create=function(){const t=h._getContainer.apply(0,arguments);let e=t&&t.container,{x:o}=t,{y:s}=t,{width:i}=t,{height:n}=t;if(!e)throw new Error("SVG container not found.");const a=m("svg"),r="overflow:hidden;";let l;return o=o||0,s=s||0,i=i||512,n=n||342,m(a,{height:n,width:i,xmlns:"http://www.w3.org/2000/svg"}),1==e?(a.style.cssText=`${r}position:absolute;left:${o}px;top:${s}px`,h._g.doc.body.appendChild(a),l=1):(a.style.cssText=`${r}position:relative`,e.firstChild?e.insertBefore(a,e.firstChild):e.appendChild(a)),e=new h._Paper,e.width=i,e.height=n,e.canvas=a,e.clear(),e._left=e._top=0,l&&(e.renderfix=function(){}),e.renderfix(),e},h._engine.setViewBox=function(t,e,o,s,i){c("raphael.setViewBox",this,this._viewBox,[t,e,o,s,i]);const a=this.getSize();let r=n(o/a.width,s/a.height),{top:l}=this;const d=i?"xMidYMid meet":"xMinYMin";let h,u;for(null==t?(this._vbSize&&(r=1),delete this._vbSize,h=`0 0 ${this.width} ${this.height}`):(this._vbSize=r,h=t+p+e+p+o+p+s),m(this.canvas,{viewBox:h,preserveAspectRatio:d});r&&l;)u="stroke-width"in l.attrs?l.attrs["stroke-width"]:1,l.attr({"stroke-width":u}),l._.dirty=1,l._.dirtyT=1,l=l.prev;return this._viewBox=[t,e,o,s,!!i],this},h.prototype.renderfix=function(){const t=this.canvas,e=t.style;let o;try{o=t.getScreenCTM()||t.createSVGMatrix()}catch(e){o=t.createSVGMatrix()}const s=-o.e%1,i=-o.f%1;(s||i)&&(s&&(this._left=(this._left+s)%1,e.left=`${this._left}px`),i&&(this._top=(this._top+i)%1,e.top=`${this._top}px`))},h.prototype.clear=function(){h.eve("raphael.clear",this);const t=this.canvas;for(;t.firstChild;)t.removeChild(t.firstChild);this.bottom=this.top=null,t.appendChild(this.defs=m("defs"))},h.prototype.remove=function(){c("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(const t in this)this[t]="function"==typeof this[t]?h._removedFactory(t):null};const A=h.st;for(const e in E)E[t](e)&&!A[t](e)&&(A[e]=function(t){return function(){const e=arguments;return this.forEach((o=>{o[t].apply(o,e)}))}}(e));return h}();class u{static easing={elastic:t=>-1*4**(-8*t)*Math.sin((6*t-1)*(2*Math.PI)/2)+1,swingFromTo(t){let e=1.70158;return(t/=.5)<1?t*t*((1+(e*=1.525))*t-e)*.5:.5*((t-=2)*t*((1+(e*=1.525))*t+e)+2)},swingFrom(t){const e=1.70158;return t*t*((e+1)*t-e)},swingTo(t){const e=1.70158;return(t-=1)*t*((e+1)*t+e)+1},bounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,bouncePast:t=>t<1/2.75?7.5625*t*t:t<2/2.75?2-(7.5625*(t-=1.5/2.75)*t+.75):t<2.5/2.75?2-(7.5625*(t-=2.25/2.75)*t+.9375):2-(7.5625*(t-=2.625/2.75)*t+.984375),easeFromTo:t=>(t/=.5)<1?.5*t**4:-.5*((t-=2)*t**3-2),easeFrom:t=>t**4,easeTo:t=>t**.25,none:t=>-Math.cos(t*Math.PI)/2+.5};static availColors=[{hex:"000000",to:"575757",fore:"fff"},{hex:"FFFFFF",to:"d9d9d9",fore:"000"},{hex:"FF0000",to:"a31616",fore:"000"},{hex:"C3FF68",to:"afff68",fore:"000"},{hex:"0B486B",to:"3B88B5",fore:"fff"},{hex:"FBB829",to:"cd900e",fore:"000"},{hex:"BFF202",to:"D1F940",fore:"000"},{hex:"FF0066",to:"aa1d55",fore:"000"},{hex:"800F25",to:"3d0812",fore:"fff"},{hex:"A40802",to:"d70b03",fore:"fff"},{hex:"FF5EAA",to:"cf5d93",fore:"000"},{hex:"740062",to:"D962C6",fore:"fff"},{hex:"FF4242",to:"A61515",fore:"fff"},{hex:"D15C57",to:"9D5C58",fore:"000"},{hex:"FCFBE3",to:"c9c56f",fore:"000"},{hex:"FF9900",to:"c98826",fore:"000"},{hex:"369001",to:"9CEE6C",fore:"000"},{hex:"9E906E",to:"675324",fore:"fff"},{hex:"F3D915",to:"F9EA7C",fore:"000"},{hex:"031634",to:"2D579A",fore:"fff"},{hex:"556270",to:"7b92ab",fore:"fff"},{hex:"1693A5",to:"23aad6",fore:"fff"},{hex:"ADD8C7",to:"59a989",fore:"000"},{special:{color:{hex:"8D5800",to:"EB9605"},other:{transparent:!0}}}];static polygonCache={};static async pause(t){return new Promise((e=>{window.setTimeout((()=>{e()}),t)}))}static windowSize(){let t=0,e=0;return window.innerWidth?(t=window.innerWidth,e=window.innerHeight):0!=document.documentElement.clientWidth?(t=document.documentElement.clientWidth,e=document.documentElement.clientHeight):(t=document.body.clientWidth,e=document.body.clientHeight),{width:t,height:e}}static isElement(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName}static el(t){return t.indexOf("#")>-1||t.indexOf(".")>-1?document.querySelector(t):document.getElementById(t)}static select(t){const e=[],o=t.indexOf(".");if(-1!==o){const s=t.slice(0,o)||"*",i=t.slice(o+1,t.length),n=document.getElementsByTagName(s);for(let t=0;t<n.length;t+=1){const o=n[t];o.className&&-1!==o.className.indexOf(i)&&e.push(o)}}return e}static getKey(t){let e=0;try{e=t.keyCode}catch(o){e=t.which}return e}static stopEvent(t){return(t=t||window.event).preventDefault?(t.stopPropagation(),t.preventDefault()):(t.returnValue=!1,t.cancelBubble=!0),!1}static toShortDateString(t){let e=t;try{const o=new Date(parseInt(t.substr(6),10));e=`${o.getMonth()+1}/${o.getDate()}/${o.getFullYear()}`}catch(t){}return e}static addEvent(t,e,o){t.addEventListener(e,o)}static removeEvent(t,e,o){t.removeEventListener(e,o)}static bind(t,e,o){t[e]=t[e]||[],t[e].push(o)}static imageExists(t,e,o){const s=`temp_${u.guid()}`,i=document.body.appendChild(document.createElement("img"));i.style.position="absolute",i.style.top="-10000px",i.style.left="-10000px",i.setAttribute("src",t),i.setAttribute("id",s),this.addEvent(i,"load",(function(t){const s=getDimensions(i);document.body.removeChild(i),e.apply(this,[!0,s.width,s.height,o])})),this.addEvent(i,"error",(function(t){document.body.removeChild(i),e.apply(this,[!1,0,0,o])}))}static ajax(t,e,o,s,i,n){i=this.ActiveXObject,t=[t,-1===t.indexOf("?")?"?":"&",`guid=${u.guid()}`].join("");const a=o?s||"POST":s||"GET";(i=new(i||XMLHttpRequest)("Microsoft.XMLHTTP")).open(a,t,1),i.setRequestHeader("Content-type","application/json; charset=utf-8"),n.forEach((t=>{i.setRequestHeader(t.n,t.v)})),i.onreadystatechange=()=>{i.readyState>3&&e&&e(i.responseText,i)},i.send(o)}static hasClass(t,e){t.classList?t.classList.contains(e):new RegExp(`(^| )${e}( |$)`,"gi").test(t.className)}static addClass(t,e){t.classList?t.classList.add(e):t.className+=` ${e}`}static S4(){return(65536*(1+Math.random())|0).toString(16).substring(1)}static guid(t){let e=this.S4()+this.S4()+this.S4();return t&&(e=e.replace(/-/gi,"").substring(0,t).toUpperCase()),e}static getJSON(t,e){const o=this.S4()+this.S4();let s=document.createElement("script");window[`__jsonp${o}`]=e,s.src=t.replace(/\?(&|$)/,`__jsonp${o}$1`),s.onload=()=>{s=null},document.getElementsByTagName("head")[0].appendChild(s)}static getBBox(t){const e=document.createElement("div");e.setAttribute("id","hiddenPaper"),e.style.display="none",document.body.appendChild(e);const o=new p(e).path(t.path).getBBox();return document.body.removeChild(e),o}static positionedOffset(t){let e=0,o=0;if(t.offsetParent)do{e+=t.offsetLeft,o+=t.offsetTop}while(t=t.offsetParent);return{left:e,top:o}}static getDimensions(t){let e=0,o=0;return void 0!==t.clip?(e=t.clip.width,o=t.clip.height):t.style?.pixelWidth?(e=t.style.pixelWidth,o=t.style.pixelHeight):(e=t.offsetWidth,o=t.offsetHeight),{width:e,height:o}}static mousePos(t){let e=null,o=null;const s=[];if(t.targetTouches){if(t.targetTouches.length){const i=t.targetTouches[0];e=i.clientX,o=i.clientY,t.targetTouches.forEach((e=>{s.push({x:t.targetTouches[e].clientX,y:t.targetTouches[e].clientY})}))}}else e=t.pageX,o=t.pageY;return{x:e,y:o,allTouches:s}}static centerAndScalePathToFitContainer(t){let e=this.getBBox({path:t.path});const o=t.scaleSize/Math.max(e.width,e.height);let s=this._transformPath(t.path,["s",o,",",o].join(""));e=this.getBBox({path:s});const i=["T",-1*e.x+(t.containerSize-e.width)/2,",",-1*e.y+(t.containerSize-e.height)/2].join("");return s=this._transformPath(s,i),{path:s,width:e.width,height:e.height}}static buildStyle(t){let e="";return Object.keys(t).forEach((o=>{e+=`${o}:${t[o]};`})),e}static whiteOrBlack(t){return p.rgb2hsb(t).b<.4?"#fff":"#000"}static _transformPath(t,e){return p.transformPath(t,e).toString()}static transformPath(t,e){const o=p.transformPath(t.vect.attr("path").toString(),e).toString();t.options.vectorPath=o,t.vect.transform(""),t.vect.attr({path:t.options.vectorPath});const s=t.vect.getBBox(),i={point:{x:s.cx,y:s.cy}};Object.assign(t.options.rotate,i);const n=t.getTransformString();t.vect.transform(n),t.text.transform(""),t.text.attr(t.textCoords({x:t.options.xPos,y:t.options.yPos})),t.text.transform(n)}static htmlToElement(t){const e=document.createElement("template");return t=t.trim(),e.innerHTML=t,e.content.firstChild}static getTextWidth(t,e){const o=t.split("\n"),s=document.createElement("canvas"),i=[];o.forEach((t=>{const o=s.getContext("2d");o.font=e,i.push(o.measureText(t))})),s.remove();let n=0;i.forEach((t=>n+=t.fontBoundingBoxAscent+t.fontBoundingBoxDescent));const a={width:Math.max(...i.map((t=>t.width))),height:n};return console.log("red is ",a),a}static toDataUrl=t=>fetch(t,{mode:"cors"}).then((t=>t.blob())).then((t=>new Promise(((e,o)=>{const s=new FileReader;s.onloadend=()=>e(s.result),s.onerror=o,s.readAsDataURL(t)}))))}function f(t,e){let o=e,s=t;return e.find||"string"!=typeof e||(o=[e]),o.forEach((t=>{s=u._transformPath(s,t).toString()})),s}class g{static icons={handle:"M26.33,15.836l-3.893-1.545l3.136-7.9c0.28-0.705-0.064-1.505-0.771-1.785c-0.707-0.28-1.506,0.065-1.785,0.771l-3.136,7.9l-4.88-1.937l3.135-7.9c0.281-0.706-0.064-1.506-0.77-1.786c-0.706-0.279-1.506,0.065-1.785,0.771l-3.136,7.9L8.554,8.781l-1.614,4.066l2.15,0.854l-2.537,6.391c-0.61,1.54,0.143,3.283,1.683,3.895l1.626,0.646L8.985,26.84c-0.407,1.025,0.095,2.188,1.122,2.596l0.93,0.369c1.026,0.408,2.188-0.095,2.596-1.121l0.877-2.207l1.858,0.737c1.54,0.611,3.284-0.142,3.896-1.682l2.535-6.391l1.918,0.761L26.33,15.836z",editor:"M25.31,2.872l-3.384-2.127c-0.854-0.536-1.979-0.278-2.517,0.576l-1.334,2.123l6.474,4.066l1.335-2.122C26.42,4.533,26.164,3.407,25.31,2.872zM6.555,21.786l6.474,4.066L23.581,9.054l-6.477-4.067L6.555,21.786zM5.566,26.952l-0.143,3.819l3.379-1.787l3.14-1.658l-6.246-3.925L5.566,26.952z",deleter:"M24.778,21.419 19.276,15.917 24.777,10.415 21.949,7.585 16.447,13.087 10.945,7.585 8.117,10.415 13.618,15.917 8.116,21.419 10.946,24.248 16.447,18.746 21.948,24.248z",searcher:"M29.772,26.433l-7.126-7.126c0.96-1.583,1.523-3.435,1.524-5.421C24.169,8.093,19.478,3.401,13.688,3.399C7.897,3.401,3.204,8.093,3.204,13.885c0,5.789,4.693,10.481,10.484,10.481c1.987,0,3.839-0.563,5.422-1.523l7.128,7.127L29.772,26.433zM7.203,13.885c0.006-3.582,2.903-6.478,6.484-6.486c3.579,0.008,6.478,2.904,6.484,6.486c-0.007,3.58-2.905,6.476-6.484,6.484C10.106,20.361,7.209,17.465,7.203,13.885z",up:"M1.67892,15.48059l23.55337,0l-11.37616,-13.92457l-12.17721,13.92457z",arrow:"M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466zM13.665,25.725l-3.536-3.539l6.187-6.187l-6.187-6.187l3.536-3.536l9.724,9.723L13.665,25.725z",settings:"M16.015,12.03c-2.156,0-3.903,1.747-3.903,3.903c0,2.155,1.747,3.903,3.903,3.903c0.494,0,0.962-0.102,1.397-0.27l0.836,1.285l1.359-0.885l-0.831-1.276c0.705-0.706,1.142-1.681,1.142-2.757C19.918,13.777,18.171,12.03,16.015,12.03zM16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466zM26.174,20.809c-0.241,0.504-0.513,0.99-0.826,1.45L22.19,21.58c-0.481,0.526-1.029,0.994-1.634,1.385l0.119,3.202c-0.507,0.23-1.028,0.421-1.569,0.57l-1.955-2.514c-0.372,0.051-0.75,0.086-1.136,0.086c-0.356,0-0.706-0.029-1.051-0.074l-1.945,2.5c-0.541-0.151-1.065-0.342-1.57-0.569l0.117-3.146c-0.634-0.398-1.208-0.88-1.712-1.427L6.78,22.251c-0.313-0.456-0.583-0.944-0.826-1.448l2.088-2.309c-0.226-0.703-0.354-1.451-0.385-2.223l-2.768-1.464c0.055-0.563,0.165-1.107,0.301-1.643l3.084-0.427c0.29-0.702,0.675-1.352,1.135-1.942L8.227,7.894c0.399-0.389,0.83-0.744,1.283-1.07l2.663,1.672c0.65-0.337,1.349-0.593,2.085-0.75l0.968-3.001c0.278-0.021,0.555-0.042,0.837-0.042c0.282,0,0.56,0.022,0.837,0.042l0.976,3.028c0.72,0.163,1.401,0.416,2.036,0.75l2.704-1.697c0.455,0.326,0.887,0.681,1.285,1.07l-1.216,2.986c0.428,0.564,0.793,1.181,1.068,1.845l3.185,0.441c0.135,0.535,0.247,1.081,0.302,1.643l-2.867,1.516c-0.034,0.726-0.15,1.43-0.355,2.1L26.174,20.809z",sliderHandle:"M16,3.5c-4.142,0-7.5,3.358-7.5,7.5c0,4.143,7.5,18.121,7.5,18.121S23.5,15.143,23.5,11C23.5,6.858,20.143,3.5,16,3.5z M16,14.584z",speechbubble:"M16,5.333c-7.732,0-14,4.701-14,10.5c0,1.982,0.741,3.833,2.016,5.414L2,25.667l5.613-1.441c2.339,1.317,5.237,2.107,8.387,2.107c7.732,0,14-4.701,14-10.5C30,10.034,23.732,5.333,16,5.333z",link:"M15.667,4.601c-1.684,1.685-2.34,3.985-2.025,6.173l3.122-3.122c0.004-0.005,0.014-0.008,0.016-0.012c0.21-0.403,0.464-0.789,0.802-1.126c1.774-1.776,4.651-1.775,6.428,0c1.775,1.773,1.777,4.652,0.002,6.429c-0.34,0.34-0.727,0.593-1.131,0.804c-0.004,0.002-0.006,0.006-0.01,0.01l-3.123,3.123c2.188,0.316,4.492-0.34,6.176-2.023c2.832-2.832,2.83-7.423,0-10.255C23.09,1.77,18.499,1.77,15.667,4.601zM14.557,22.067c-0.209,0.405-0.462,0.791-0.801,1.131c-1.775,1.774-4.656,1.774-6.431,0c-1.775-1.774-1.775-4.653,0-6.43c0.339-0.338,0.725-0.591,1.128-0.8c0.004-0.006,0.005-0.012,0.011-0.016l3.121-3.123c-2.187-0.316-4.489,0.342-6.172,2.024c-2.831,2.831-2.83,7.423,0,10.255c2.833,2.831,7.424,2.831,10.257,0c1.684-1.684,2.342-3.986,2.023-6.175l-3.125,3.123C14.565,22.063,14.561,22.065,14.557,22.067zM9.441,18.885l2.197,2.197c0.537,0.537,1.417,0.537,1.953,0l8.302-8.302c0.539-0.536,0.539-1.417,0.002-1.952l-2.199-2.197c-0.536-0.539-1.416-0.539-1.952-0.002l-8.302,8.303C8.904,17.469,8.904,18.349,9.441,18.885z",copy:"M 20.48 7.28 H 9.92 c -0.968 0 -1.76 0.792 -1.76 1.76 v 12.32 h 1.76 V 9.04 h 10.56 V 7.28 z m 2.64 3.52 H 13.44 c -0.968 0 -1.76 0.792 -1.76 1.76 v 12.32 c 0 0.968 0.792 1.76 1.76 1.76 h 9.68 c 0.968 0 1.76 -0.792 1.76 -1.76 V 12.56 c 0 -0.968 -0.792 -1.76 -1.76 -1.76 z m 0 14.08 H 13.44 V 12.56 h 9.68 v 12.32 z",plus:"M25.979,12.896 19.312,12.896 19.312,6.229 12.647,6.229 12.647,12.896 5.979,12.896 5.979,19.562 12.647,19.562 12.647,26.229 19.312,26.229 19.312,19.562 25.979,19.562z",minus:"M25.979,12.896,5.979,12.896,5.979,19.562,25.979,19.562z",arrowHead:"M15.834,29.084 15.834,16.166 2.917,16.166 29.083,2.917z",undo:"M12.981,9.073V6.817l-12.106,6.99l12.106,6.99v-2.422c3.285-0.002,9.052,0.28,9.052,2.269c0,2.78-6.023,4.263-6.023,4.263v2.132c0,0,13.53,0.463,13.53-9.823C29.54,9.134,17.952,8.831,12.981,9.073z",lockClosed:"M24.875,15.334v-4.876c0-4.894-3.981-8.875-8.875-8.875s-8.875,3.981-8.875,8.875v4.876H5.042v15.083h21.916V15.334H24.875zM10.625,10.458c0-2.964,2.411-5.375,5.375-5.375s5.375,2.411,5.375,5.375v4.876h-10.75V10.458zM18.272,26.956h-4.545l1.222-3.667c-0.782-0.389-1.324-1.188-1.324-2.119c0-1.312,1.063-2.375,2.375-2.375s2.375,1.062,2.375,2.375c0,0.932-0.542,1.73-1.324,2.119L18.272,26.956z",lockOpen:"M24.875,15.334v-4.876c0-4.894-3.981-8.875-8.875-8.875s-8.875,3.981-8.875,8.875v0.375h3.5v-0.375c0-2.964,2.411-5.375,5.375-5.375s5.375,2.411,5.375,5.375v4.876H5.042v15.083h21.916V15.334H24.875zM18.272,26.956h-4.545l1.222-3.667c-0.782-0.389-1.324-1.188-1.324-2.119c0-1.312,1.063-2.375,2.375-2.375s2.375,1.062,2.375,2.375c0,0.932-0.542,1.73-1.324,2.119L18.272,26.956z",download:"M62.498910964222794,5C30.742627701282224,5,5,30.744805772836607,5,62.498910964222794C5,94.25519422716337,30.744805772836607,120,62.498910964222794,120C94.25519422716337,120,120,94.2551942271634,120,62.49891096422281C120,30.742627701282238,94.2551942271634,5.000000000000014,62.49891096422281,5.000000000000014C62.49891096422281,5.000000000000014,62.498910964222794,5,62.498910964222794,5M62.50108903577718,90.76374552548342C62.50108903577718,90.76374552548342,43.81105702759522,62.498910964222794,43.81105702759522,62.498910964222794C43.81105702759522,62.498910964222794,51.6085531922953,62.498910964222794,51.6085531922953,62.498910964222794C51.6085531922953,62.498910964222794,51.6085531922953,36.362052311596806,51.6085531922953,36.362052311596806C51.6085531922953,36.362052311596806,71.21119718176479,36.362052311596806,71.21119718176479,36.362052311596806C71.21119718176479,36.362052311596806,71.21119718176479,62.498910964222794,71.21119718176479,62.498910964222794C71.21119718176479,62.498910964222794,81.18676490085039,62.498910964222794,81.18676490085039,62.498910964222794C81.18676490085039,62.498910964222794,62.50108903577718,90.76374552548342,62.50108903577718,90.76374552548342C62.50108903577718,90.76374552548342,62.50108903577718,90.76374552548342,62.50108903577718,90.76374552548342",embed:"M62.49999999999999,5C30.759999999999998,5,5,30.759999999999998,5,62.49999999999999C5,94.23999999999998,30.759999999999998,120,62.49999999999999,120C94.23999999999998,120,120,94.23999999999998,120,62.49999999999999C120,30.760000000000005,94.23999999999998,5,62.49999999999999,5C62.49999999999999,5,62.49999999999999,5,62.49999999999999,5M46.285,74.57499999999999C47.894999999999996,76.41499999999999,47.665,79.28999999999999,45.824999999999996,80.9C43.98499999999999,82.51000000000002,41.10999999999999,82.28,39.5,80.44C39.5,80.44,26.505,65.375,26.505,65.375C25.009999999999998,63.65,25.009999999999998,61.23499999999999,26.505,59.50999999999999C26.505,59.50999999999999,39.385,44.44499999999999,39.385,44.44499999999999C40.19,43.41,41.455,42.834999999999994,42.834999999999994,42.834999999999994C43.86999999999999,42.834999999999994,44.904999999999994,43.17999999999999,45.709999999999994,43.86999999999999C46.62999999999999,44.675,47.20499999999999,45.709999999999994,47.20499999999999,46.974999999999994C47.31999999999999,48.125,46.85999999999999,49.275,46.169999999999995,50.19499999999999C46.169999999999995,50.19499999999999,35.81999999999999,62.49999999999999,35.81999999999999,62.49999999999999C35.81999999999999,62.49999999999999,46.285,74.57499999999999,46.285,74.57499999999999C46.285,74.57499999999999,46.285,74.57499999999999,46.285,74.57499999999999M73.08,49.275C73.08,49.275,60.199999999999996,79.28999999999999,60.199999999999996,79.28999999999999C59.28,81.475,56.519999999999996,82.625,54.334999999999994,81.59C53.184999999999995,81.13,52.37999999999999,80.20999999999998,51.919999999999995,79.17500000000001C51.459999999999994,78.025,51.459999999999994,76.875,51.919999999999995,75.725C51.919999999999995,75.725,64.8,45.709999999999994,64.8,45.709999999999994C65.49,44.099999999999994,67.1,42.949999999999996,68.94,42.949999999999996C69.515,42.949999999999996,70.09,43.065,70.66499999999999,43.294999999999995C71.815,43.754999999999995,72.62,44.675,73.08,45.709999999999994C73.53999999999999,46.974999999999994,73.53999999999999,48.125,73.08,49.275C73.08,49.275,73.08,49.275,73.08,49.275M98.495,65.375C98.495,65.375,85.61499999999998,80.44,85.61499999999998,80.44C84.005,82.28,81.13,82.50999999999999,79.28999999999999,80.9C77.44999999999999,79.29000000000002,77.22,76.41499999999999,78.82999999999998,74.57499999999999C78.82999999999998,74.57499999999999,89.17999999999998,62.49999999999999,89.17999999999998,62.49999999999999C89.17999999999998,62.49999999999999,78.715,50.425,78.715,50.425C77.91,49.505,77.565,48.355,77.68,47.205C77.79499999999999,46.055,78.37,44.905,79.17500000000001,44.099999999999994C79.98000000000002,43.41,81.01499999999999,43.065,82.05000000000001,43.065C83.315,43.065,84.58000000000001,43.64,85.5,44.675C85.5,44.675,98.495,59.739999999999995,98.495,59.739999999999995C99.98999999999998,61.23499999999999,99.98999999999998,63.765,98.495,65.375C98.495,65.375,98.495,65.375,98.495,65.375",trash:"M 13.56 8.28 h 5.28 v -1.54 c 0 -0.0581 -0.0229 -0.1144 -0.0642 -0.1558 c -0.0414 -0.0414 -0.0977 -0.0642 -0.1558 -0.0642 h -4.84 c -0.0581 0 -0.1144 0.0229 -0.1558 0.0642 c -0.0414 0.0414 -0.0642 0.0977 -0.0642 0.1558 v 1.54 z m 9.68 0.88 h -14.08 v 15.84 c 0 0.4858 0.3942 0.88 0.88 0.88 h 12.32 c 0.4858 0 0.88 -0.3942 0.88 -0.88 v -15.84 z m -8.8 3.08 c 0 -0.2429 -0.1971 -0.44 -0.44 -0.44 s -0.44 0.1971 -0.44 0.44 v 10.56 c 0 0.2429 0.1971 0.44 0.44 0.44 s 0.44 -0.1971 0.44 -0.44 v -10.56 z m 4.4 0 c 0 -0.2429 -0.1971 -0.44 -0.44 -0.44 s -0.44 0.1971 -0.44 0.44 v 10.56 c 0 0.2429 0.1971 0.44 0.44 0.44 s 0.44 -0.1971 0.44 -0.44 v -10.56 z m 7.04 -3.96 v 0.88 h -1.76 v 15.84 c 0 0.9724 -0.7876 1.76 -1.76 1.76 h -12.32 c -0.9724 0 -1.76 -0.7876 -1.76 -1.76 v -15.84 h -1.76 v -0.88 h 6.16 v -1.76 c 0 -0.4858 0.3942 -0.88 0.88 -0.88 h 5.28 c 0.4858 0 0.88 0.3942 0.88 0.88 v 1.76 h 6.16 z",resize:"M24 10.999v-10.999h-11l3.379 3.379-13.001 13-3.378-3.378v10.999h11l-3.379-3.379 13.001-13z"}}const m=/(@font\-face {[\s\S]*?})/g,y=/url\((https.+?)\)/;function x(t){const e=y.exec(t);let o;var s;return"undefined"!=typeof FileReader?(s=e[1],o=fetch(s).then((t=>t.blob())).then((t=>new Promise((e=>{const o=new FileReader;o.onload=()=>{e(o.result)},o.readAsDataURL(t)}))))):o=function(t){return fetch(t).then((t=>Promise.all([Promise.resolve(t.headers.get("content-type")),t.buffer()]))).then((t=>{const e=t[1].toString("base64");return`data:${t[0]};base64,${e}`}))}(e[1]),o.then((o=>t.replace(e[1],o)))}var b=function({fonts:t,text:e,styleNode:o}){const s=o,i=`https://fonts.googleapis.com/css?family=${t.join("|").replace(/ /g,"+")}&text=${e}`;return t.length>0?fetch(i).then((t=>t.text())).then((t=>{let e=m.exec(t);const o=[];for(;null!=e;)o.push(x(e[1])),e=m.exec(t);return Promise.all(o)})).then((t=>(s.innerHTML+=t.join("\n"),!0))):Promise.resolve(!0)};!function(t,e){const o=document.createElement("div"),s="backgroundColor borderBottomColor borderBottomWidth borderLeftColor borderLeftWidth borderRightColor borderRightWidth borderSpacing borderTopColor borderTopWidth bottom color fontSize fontWeight height left letterSpacing lineHeight marginBottom marginLeft marginRight marginTop maxHeight maxWidth minHeight minWidth opacity outlineColor outlineOffset outlineWidth paddingBottom paddingLeft paddingRight paddingTop right textIndent top width wordSpacing zIndex".split(" ");function i(t,e,o){return parseFloat(t+(e-t)*o).toFixed(3)}function n(t,e,o){return t.substr(e,o||1)}function a(t,e,o){let s,i,a,r=2;const l=[],d=[];for(;s=3,i=arguments[r-1],r--;)if("r"==n(i,0))for(i=i.match(/\d+/g);s--;)l.push(~~i[s]);else for(4==i.length&&(i=`#${n(i,1)}${n(i,1)}${n(i,2)}${n(i,2)}${n(i,3)}${n(i,3)}`);s--;)l.push(parseInt(n(i,1+2*s,2),16));for(;s--;)a=~~(l[s+3]+(l[s]-l[s+3])*o),d.push(a<0?0:a>255?255:a);return`rgb(${d.join(",")})`}function r(t){const e=parseFloat(t),o=t.replace(/^[\-\d\.]+/,"");return Number.isNaN(e)?{v:o,f:a,u:""}:{v:e,f:i,u:o}}e.emile=function(t,e,i){t="string"==typeof t?document.getElementById(t):t,i=i||{};const n=function(t){let e;const i={};let n,a=s.length;for(o.innerHTML=`<div style="${t}"></div>`,e=o.childNodes[0].style;a--;)(n=e[s[a]])&&(i[s[a]]=r(n));return i}(e),a=t.currentStyle?t.currentStyle:getComputedStyle(t,null);let l;const d={},c=+new Date,h=i.duration||200,p=c+h;let u;const f=i.easing||function(t){return-Math.cos(t*Math.PI)/2+.5};for(l in n)d[l]=r(a[l]);u=setInterval((function(){window.requestAnimationFrame((()=>{const e=+new Date,o=e>p?1:(e-c)/h;for(l in n){const e=i.onMove?i.onMove(l):n[l].f(d[l].v,n[l].v,f(o));t.style[l]=e+n[l].u}e>p?(clearInterval(u),i.after&&i.after()):i.during&&i.during.apply(this,[(e-c)/h])}))}),10)}}(0,window);class v{constructor(t){const e=this;e.slate=t;let o=t.options.container;if("string"==typeof o&&(o=u.el(o)),null==o)throw new Error("You must provide a container to initiate the canvas!");var s;!function(t){const e="M16,1.466C7.973,1.466,1.466,7.973,1.466,16c0,8.027,6.507,14.534,14.534,14.534c8.027,0,14.534-6.507,14.534-14.534C30.534,7.973,24.027,1.466,16,1.466z",{icons:o}=g;t.fn.handle=function(t,s){return this.path(o.handle+e)},t.fn.editor=function(t,s){return this.path(o.editor+e)},t.fn.deleter=function(t,s){return this.path(o.deleter+e)},t.fn.trash=function(){return this.path(o.trash+e).attr({fill:"#000"})},t.fn.searcher=function(t,s){return this.path(o.searcher+e)},t.fn.plus=function(t,s){return this.path(o.plus+e)},t.fn.merge=function(t,s){return this.path(o.plus+e)},t.fn.copy=function(t,s){return this.path(o.copy+e)},t.fn.minus=function(t,s){return this.path(o.minus+e)},t.fn.link=function(t,s){return this.path(o.link+e)},t.fn.up=function(t,e){return this.path(o.up)},t.fn.down=function(t,e){return this.path(o.up).transform("r180")},t.fn.setting=function(t,s){return this.path(o.settings+e).transform("s,.9,.9")},t.fn.arrow=function(){return this.path(o.arrow+e)},t.fn.arrowHead=function(){return this.path(o.arrowHead).attr({fill:"#648CB2"}).transform("s0.7")},t.fn.linkArrow=function(){return this.path(o.arrow+e).attr({fill:"#648CB2"})},t.fn.lockClosed=function(){return this.path(o.lockClosed)},t.fn.lockOpen=function(){return this.path(o.lockOpen)},t.fn.speechbubble=function(t,e,s){const i=this.set();return i.push(this.path(o.speechbubble).transform(["t",t,",",e].join()).scale(6,4).scale(-1,1)).attr({fill:"#fff",stroke:"#000","stroke-width":3}),i.push(this.text(t+10,e+10,s).attr({"font-size":12})),i},t.fn.undo=function(t){return this.path(o.undo)},t.fn.redo=function(t){return this.path(o.undo).transform("s-1,1")},t.fn.resize=function(){return this.path("M24 10.999v-10.999h-11l3.379 3.379-13.001 13-3.378-3.378v10.999h11l-3.379-3.379 13.001-13z")},t.fn.resizeLines=function(){return this.image("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABYAAAAXCAYAAAAP6L+eAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAEBJREFUeNpiYKAuYAPijUD8n1aGVowaOmoo/QyNpYWh+UB8g1aGSowaOmroqKEEAE0MZaCVoQxEFH3e5BgKEGAAnnVBs4ro6nUAAAAASUVORK5CYII=",0,0,22,23)}}(p),(s=p).el.loop=function(t){const e=this,o={pkg:[{"stroke-width":3},{"stroke-width":1}],duration:200,repeat:!1};return Object.assign(o,t),function t(){e.animate(o.pkg[0],o.duration,(()=>{e.animate(o.pkg[1],o.duration,(()=>{o.repeat&&t()}))}))}(),e},s.el.tooltip=function(t,e,o){void 0===e&&(e=80),void 0===o&&(o=20);const s=this.paper.set(),i=this.getBBox();if("text"===t.type)s.push(this.paper.rect(i.x,i.y+-1*o-10,e,o,5).attr({fill:"#fff"})),s.push(this.paper.text(i.x+5,i.y-20,"").attr({"text-anchor":"start",stroke:"#fff","font-size":13,fill:"#fff"}));else{const t=-1*e-5;s.push(this.paper.rect(i.x+t,i.y+o/2*-1,e,o,15).attr({"stroke-width":2,stroke:"#fff","z-index":9999})),s.push(this.paper.rect(i.x+t,i.y+(o/2-45),e,47,15)).attr({"stroke-width":2,fill:"90-#333-#000","z-index":9999}),s.push(this.paper.text(i.x+t+e/2,i.y+(o/2-20),"").attr({"text-anchor":"middle",stroke:"#fff","font-weight":"normal","font-family":"Verdana","font-size":11,"z-index":999}))}const n=this;return n.removed||(n.tt=s,"text"===t.type?n.tt[0].animate({stroke:"#000",fill:"#333"},200,(()=>{n.tt[1].attr({text:t.msg})})):n.tt[0].animate({stroke:"#000",fill:"#333"},200,(()=>{n.tt[2].attr({text:t.msg})}))),n.tt},s.el.untooltip=function(){return this.tt&&this.tt.remove(),this},e.isDragging=!1,e.slate.paper=null,e.internal=null,e.status=null,e.imageFolder=null,e.dken=null,e.eve={init:["onmousedown","ontouchstart"],drag:["onmousemove","ontouchmove"],up:["onmouseup","ontouchend","onmouseout"],gest:["ongesturestart","ongesturechange","ongestureend"]}}init(){const t=this,e=t.slate.options.imageFolder||"/images/",o=t.slate.options.container,{slate:s}=t;t.Canvas={objInitPos:{},objInitialMousePos:{x:0,y:0},initDrag(o){if(s.isCtrl&&s.multiSelection?.start(),s.options.allowDrag){t.isDragging=!0,s.multiSelection?.end(),s.nodes?.closeAllMenus();const i=u.mousePos(o);t.Canvas.objInitPos=u.positionedOffset(t.internal);const n=u.positionedOffset(s.options.container);t.Canvas.objInitialMousePos={x:i.x+n.left,y:i.y+n.top};const a=t.cp(o);t.status&&(t.status.innerHTML=`${Math.abs(a.x)}, ${Math.abs(a.y)}`),s.options.showStatus&&(t.status&&(t.status.style.display="block"),s.multiSelection?.hide()),t.internal.style.cursor=`url(${e}closedhand.cur), default`,i.allTouches&&(s.options.lastTouches=i.allTouches),s.removeContextMenus&&s.removeContextMenus(),s.draggingZoom=t.slate.options.viewPort.zoom,s.toggleFilters(!0),u.stopEvent(o)}else s.onSelectionStart?s.onSelectionStart.apply(t,[o]):u.stopEvent(o)},setCursor(){t.isDragging?t.internal.style.cursor=`url(${e}closedhand.cur), default`:t.internal.style.cursor=`url(${e}openhand.cur), default`},onDrag(e){requestAnimationFrame((()=>{const o=u.mousePos(e),i=u.positionedOffset(t.internal);if(o.currentZoom=s.options.viewPort.zoom.r,o.left=Math.abs(i.left),o.top=Math.abs(i.top),s.collab?.send({type:"onMouseMoved",data:o}),t.isDragging&&s.options.allowDrag){const o=t.cp(e);o.allTouches&&o.allTouches.length>1&&(s.options.lastTouches=o.allTouches),t.status&&(t.status.innerHTML=`${Math.abs(o.x)}, ${Math.abs(o.y)}`),t.internal.style.left=`${o.x}px`,t.internal.style.top=`${o.y}px`}}))},endDrag(o){if(t.isDragging&&s.options.allowDrag){t.isDragging=!1,t.internal.style.cursor=`url(${e}openhand.cur), default`,t.status&&(t.status.style.display="none"),s.multiSelection?.show();const i=t.cp(o);s.draggingZoom=null,t.endDrag(i),s.toggleFilters(!1)}}},s.options.preserve||(o.innerHTML=""),t.slate.paper&&t.slate.paper.clear(),t.internal&&o.removeChild(t.internal),t.internal=document.createElement("div"),t.internal.setAttribute("class",`slateboxInternal_${t.slate.options.id} sb_canvas`);const i=s.options.viewPort.width,n=s.options.viewPort.height,a=s.options.viewPort.left,r=s.options.viewPort.top;if(t.internal.style.width=`${i+1e5}px`,t.internal.style.height=`${n+1e5}px`,t.internal.style.left=-1*a+"px",t.internal.style.top=-1*r+"px",t.internal.style.position="absolute",t.internal.style["-webkit-transform"]="translateZ(0)",t.internal.style.transform="translateZ(0)",o.appendChild(t.internal),t.internal.addEventListener("mousedown",(()=>{t.slate?.events?.onCanvasClicked?.apply()})),t.slate.options.showStatus&&(t.status=document.createElement("div"),t.status.style.position="absolute",t.status.style.height="20px",t.status.style.left="5px",t.status.style.color="#000",t.status.style.fontSize="10pt",t.status.style.fontFamily="trebuchet ms",t.status.style.top="0px",t.status.style.display="none",t.status.style.padding="5px",t.status.style.filter="alpha(opacity=80)",t.status.style.opacity=".80",t.status.style.backgroundColor="#ffff99",t.status.style.fontWeight="bold",o.appendChild(t.status)),o.style.position="relative",o.style.overflow="hidden",t.internal.style.borderTop=`${s.borderTop}px`,t.internal.style.cursor=`url(${e}openhand.cur), default`,t.slate.paper=p(t.internal,i,n),t.refreshBackground(),s.options.allowDrag&&t.wire(),s.options.viewPort.originalHeight=n,s.options.viewPort.originalWidth=i,t.resize(i),s.options.showZoom&&s.zoomSlider&&s.zoomSlider.show(s.options.viewPort.width),s.options.showUndoRedo&&s.undoRedo&&s.undoRedo.show(),s.options.showbirdsEye&&(s.birdsEye.enabled()?s.birdsEye.reload(s.exportJSON()):s.birdsEye.show({size:s.options.sizeOfbirdsEye||200,onHandleMove(){}})),!s.options.isbirdsEye&&(s.options.isSharing||s.options.isEmbedding)){const t=25,e=t-3,i=document.getElementById("snap_slate"),n=document.createElement("div");n.className="sb_parent_shareable";const a=u.buildStyle({height:i?`${e+8}px`:`${e}px`});if(n.setAttribute("style",a),s.options.isEmbedding&&!s.options.nobrand){const t=document.createElement("a");t.className="sb_brand",t.setAttribute("href","https://slatebox.com"),t.innerHTML="built with slatebox",n.appendChild(t)}if(!s.options.isbirdsEye&&s.options.isSharing){const o=`<svg xmlns="http://www.w3.org/2000/svg" width="${t}" height="${t}"><path fill="#333" stroke="#000" d="{path}" stroke-dasharray="none" stroke-width="1" opacity="1" fill-opacity="1"></path></svg>`;["download","embed"].forEach((a=>{const r=document.createElement("div");r.className="sb_share",r.setAttribute("data-action",a);const l=u.buildStyle({width:`${t}px`,height:`${t}px`});r.setAttribute("style",l);const d=u.centerAndScalePathToFitContainer({containerSize:t,scaleSize:e,path:g.icons[a]});r.innerHTML=o.replace(/{path}/gi,d.path),n.appendChild(r),u.addEvent(r,"click",(()=>{switch(this.getAttribute("data-action")){case"embed":{const t=document.createElement("textarea");document.body.appendChild(t);let e="";if(i)e=`<iframe id='sb_embed_${s.options.id}' src='${window.location.href}' width='${i.clientWidth}' height='${i.clientHeight}' frameborder='0' scrolling='no'></iframe>`;else{const t=s.options.container.parentElement.innerHTML.split('<div class="slateboxInternal"'),o=`${t[0]}<script>${t[1].split("<script>")[1]}`;e=`<div id="sb_embed_${s.options.id}">${o}</div>`}t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t);const o=document.createElement("div");o.innerHTML="Copied!",o.setAttribute("style",u.buildStyle({"font-size":"11pt","text-align":"center",padding:"4px","margin-right":"-1px",width:"125px",height:"22px",position:"absolute",right:0,bottom:0,"background-color":"#333",color:"#fff"})),n.appendChild(o),window.setTimeout((()=>{n.removeChild(o)}),1500);break}case"download":s.png()}}))}))}s.options.isEmbedding&&""!==n.innerHTML&&o.appendChild(n)}t.windowSize=u.windowSize(),t.containerOffset=u.positionedOffset(t.slate.options.container),u.addEvent(window,"resize",(()=>{t.windowSize=u.windowSize(),t.containerOffset=u.positionedOffset(t.slate.options.container),null!==t.dken&&(t.dken.style.width=`${t.ws.width}px`,t.dken.style.height=`${t.ws.height}px`)})),setTimeout((()=>{t.slate.birdsEye?.setBe(),t.slate.birdsEye?.refresh()}),500),t.completeInit=!0}cp(t){const e=t?u.mousePos(t):{x:0,y:0};return{x:this.Canvas.objInitPos.left+(e.x-this.Canvas.objInitialMousePos.x),y:this.Canvas.objInitPos.top+(e.y-this.Canvas.objInitialMousePos.y)}}endDrag(t){this.slate.options.viewPort.left=Math.abs(t.x),this.slate.options.viewPort.top=Math.abs(t.y),this.internal.style.left=`${t.x}px`,this.internal.style.top=`${t.y}px`;const e=u.positionedOffset(this.internal),o={x:this.Canvas.objInitPos.left-e.left,y:this.Canvas.objInitPos.top-e.top};this.slate.birdsEye?.refresh(!0),this.slate.collaboration.allow&&this.broadcast(o)}broadcast(t){this.slate.collab?.send({type:"onCanvasMove",data:{left:this.slate.options.viewPort.left,top:this.slate.options.viewPort.top,relative:t,orient:this.slate.getOrientation()}})}zoom(t){const e=this,o={dur:500,callbacks:{after:null,during:null},easing:"easeFromTo",zoomPercent:100};Object.assign(o,t),e.slate.nodes.closeAllConnectors();const s=e.slate.options.viewPort.zoom.w||5e4,i=e.slate.options.viewPort.originalWidth*(100/parseInt(o.zoomPercent,10)),n=Math.abs(i-s);o.dur=o.dur||0===o.dur?o.dur:500,emile(e.internal,"padding:1px",{duration:o.dur,before(){e.slate.options.allowDrag=!1},after(){e.slate.options.allowDrag=!0,e.slate.zoomSlider.set(i),e.slate.birdsEye?.refresh(!0),o.callbacks?.after?.apply(e.slate,[i])},during(t){const a=i>s?s+n*t:s-n*t;e.slate.zoom(0,0,a,a,!1),e.slate.canvas.resize(a),e.slate.birdsEye?.refresh(!0),o.callbacks?.during?.apply(t)},easing:u.easing[o.easing]})}move(t){const e=this,o={x:0,y:0,dur:500,callbacks:{after:null,during:null},isAbsolute:!0,easing:"easeFromTo"};Object.assign(o,t);let{x:s}=o,{y:i}=o;!1===o.isAbsolute&&(s=e.slate.options.viewPort.left+s,i=e.slate.options.viewPort.top+i),e.slate.nodes.closeAllConnectors(),o.dur>0?emile(e.internal,`left:${-1*s}px;top:${-1*i}px`,{duration:o.dur,before(){e.slate.options.allowDrag=!1},after(){e.slate.options.allowDrag=!0,e.slate.options.viewPort.left=Math.abs(parseInt(e.internal.style.left.replace("px",""),10)),e.slate.options.viewPort.top=Math.abs(parseInt(e.internal.style.top.replace("px",""),10)),e.slate.birdsEye?.refresh(!0),o.callbacks.after?.apply(e.slate)},during(t){e.slate.birdsEye?.refresh(!0),o.callbacks?.during?.apply(t)},easing:u.easing[o.easing]}):window.requestAnimationFrame((()=>{e.internal.style.left=-1*s+"px",e.internal.style.top=-1*i+"px",e.slate.options.viewPort.left=Math.abs(s),e.slate.options.viewPort.top=Math.abs(i),o.callbacks?.after?.apply(e.slate)}))}resize(t){const e=parseInt(t,10),o=this.slate.options.viewPort.width/e,s=u.getDimensions(this.slate.options.container);let i=-1*this.slate.options.viewPort.top*o,n=-1*this.slate.options.viewPort.left*o;i+=-1*(s.height/2*o-s.height/2),n+=-1*(s.width/2*o-s.width/2);const a=this.slate.options.viewPort.originalWidth-1e3;return!(-i>a||-n>a)&&(this.internal.style.top=`${i}px`,this.internal.style.left=`${n}px`,this.slate.options.viewPort.zoom={w:e,h:e,l:parseFloat(-1*n),t:parseFloat(-1*i),r:this.slate.options.viewPort.originalWidth/e},!0)}clear(){return this.slate.options.container.innerHTML="",this.slate._}wire(){const t=this;t.eve.init.forEach((e=>{t.internal[e]=t.Canvas.initDrag})),t.eve.drag.forEach((e=>{t.internal[e]=t.Canvas.onDrag})),t.eve.up.forEach((e=>{t.internal[e]=t.Canvas.endDrag}))}unwire(){const t=this;t.eve.init.forEach((e=>{t.internal[e]=null})),t.eve.drag.forEach((e=>{t.internal[e]=null})),t.eve.up.forEach((e=>{t.internal[e]=null}))}rawSVG(e){const o=this;function s(t){o.slate.events.onOptimizeSVG?o.slate.events.onOptimizeSVG(t,((t,o)=>{t?console.error("Unable to optimize slate svg export",t):e(o)})):e(t)}function i(e){let i=e;const n=t(o.slate.nodes.allNodes.map((t=>t.options.image)).filter((t=>!!t)));n.length>0?n.forEach(((t,e)=>{if(o.slate.events.onBase64ImageRequested){let a="png";t.indexOf("jpg")?a="jpeg":t.indexOf("gif")&&(a="gif"),o.slate.events.onBase64ImageRequested(t,a,((o,a)=>{if(o)console.error("Unable to retrieve base64 from image",o);else{const e=t.replace(/&/gi,"&amp;");for(;i.indexOf(e)>-1;)i=i.replace(e,a)}e+1===n.length&&s(i)}))}else u.toDataUrl(t).then((e=>{i=i.replace(new RegExp(t,"gi"),e)})).catch((t=>{console.error("Unable to get image",t)})).finally((()=>{e+1===n.length&&s(i)}))})):s(i)}b({fonts:t(o.slate.nodes.allNodes.map((t=>t.options.fontFamily))),text:t(o.slate.nodes.allNodes.flatMap((t=>t.options.text.replace(/ /gi,"").split("")))).join("").trim(),styleNode:o.internal.querySelector("svg > defs > style")}).then((()=>{let t=o.internal.innerHTML.replace(/xlink:href/gi,"href");const e=o.slate.options.containerStyle.backgroundImage;if(e){let s="png";e.indexOf("jpg")?s="jpeg":e.indexOf("gif")&&(s="gif"),o.slate.events.onBase64ImageRequested(e,s,((o,s)=>{o?console.error("Unable to retrieve base64 from image",o):t=t.replace(e,s),i(t)}))}else i(t)}))}bgToBack(){this._bg?.toBack()}hideBg(t){const e=this,o=e.slate.options.containerStyle.backgroundEffect;e._bg?.remove(),delete e._bg,o&&(e.slate.options.isbirdsEye||(clearTimeout(e.showBgTimeout),e.showBgTimeout=setTimeout((()=>{const t={filter:`url(#${o})`};e.slate.filters.availableFilters[o]?.fill&&(t.fill=`url(#${e.slate.filters.availableFilters[o]?.fill})`),e._bg=e.slate.paper.rect(0,0,e.slate.options.viewPort.width,e.slate.options.viewPort.height).attr(t).toBack()}),t||2500))),e.refreshBackground()}refreshBackground(){const t=this;if(t.internal.style.backgroundColor="",t.internal.parentElement.style.backgroundImage="",t.internal.parentElement.style.backgroundSize="",t.internal.parentElement.style.background="",t.internal.style.backgroundSize="",t.internal.style.backgroundPosition="",t.slate.options.containerStyle.backgroundEffect&&(t.slate.options.containerStyle.backgroundColor=t.slate.filters.availableFilters[t.slate.options.containerStyle.backgroundEffect].backgroundColor),t.slate.options.containerStyle.backgroundImage&&(t.slate.options.containerStyle.prevBackgroundColor=t.slate.options.containerStyle.backgroundColor,t.slate.options.containerStyle.backgroundColor="transparent",t.internal.parentElement.style.backgroundImage=`url('${t.slate.options.containerStyle.backgroundImage}')`,t.slate.options.containerStyle.backgroundSize&&(t.internal.parentElement.style.backgroundSize=t.slate.options.containerStyle.backgroundSize)),!t.initBg&&t.slate.options.containerStyle.backgroundEffect&&(t.initBg=!0,t.hideBg(1)),"transparent"===t.slate.options.containerStyle.backgroundColor)t.slate.options.isbirdsEye||(t.slate.options.isEmbedding?t.internal.style.backgroundColor="":t.slate.options.containerStyle.backgroundImage||(t.internal.style.backgroundImage="linear-gradient(45deg,rgba(13,26,43,0.1) 25%,transparent 25%,transparent 75%,rgba(13,26,43,0.1) 75%),linear-gradient(45deg,rgba(13,26,43,0.1) 25%,transparent 25%,transparent 75%,rgba(13,26,43,0.1) 75%)",t.internal.style.backgroundSize="12px 12px",t.internal.style.backgroundPosition="0 0,6px 6px"));else if(t.slate.options.containerStyle.backgroundColorAsGradient){t.internal.style.backgroundColor="";const e=`${t.slate.options.containerStyle.backgroundGradientType}-gradient(${t.slate.options.containerStyle.backgroundGradientColors.join(",")})`;t.internal.parentElement.style.background=e}else t.internal.style.backgroundColor=t.slate.options.containerStyle.backgroundColor||"#fff";t.slate.grid?.setGrid()}get(){return this.internal}draggable(){return this.internal}}const w={};class k{constructor(t){"plugin"!==this.constructor.name&&this.registerPlugins(t)}registerPlugins(t){const e=this.constructor.name;w[e]&&w[e].forEach((e=>{const{name:o,plugin:s}=e;this.plugins||(this.plugins={}),this.plugins[o]=new s(t)}))}static registerPlugin(t){if(!t.name||!t.plugin)throw new Error("Plugins must provide a name and a plugin (class definition)");const e=Object.getPrototypeOf(t.plugin).name;w[e]||(w[e]=[]),w[e]=[...w[e],t]}}class C extends k{constructor(t){super(),this._lock=null,this._openLock=null,this.lm=null,this.options={id:u.guid(),name:"",text:"",image:"",groupId:null,xPos:0,yPos:0,height:10,width:10,borderStyle:"solid",borderWidth:1,borderColor:"#000",borderOpacity:1,lineColor:"#000000",lineOpacity:1,lineEffect:"",lineWidth:5,opacity:1,textOpacity:1,showDelete:!0,showAddAndDeleteConditionally:!1,showResize:!0,showAdd:!0,showRelationshipConnector:!0,showRelationshipDelete:!0,showRelationshipProperties:!0,showRelationshipReassign:!0,showRotate:!0,showMenu:!0,showColorTab:!0,showTextTab:!0,showShapeTab:!0,showImageTab:!0,showEffectTab:!0,spaceBetweenNodesWhenAdding:30,disableMenuAsTemplate:!1,disableDrag:!1,allowDrag:!0,allowMenu:!0,allowContext:!0,allowResize:!0,isLocked:!1,isComment:!1,backgroundColor:"90-#031634-#2D579A",foregroundColor:"#fff",fontSize:18,fontFamily:"Roboto",vectorPath:"",rotate:{rotationAngle:0},textXAlign:"middle",textYAlign:"middle",link:{show:!1,type:"",data:"",thumbnail:{width:175,height:175}},filters:{vect:null,text:null}},Object.assign(this.options,t),""===this.options.name&&(this.options.name=this.options.id),this.constants={statusPanelAtRest:33,statusPanelExpanded:200}}_url(t){return this.options.ajax.rootUrl+this.options.ajax.urlFlavor+t}del(){const t=this.options.id;this.slate.nodes.closeAllMenus(),this.slate.nodes.closeAllLineOptions(),this.relationships.removeAll(),this.slate.options.allowDrag=!0,this.slate.nodes.allNodes.forEach((e=>{e.options.link&&e.options.link.show&&e.options.link.data===t&&(Object.assign(e.options.link,{show:!1,type:"",data:""}),e.link.hide())})),this.slate.nodes.remove(this)}getTransformString(t={}){const e=[];let o;if("resize"===t.action){const o=`s${t.sx},${t.sy}`;e.push(o)}if(t.rotate?o=`R${t.rotate.rotationAngle}, ${t.rotate.point.x}, ${t.rotate.point.y}`:this.options.rotate.rotationAngle&&(o=`R${this.options.rotate.rotationAngle}, ${this.options.rotate.point.x-(t.dx||0)}, ${this.options.rotate.point.y-(t.dy||0)}`),o&&e.push(o),"translate"===t.action){const o=`T${t.dx}, ${t.dy}`;e.push(o)}return e.join(" ")}rotateMoveVector({dx:t,dy:e}){const o=-this.options.rotate.rotationAngle*Math.PI/180;return{dx:t*Math.cos(o)-e*Math.sin(o),dy:t*Math.sin(o)+e*Math.cos(o)}}translateWith({dx:t,dy:e}){const o=this.rotateMoveVector({dx:t,dy:e}),s={action:"translate",dx:o.dx,dy:o.dy},i=this.getTransformString(s);this.vect.transform(i),this.text.transform(i),this.setPosition({x:this.vect.ox+t,y:this.vect.oy+e})}setPosition(t,e,o,s={}){this.options.xPos=t.x,this.options.yPos=t.y;const i=this.linkCoords();this.link.transform(["t",i.x,",",i.y,"s",".8",",",".8","r","180"].join()),!0!==e&&(this.slate.nodes.closeAllMenus({exception:o}),this.slate.nodes.closeAllLineOptions())}setStartDrag(){this.slate.options.allowDrag=!1,this.connectors&&this.connectors.reset(),this.context&&this.context.remove()}setEndDrag(){this.slate&&this.slate.options.enabled&&(this.slate.options.allowDrag=!0),this.slate.displayLocks()}serialize(t){const e=this,o={};return Object.assign(o,{options:e.options}),o.relationships={associations:[]},e.relationships.associations.forEach((s=>{o.relationships.associations.push(e._bindRel(s,t))})),o}_bindRel(t,e){return{childId:t.child.options.id,parentId:t.parent.options.id,isStraightLine:t.blnStraight,lineColor:t.lineColor,lineEffect:t.lineEffect,lineOpacity:t.lineOpacity,lineWidth:e||t.lineWidth}}addRelationships(t,e){const o=this,s=[];t.relationships&&t.relationships&&t.relationships.associations&&t.relationships.associations.forEach&&t.relationships.associations.forEach((t=>{const e=t;let i=null;if(o.slate.nodes.allNodes.forEach((t=>{t.options.id===e.parentId&&o.options.id!==t.options.id&&(i=t)})),i){const t=i.relationships.addAssociation(o,e);s.push(t.line)}})),e?.apply(o,[s])}toFront(){this.relationships?.associations?.forEach((t=>{t.line.toFront()})),this.vect.toFront(),this.text.toFront(),this.link.toFront(),this.slate?.grid.toBack(),this.slate?.canvas.bgToBack(),this.slate.reorderNodes()}toBack(){this.link.toBack(),this.text.toBack(),this.vect.toBack(),this.relationships?.associations?.forEach((t=>{t.line.toBack()})),this.slate?.grid.toBack(),this.slate?.canvas.bgToBack(),this.slate.reorderNodes()}hide(){this.vect.hide(),this.text.hide(),this.options.link.show&&this.link.hide()}show(){this.vect.show(),this.text.show(),this.options.link.show&&this.link.show()}applyFilters(t){const e=this;t&&(e.options.filters[t.apply]||(e.options.filters[t.apply]={}),e.options.filters[t.apply]=t.id),Object.keys(e.options?.filters).forEach((t=>{e[t]&&(e.options.filters[t]?e[t].attr("filter",`url(#${e.options.filters[t]})`):e[t].attr("filter",""))}))}toggleFilters(t){const e=this;Object.keys(e.options?.filters).forEach((o=>{e[o]&&e.options.filters[o]&&(t?e[o].attr("filter",""):e[o].attr("filter",`url(#${e.options.filters[o]})`))}))}applyBorder(t){t&&(this.options[t.prop]=t.val);const e={stroke:this.options.borderColor,"stroke-dasharray":this.options.borderStyle||null,"stroke-width":null!=this.options.borderWidth?this.options.borderWidth:1,"stroke-opacity":null!=this.options.borderOpacity?this.options.borderOpacity:1,"stroke-linecap":"round"};return this.vect&&this.vect.attr(e),e}getTempPathWithCorrectPositionFor({pathElement:t,dx:e,dy:o,rotationAngle:s}){const i=this.slate.paper.path(t.attr("path").toString()).attr({opacity:0}),n=[],a=i.getBBox();if(null!=e&&null!=o)if(this.options.rotate.rotationAngle){const t=this.rotateMoveVector({dx:e,dy:o});n.push(`T${t.dx},${t.dy}`)}else n.push(`T${e},${o}`);null!=s?n.push(`r${s}, ${a.cx}, ${a.cy}`):this.options.rotate.rotationAngle&&n.push(`r${this.options.rotate.rotationAngle}, ${this.options.rotate.point.x}, ${this.options.rotate.point.y}`),i.transform("");const r=f(i.attr("path").toString(),n);return i.attr({path:r}),i}hideOwnMenus(){this.link.hide(),this.menu.hide()}spin(t){let e=0;const o=t&&t.angle||280,s=t&&t.duration||5e3;!function t(i){e++;const n=e%2==0?this.options.rotate.rotationAngle-i:this.options.rotate.rotationAngle+i,a={rotate:this.options.rotate,rotationAngle:n};this.rotate.animateSet(a,{duration:s,cb:()=>{t(o)}})}(o)}move(t){const e={dur:t.dur||500,moves:[{id:this.options.id,x:t.x,y:t.y}]},o=this.slate.nodes.nodeMovePackage(e);this.slate.nodes.moveNodes(o,{animate:!0,cb:()=>{t.cb&&t.cb()}})}zoom(t,e,o){this.slate.canvas.zoom({dur:e,zoomPercent:t,callbacks:{during(t,e){},after(t){o&&o.apply(this,[{id:this.options.id,operation:"zoom",zoomLevel:t}])}}})}position(t,e,o,s){const i=this;o=o||"easeTo",s=s||500;const n=i.vect.getBBox(),a=i.slate.options.viewPort.zoom.r,r=u.getDimensions(i.slate.options.container),l=r.width,d=r.height,c=i.options.width*a,h=i.options.height*a,p=10;let f=n.x*a,g=n.y*a;switch(t){case"lowerright":f=f-(l-c)-p,g=g-(d-h)-p;break;case"lowerleft":f-=p,g=g-(d-h)-p;break;case"upperright":f=f-(l-c)-p,g-=p;break;case"upperleft":f-=p,g-=p;break;default:f-=l/2-c/2,g-=d/2-h/2}f===i.slate.options.viewPort.left&&g===i.slate.options.viewPort.top?e.apply():i.slate.canvas.move({x:f,y:g,dur:s,callbacks:{after(){e?.apply(i,[{id:i.options.id,operation:"position",location:t,easing:o}])}},isAbsolute:!0,easing:o})}toggleImage(t){if(this.options.vectorPath&&this.options.remoteImage)if(t.active){const e=this.options.remoteImage;this.hidden={vectorPath:this.options.vectorPath},this.shapes.set({shape:"rect",keepResizerOpen:t.keepResizerOpen}),this.images.set(e,this.options.width,this.options.height,t.keepResizerOpen),this.text&&this.text.hide()}else this.hidden&&(this.images.set("",this.options.width,this.options.height),this.customShapes.set(this.hidden.vectorPath),t.width&&t.height&&this.resize.set(t.width,t.height),this.text&&this.text.show(),this.relationships.showOwn(),setTimeout((()=>{this.menu.show()}),100),delete this.hidden)}disable(){this.options.allowMenu=!1,this.options.allowDrag=!1,this.hideOwnMenus(),this.slate.options.showLocks&&this.options.isLocked&&this.showLock()}enable(){this.options.allowMenu=!0,this.options.allowDrag=!0,this.hideLock()}showLock(){const t=this,e=t.vect.getBBox(),o=t.slate.paper;return!t._lock&&t.slate.options.showLocks&&(t._lock=o.lockClosed().transform(["t",e.x2-10,",",e.y2-10,"s",.9,.9].join()).attr({fill:"#fff",stroke:"#000"}),t._lock.mouseover((e=>{t.hideLock()}))),t._lock}hideLock(){this.hideOpenLock(),this._lock&&this._lock.remove(),this._lock=null,this.slate.unglow()}showOpenLock(){const t=this,e=this.vect.getBBox(),o=this.slate.paper;return t._openLock=o.lockOpen().transform(["t",e.x2-10,",",e.y2-10,"s",.9,.9].join()).attr({fill:"#fff",stroke:"#000"}),t._openLock.mouseover((e=>{t._openLock.attr({"stroke-width":"2px","stroke-color":"#000"}),t._openLock.style.cursor="pointer"})),t._openLock.mouseout((()=>{t.hideOpenLock(),t.showLock()})),t._openLock.mousedown((()=>{t.enable(),t.options.isLocked=!1;const e={type:"onNodeUnlocked",data:{id:t.options.id}};t.context.broadcast(e)})),t._openLock}hideOpenLock(){this._openLock&&this._openLock.remove(),this._openLock=null}initLock(){this.vect&&this.options.isLocked&&this.showLock()}offset(){let t=this.options.xPos-this.slate.options.viewPort.left,e=this.options.yPos-this.slate.options.viewPort.top;return"ellipse"===this.options.vectorPath&&(t-=this.options.width/2,e-=this.options.height/2),{x:t,y:e}}textCoords(t={}){const e=t.x||this.vect.ox||0,o=t.y||this.vect.oy||0;let s=this.options?.textOffset?.x||0,i=this.options?.textOffset?.y||0;const n=this.vect.getBBox();switch(this.options.textXAlign){case"end":s=1*s+this.options.textOffset.width;break;case"middle":s=1*s+this.options.textOffset.width/2}switch(this.options.textYAlign){case"hanging":i=1*i-n.height/2;break;case"baseline":i=1*i+n.height/2}return{x:e+s,y:o+i}}linkCoords(){let t=this.options.xPos-20,e=this.options.yPos+this.options.height/2-22;return"rect"!==this.vect.type&&(e=this.options.yPos+this.options.height/2-22,t=this.options.xPos-20),{x:t,y:e}}_rotate(t){const e={angle:0,cb:null,dur:0};Object.assign(e,t);const o=["r",e.angle].join("");if(0===e.dur)this.vect.transform(o),this.text.transform(o),this.options.link.show&&this.link.transform(o),e.cb&&e.cb();else{const t=this.slate.paper.set();t.push(this.vect),t.push(this.text),this.options.link.show&&t.push(this.link),t.animate({transform:o},e.dur,">",(()=>{e.cb&&e.cb()}))}}}class P{constructor(t){this.slate=t,this.invoker=null,this.pc=t.collaboration||{},u.localRecipients||(u.localRecipients=[]),this.wire()}exe(t){this.invoke(t),this.send(t)}wire(){const t=this;function e(){t.slate.multiSelection?.end()}t.invoker={onZoom(o){if(t.slate.options.followMe){e();const s=t.slate.options.viewPort.originalWidth/o.data.zoomLevel*100;t.slate.canvas.zoom({dur:o.data.duration||500,zoomPercent:s,callbacks:{during(){},after(){}}})}},onNodePositioned(o){e();t.slate.nodes.one(o.data.id).position(o.data.location,(()=>{}),o.data.easing,o.data.duration||500),t.closeNodeSpecifics(o)},onNodeLinkRemoved(e){t.slate.nodes.one(e.data.id).links?.unset(!1),t.closeNodeSpecifics(e)},onNodeLinkAdded(e){t.slate.nodes.one(e.data.id).links?.set(e,!1),t.closeNodeSpecifics(e)},onNodeUnlocked(e){const o=t.slate.nodes.one(e.data.id);o.options.allowDrag=!0,o.options.isLocked=!1,o.hideLock(),t.slate.birdsEye?.nodeChanged(e),t.closeNodeSpecifics(e)},onNodeLocked(e){const o=t.slate.nodes.one(e.data.id);o.options.allowDrag=!1,o.options.isLocked=!0,o.showLock(),t.slate.birdsEye?.nodeChanged(e),t.closeNodeSpecifics(e)},onNodeBehaviorChanged(e){const o=t.slate.nodes.one(e.data.id);e.data.behaviorChanges.forEach((t=>{o.options[t.name]=t.value})),t.slate.birdsEye?.nodeChanged(e),t.closeNodeSpecifics(e)},onNodeToBack(o){e();t.slate.nodes.one(o.data.id).toBack(),t.slate.birdsEye?.nodeChanged(o)},onNodeToFront(o){e();t.slate.nodes.one(o.data.id).toFront(),t.slate.birdsEye?.nodeChanged(o)},onNodeShapeChanged(e){t.slate.nodes.one(e.data.id).shapes.set(e.data),t.slate.birdsEye?.nodeChanged(e),t.closeNodeSpecifics(e)},onNodeAdded(o){if(e(),o.data.id){t.slate.nodes.one(o.data.id).connectors.createNode(o.data.skipCenter,o.data.options,o.data.targetXPos,o.data.targetYPos)}else if(o.data.multiSelectCopy)t.slate.multiSelection.createCopiedNodes(o.data.nodeOptions,o.data.assocDetails);else{const e=new C(o.data.nodeOptions);t.slate.nodes.add(e)}},onNodeImageChanged(e){t.slate.nodes.one(e.data.id).images.set(e.data.img,e.data.w,e.data.h),t.slate.birdsEye?.nodeChanged(e),t.closeNodeSpecifics(e)},onNodeDeleted(o){e();t.slate.nodes.one(o.data.id).del(),t.slate.birdsEye?.nodeDeleted(o)},onNodeResized(s){e(),t.slate.toggleFilters(!0,null,!0);const i=t.slate.nodes.one(s.data.id);i.hideOwnMenus();const n={associations:s.data.associations,animate:!0};Object.assign(i.options,o(s.data,["associations","textPosition"])),i.resize.animateSet(s.data,n),t.slate.birdsEye?.nodeChanged(s),t.closeNodeSpecifics(s)},onNodeRotated(s){e(),t.slate.toggleFilters(!0,null,!0);const i=t.slate.nodes.one(s.data.id);i.options.textOffset=s.data.textOffset,i.hideOwnMenus();const n=i.options.rotate.rotationAngle,a={associations:s.data.associations,animate:!0};Object.assign(i.options,o(s.data,"associations")),i.rotate.animateSet({...s.data,rotationAngle:s.data.rotate.rotationAngle-n},a),t.slate.birdsEye?.nodeChanged(s),t.closeNodeSpecifics(s)},onNodeColorChanged(e){t.slate.nodes.one(e.data.id).colorPicker.set(e.data),t.slate.birdsEye?.nodeChanged(e)},onNodeTextChanged(e){t.slate.nodes.one(e.data.id).editor.set(e.data.text,e.data.fontSize,e.data.fontFamily,e.data.fontColor,e.data.textOpacity,e.data.textXAlign,e.data.textYAlign,!0),t.slate.birdsEye?.nodeChanged(e),t.slate.loadAllFonts()},addRelationship(o){e(),t.slate.nodes.addRelationship(o.data),t.slate.birdsEye?.relationshipsChanged(o)},removeRelationship(o){e(),t.slate.nodes.removeRelationship(o.data),t.slate.birdsEye?.relationshipsChanged(o)},onNodesMove(o){e(),t.slate.toggleFilters(!0,null,!0),t.slate.nodes.moveNodes(o,{animate:!0}),t.slate.birdsEye?.nodeChanged(o),t.closeNodeSpecifics(o)},onNodeEffectChanged(e){t.slate.nodes.one(e.data.id).applyFilters(e.data.filter)},onNodeBorderPropertiesChanged(e){t.slate.nodes.one(e.data.id).applyBorder(e.data)},onLinePropertiesChanged(e){const o=e;t.slate.toggleFilters(!0,null,!0),o.data.forEach||(o.data=[o.data]),o.data.forEach((e=>{const o=t.slate.nodes.one(e.id);Object.assign(o.options,e.options),o.lineOptions.set(e)}))},onFollowMeChanged(e){t.slate.options.followMe=e.data?.followMe},onCanvasMove(e){if(t.slate.options.followMe){t.slate.toggleFilters(!0,null,!0);const o={x:e.data.left,y:e.data.top,dur:e.data.duration||500,callback:{after(){t.slate.birdsEye?.refresh(!0)}},isAbsolute:!e.isRelative};t.slate.canvas.move(o)}},onSlateThemeChanged(e){t.slate.options.themeId=e.data?.theme?._id,e.data?.theme&&t.slate.applyTheme(e.data.theme,e.data.syncWithTheme)},onSlateBackgroundEffectChanged(e){t.slate.options.containerStyle.backgroundEffect=e.data.effect,t.slate.canvas.hideBg(1)},onSlateBackgroundImageChanged(e){if(e.data.bg)t.slate.options.containerStyle.backgroundImage=e.data.bg.url,t.slate.options.containerStyle.backgroundSize=e.data.bg.size;else{const e=t.slate.options.containerStyle.prevBackgroundColor||"#fff";t.slate.options.containerStyle.backgroundColor=e,t.slate.options.containerStyle.backgroundImage=null,t.slate.options.containerStyle.backgroundEffect=null}t.slate.canvas.hideBg(1)},onSlateBackgroundColorChanged(e){t.slate.options.containerStyle.backgroundColor=e.data.color,t.slate.options.containerStyle.backgroundColorAsGradient=e.data.asGradient,t.slate.options.containerStyle.backgroundGradientType=e.data.gradientType,t.slate.options.containerStyle.backgroundGradientColors=e.data.gradientColors,t.slate.options.containerStyle.backgroundGradientStrategy=e.data.gradientStrategy,t.slate.options.containerStyle.backgroundImage=null,t.slate.options.containerStyle.backgroundEffect=null,t.slate.canvas.hideBg(1)},onLineColorChanged(e){t.slate.options.defaultLineColor=e.data.color,t.slate.nodes.allNodes.forEach((t=>{t.options.lineColor=e.data.color,t.relationships.associations.forEach((t=>{t.lineColor=e.data.color})),t.relationships.refreshOwnRelationships()}))},onSlateNameChanged(e){t.slate.options.name=e.data.name},onSlateDescriptionChanged(e){t.slate.options.description=e.data.description},onSlateShowGridChanged(e){t.slate.options.viewPort.showGrid=e.data.showGrid,e.data.showGrid?t.slate.grid.show():t.slate.grid.destroy()},onSlateMindMapModeChanged(e){t.slate.options.mindMapMode=e.data.mindMapMode},onSlateAutoResizeNodesBasedOnTextChanged(e){t.slate.options.autoResizeNodesBasedOnText=e.data.autoResizeNodesBasedOnText},onSlateTemplateChanged(e){t.slate.options.isTemplate=e.data.isTemplate},onSlateSnapToObjectsChanged(e){t.slate.options.viewPort.snapToObjects=e.data.snapToObjects},onSlateFollowMeChanged(e){t.slate.options.followMe=e.data.followMe},onSlateHuddleChanged(e){null!=e.data.huddleType&&(t.slate.options.huddleType=e.data.huddleType),null!=e.data.huddleEnabled&&(t.slate.options.huddleEnabled=e.data.huddleEnabled)}},t.pc.onCollaboration&&t.pc.onCollaboration({type:"init",slate:t.slate,cb(e){t._process(e)}}),t.pc.localizedOnly&&u.localRecipients.push(t)}_process(t){const e=this;if(u.localRecipients.length>1){let e=0;u.localRecipients.forEach((o=>{var s;e+=10,s=u.localRecipients[o],setTimeout((()=>{s.collab.invoke(t)}),e)}))}else e.invoker[t.type]?e.invoker[t.type](t):e.pc.onCollaboration&&e.pc.onCollaboration({type:"custom",slate:e.slate,pkg:t})}invoke(t){this.invoker[t.type]&&this.invoker[t.type](t)}closeNodeSpecifics(t){const e=this;(t.data.nodeOptions?t.data.nodeOptions:[t.data]).forEach((t=>{const o=e.slate.nodes.one(t.id);o?(o.menu?.hide(),o.connectors?.remove(),o.resize?.hide(),o.rotate?.hide(),o.relationships.associations.forEach((t=>{o.lineOptions?.hide(t.id)}))):console.error("Unable to find node with id",t.id,"currentIds",e.slate.nodes.allNodes.map((t=>t.options.id)))})),e.slate.removeContextMenus(),e.slate.untooltip()}send(t){const e=this;"onMouseMoved"!==t.type&&e.slate.undoRedo&&e.slate.options.showUndoRedo&&e.slate.undoRedo.snap(),e.pc.allow&&(e.slate.options?.onSlateChanged&&e.slate.options.onSlateChanged.apply(e,[t]),e.pc.onCollaboration&&e.pc.onCollaboration({type:"process",slate:e.slate,pkg:t}))}}class S{constructor(t,e){this.slate=t,this.node=e}setTextOffset(){this.node.options.allowDrag&&(this.node.options.textBounds=this.node.vect.getBBox(),this.node.options.textOffset={x:this.node.options.textBounds.cx-this.node.options.textBounds.width/2-this.node.options.xPos,y:this.node.options.textBounds.cy-this.node.options.yPos,width:this.node.options.textBounds.width,height:this.node.options.textBounds.height})}set(t,e,o,s,i,n,a){t||""===t||(t=this.node.options.text||"§"),e||(e=this.node.options.fontSize||12),null==i&&(i=this.node.options.textOpacity||1),o||(o=this.node.options.fontFamily||"Roboto"),s||(s=this.node.options.foregroundColor||"#000"),n||(n=this.node.options.textXAlign||"middle"),a||(a=this.node.options.textYAlign||"middle"),s===this.node.options.backgroundColor&&(s=u.whiteOrBlack(this.node.options.backgroundColor)),this.node.options.text=t,this.node.options.fontSize=e,this.node.options.fontFamily=o,this.node.options.foregroundColor=s,this.node.options.textOpacity=i,this.node.options.textXAlign=n,this.node.options.textYAlign=a;let r=null;this.setTextOffset(),r=this.node.textCoords(),this.node.text||(this.node.text=this.slate.paper.text(this.node.options.xPos+r.x,this.node.options.yPos+r.y,t)),r=this.node.textCoords({x:this.node.options.xPos,y:this.node.options.yPos}),this.node.text.attr(r),this.node.text.attr({text:t}),this.node.text.attr({"font-size":`${e}pt`}),this.node.text.attr({"font-family":o}),this.node.text.attr({fill:s}),this.node.text.attr({"text-anchor":n}),this.node.text.attr({"text-baseline":a}),this.node.text.attr({"fill-opacity":i}),this.node.text.attr({class:"slatebox-text"});const l=["-webkit-user-select","-moz-user-select","-ms-user-select","user-select"].map((t=>`${t}: none;`)).join(" ");if(this.node.text.attr({style:l}),this.slate.options.autoResizeNodesBasedOnText){const t=u.getTextWidth(this.node.options.text,`${this.node.options.fontSize}pt ${this.node.options.fontFamily}`);console.log("textDimens",this.node.options.text,`${this.node.options.fontSize}pt ${this.node.options.fontFamily}`,t.width,t.fontBoundingBoxAscent+t.fontBoundingBoxDescent);let e=this.node.vect.getBBox();const o=(t.width-20)/e.width,s=(t.fontBoundingBoxAscent+t.fontBoundingBoxDescent-20)/e.height,i=p.transformPath(this.node.options.vectorPath,`s${o}, ${s}`).toString();this.node.options.vectorPath=i,e=this.node.vect.getBBox(),this.node.options.width=e.width,this.node.options.height=e.height,this.node.vect.attr({path:i}),this.node.relationships&&this.node.relationships.refreshOwnRelationships()}"§"===t?(this.node.options.text="",this.node.text.attr({text:""})):setTimeout((()=>{this.node.text.attr({text:t})}),10)}}function E(t,e){const o=t.getTotalLength();let s,i,n=64,a=1/0;function r(t){const o=t.x-e.x,s=t.y-e.y;return o*o+s*s}for(let e,l,d=0;d<=o;d+=n)(l=r(e=t.getPointAtLength(d)))<a&&(s=e,i=d,a=l);for(n/=2;n>.5;){let e,l,d,c,h,p;(d=i-n)>=0&&(h=r(e=t.getPointAtLength(d)))<a?(s=e,i=d,a=h):(c=i+n)<=o&&(p=r(l=t.getPointAtLength(c)))<a?(s=l,i=c,a=p):n/=2}return{bestPoint:s,bestLength:i}}function A(t,e){const o=t.x,s=t.y,i=e.x,n=e.y,a=(o+i)/2;return["M",o.toFixed(2),s.toFixed(2),"C",a.toFixed(2),s.toFixed(2),a.toFixed(2),n.toFixed(2),i.toFixed(2),n.toFixed(2)].join(" ")}function T({relationships:t,nodes:e,dx:o=0,dy:s=0}){t.forEach((t=>{const i=function(t={}){const e=(t.parent,t.parent.vect.getBBox()),o=(t.child,t.child.vect.getBBox());function s(t){return!Number.isNaN(parseFloat(t))&&Number.isFinite(t)}const i=s(e.cx)&&e.cx,n=s(e.cy)&&e.cy,a=s(o.cx)&&o.cx,r=s(o.cy)&&o.cy;let l;const d=e.x,c=e.y,h=e.x2,p=e.y,u=e.x2,f=e.y2,g=e.x,m=e.y2;let y;l=r>=(f-c)/(u-d)*(a-d)+c?r>=(p-m)/(h-g)*(a-g)+m?{x:i,y:f}:{x:d,y:n}:r>=(p-m)/(h-g)*(a-g)+m?{x:h,y:n}:{x:i,y:c};const x=o.x,b=o.y,v=o.x2,w=o.y,k=o.x2,C=o.y2,_=o.x,P=o.y2;return y=n>=(C-b)/(k-x)*(i-x)+b?n>=(w-P)/(v-_)*(i-_)+P?{x:a,y:C}:{x:x,y:r}:n>=(w-P)/(v-_)*(i-_)+P?{x:v,y:r}:{x:a,y:b},{child:y,parent:l}}(t);let n,a,r;if(e.some((e=>e.options.id===t.parent.options.id))){n=t.parent.getTempPathWithCorrectPositionFor({pathElement:t.parent.vect,dx:o,dy:s}),a=t.child.getTempPathWithCorrectPositionFor({pathElement:t.child.vect,dx:0,dy:0});const e=E(a||t.child.vect,i.parent).bestPoint;r=A(E(n||t.parent.vect,e).bestPoint,e)}else{a=t.child.getTempPathWithCorrectPositionFor({pathElement:t.child.vect,dx:o,dy:s}),n=t.parent.getTempPathWithCorrectPositionFor({pathElement:t.parent.vect,dx:0,dy:0});const e=E(a||t.child.vect,i.parent).bestPoint;r=A(E(n||t.parent.vect,e).bestPoint,e)}const l={stroke:t.lineColor,fill:"none","stroke-width":t.lineWidth,"fill-opacity":t.lineOpacity,opacity:t.lineOpacity,filter:t.lineEffect?`url(#${t.lineEffect})`:""};(!t.isAlt||!t.isShift||t.isAlt&&t.isShift&&t.isUp)&&(l.path=r),t.showChildArrow?Object.assign(l,{"arrow-end":"classic"}):Object.assign(l,{"arrow-end":"none"}),t.showParentArrow?Object.assign(l,{"arrow-start":"classic"}):Object.assign(l,{"arrow-start":"none"}),t.line.attr(l),n&&n.remove(),a&&a.remove()})),e.length>0&&(e[0].slate?.grid?.toBack(),e[0].slate?.canvas?.bgToBack())}class B{constructor(t,e){const o=this;o.slate=t,o.node=e,o.PATH_COMPLEXITY_LIMIT=1e5,o.associations=[],o._isLastAlt=!1,o._isLastShift=!1,o.selectedNodes=[],o.relationshipsToTranslate=[],o.relationshipsToRefresh=[],o._dx=0,o._dy=0,o.collabSent=null,o.slate.draggingNode=!1,o.ft=null,o.kdTree=null,o.gracefulClear=null,o.dragEvents={move(t,e){o.enactMove(t,e)},async up(){o.finishDrag(!0)},dragger(t,e,s){o.slate.canvas.isDragging||(o.node.toggleImage({active:!0}),o.node.events?.onClick?o.node.events.onClick.apply(o,[function(){o._initDrag(o,s)}]):o._initDrag(o,s))}}}showMenu(t){const e=this;e.slate.nodes.closeAllMenus({exception:e.node.options.id}),e.slate.enable(),e.node?.menu?.show&&e.node.options.allowMenu&&!e.node.menu.isOpen()&&(e.node?.options.groupId&&e.slate.multiSelection.showGroup(e.node?.options.groupId),e.node.menu.show()),u.stopEvent(t)}finishDrag(t){const e=this;console.log("done dragging node",e.draggingNode),e.slate.draggingNode=!1,e.selectedNodes.forEach((t=>{u.transformPath(t,`T${e._dx},${e._dy}`),t.vect.currentDx=0,t.vect.currentDy=0,t.editor.setTextOffset()})),T({relationships:e.relationshipsToRefresh,nodes:e.selectedNodes,dx:0,dy:0}),e.slate.nodes.saveRelationships(e.relationshipsToTranslate,{dx:e._dx,dy:e._dy}),t&&(e.send({nodes:e.selectedNodes,relationships:e.relationshipsToRefresh.concat(e.relationshipsToTranslate)}),e.selectedNodes.forEach((t=>{t.relationships.showAll(!0)})),e.foreignPoints?.length>0&&(e.kdTree.dispose(),delete e.foreignPoints,clearTimeout(e.gracefulClear),e.gracefulClear=setTimeout((()=>{e.node.gridLines.clear()}),200))),e.slate.toggleFilters(!1),e.showMenu()}enactMove(t,e,o){const s=this;t=Math.ceil(t),e=Math.ceil(e);const i=s.slate.options.viewPort.zoom.r;t+=t/i-t,e+=e/i-e,s.selectedNodes.forEach(((o,i)=>{if(o.vect.currentDx=t,o.vect.currentDy=e,o.translateWith({dx:t,dy:e}),0===i&&o.options.id!==s.slate.tempNodeId){s.kdTree.knn([o.options.xPos,o.options.yPos],2).forEach((o=>{({dx:t,dy:e}=s.node.gridLines.draw(s.foreignPoints[o].id,t,e,s.foreignPoints[o].bbox))}))}})),s.slate.nodes.translateRelationships(s.relationshipsToTranslate,{dx:t,dy:e}),T({relationships:s.relationshipsToRefresh,nodes:s.selectedNodes,dx:t,dy:e}),s._dx=t,s._dy=e,o&&s.finishDrag(!1)}_broadcast(t){this.slate.collab?.send(t)}_hitTest(t){const e=this;let o=null;const s=u.positionedOffset(e.slate.options.container);return e.slate.nodes.allNodes.forEach((i=>{if(i.options.id!==e.slate.tempNodeId&&i.options.id!==e.node.options.id&&i.options.allowContext&&i.options.allowResize){const n=i.vect.getBBox(),a=e.slate.options.viewPort.zoom.r,r=e.slate.options.viewPort.left+t.x-s.left,l=e.slate.options.viewPort.top+t.y-s.top,d={x:r+(r/a-r),y:l+(l/a-l)};d.x>n.x&&d.x<n.x+n.width&&d.y>n.y&&d.y<n.y+n.height&&(o=i)}})),o}_remove(t,e,o){const s=[],i=this;return t.forEach((t=>{t[e].options.id===o.options.id?i.removeRelationship(t):s.push(t)})),s}_initDrag(t,e){const o=this;if(o.selectedNodes=[],o.relationshipsToRefresh=[],o.relationshipsToTranslate=[],o.collabSent=!1,o.slate.draggingNode=!0,o._dx=0,o._dy=0,o.slate.multiSelection?.end(),o.slate.options.linking)o.slate.options.linking.onNode.apply(t,[o]);else if(o.node.options.allowDrag&&!o.node.options.disableDrag){o.selectedNodes=o.getSelectedNodes();const t=o.slate.nodes.getRelevantAssociationsWith(o.selectedNodes);o.relationshipsToTranslate=t.relationshipsToTranslate,o.relationshipsToRefresh=t.relationshipsToRefresh,o.selectedNodes.forEach((t=>{t.setStartDrag(),t.vect.ox=t.options.xPos,t.vect.oy=t.options.yPos}));const e=o.selectedNodes.map((t=>t.options.id));o.foreignPoints=o.slate.nodes.allNodes.filter((t=>-1===e.indexOf(t.options.id))).map((t=>({id:t.options.id,bbox:t.vect.getBBox(),point:[t.options.xPos,t.options.yPos]}))),o.kdTree=i(o.foreignPoints.map((t=>t.point))),o.conditionallyHideAll()}else u.stopEvent(e)}async initiateTempNode(t,e,o){const s=this,i=u.mousePos(t),n=e.slate,a=u.positionedOffset(n.options.container),r=s.slate.options.viewPort.zoom.r,l=n.options.viewPort.left+i.x-a.left,d=n.options.viewPort.top+i.y-a.top,c=l+(l/r-l),h=d+(d/r-d),p=u._transformPath(g.icons.handle,`T${c-15}, ${h-15}`),f=new C({id:s.slate.tempNodeId,xPos:c,yPos:h,lineColor:"#990000",backgroundColor:"#ffffff",vectorPath:p,width:30,height:30});n.nodes.add(f,!0);const m=e.relationships.addAssociation(f,o,!0);m.hoveredOver=null,m.lastHoveredOver=null,f.vect.start(t),n.options.allowDrag=!1,f.vect.mousemove((t=>{null===m.hoveredOver&&(m.hoveredOver=s._hitTest(u.mousePos(t)),null!==m.hoveredOver&&m.hoveredOver.vect.animate({"stroke-width":5},500,(()=>{m.hoveredOver.vect.animate({"stroke-width":s.node.options.borderWidth},500,(()=>{m.hoveredOver=null}))})))})),f.vect.mouseup((t=>{e.relationships.removeAssociation(f),f.slate.nodes.remove(f);const i=s._hitTest(u.mousePos(t));if(null!==i){const t=i.relationships.associations.filter((t=>i.options.id===t.child.options.id));i.options.parents=t.map((t=>t.parent.options.id));if(!e.relationships.associations.find((t=>t.child.options.id===i.options.id&&t.parent.options.id===e.options.id||t.parent.options.id===i.options.id&&t.child.options.id===e.options.id))){e.relationships.addAssociation(i,o);const t={type:"addRelationship",data:{type:"association",parent:e.options.id,child:i.options.id}};s.slate.birdsEye?.relationshipsChanged(t),s._broadcast(t)}}s.slate.options.enabled&&(e.slate.options.allowDrag=!0)}))}_visibility(t){if(this.node.options.id!==this.slate.tempNodeId)for(let e=this.associations.length;e<this.associations.length;e+=1)this.associations[e].line[t]()}removeAll(){const t=this;t.associations.forEach((e=>{e.child.relationships.removeAssociation(t.node),e.parent.relationships.removeAssociation(t.node),t.removeRelationship(e)})),t.associations=[]}removeAssociation(t){return this.associations=this._remove(this.associations,"child",t),this.associations=this._remove(this.associations,"parent",t),this}setKeys({isShift:t,isAlt:e}){this._isLastShift=t,this._isLastAlt=e}addAssociation(t,e){e=e||{};let o=this.associations.find((e=>e.child.options.id===t.options.id));if(!o){const s={id:u.guid(),parent:this.node,child:t,lineColor:e.lineColor||this.node.options.lineColor,lineWidth:e.lineWidth||this.node.options.lineWidth,lineOpacity:e.lineOpacity||this.node.options.lineOpacity,lineEffect:e.lineEffect||this.node.options.lineEffect,blnStraight:e.isStraightLine||!1,showParentArrow:e.showParentArrow||!1,showChildArrow:e.showChildArrow||!0};o=this.createNewRelationship(s),o.line.toBack(),this.associations.push(o),t.relationships.associations.push(o),this.wireLineEvents(o)}return t.slate.allLines.push(o),o}createNewRelationship(t){const{paper:e}=this.slate,o={parent:null,child:null,lineColor:"#fff",lineOpacity:1,lineEffect:"",lineWidth:20,blnStraight:!1,showParentArrow:!1,showChildArrow:!0};Object.assign(o,t);const s={stroke:o.lineColor,class:"association",fill:"none","stroke-width":o.lineWidth,"fill-opacity":o.lineOpacity,filter:o.lineEffect?`url(#${o.lineEffect})`:"",opacity:o.lineOpacity};return o.line||Object.assign(o,{line:e.path(A({x:1,y:1},{x:200,y:200})).attr(s)}),o.child&&o.parent&&T({relationships:[o],nodes:[o.parent]}),o}removeRelationship(t){this.node.slate?.allLines.splice(this.slate?.allLines.findIndex((e=>e.id===t.id))),t.line.remove()}wireLineEvents(t){const e=this;e.node.options.allowMenu&&(t.line.node.style.cursor="pointer",t.line.mousedown((o=>{u.stopEvent(o),e.node.lineOptions.show(o,t)})),e.slate?.grid.toBack(),e.slate?.canvas.bgToBack())}getSelectedNodes(){const t=this;return t.selectedNodes=[],!1===t.node.options.isLocked&&(t.selectedNodes.push(t.node),this.syncAssociations(t.node,((e,o)=>{t.selectedNodes.some((t=>t.options.id===e.options.id))||!1!==e.options.isLocked||t.selectedNodes.push(e)}))),t.selectedNodes}syncAssociations(t,e){const o=this;(!o.slate.isCtrl||o.slate.isCtrl&&o.slate.isShift)&&t.relationships.associations.forEach((s=>{s.child.options.id!==o.node.options.id&&s.child.options.id!==t.options.id&&(e&&e(s.child,s),o.slate.isCtrl&&o.slate.isShift&&o.syncAssociations(s.child,e))}))}updateAssociationsWith(t){const e={};t.conditional&&(t.conditional.forEach(((t,o)=>{e[o]=t})),delete t.conditional),this.associations.forEach((o=>{Object.assign(o,t),Object.keys(e).forEach((t=>{const s=e[t];s.condition(o,s.data)&&(o[s.key]=s.getValue(o,s.data))}))}))}updateSingleAssociationWith(t,e){const o=this.associations.find(a,t);o&&Object.assign(o,e)}send(t){if(this.node.context&&!this.node.context.isVisible()&&this.node.options.allowDrag&&!this.node.options.disableDrag){const e={type:"onNodesMove"};t.nodes&&t.relationships?e.data=this.slate.nodes.nodeMovePackage({nodes:t.nodes,relationships:t.relationships}):e.data=this.slate.nodes.nodeMovePackage(),this.slate.collab?.send(e),this.slate.birdsEye?.nodeChanged(e),this.collabSent=!0}}conditionallyHideAll(){const t=this;if(t.node.options.id!==t.slate.tempNodeId){const e=t.node.options.vectorPath.length>t.PATH_COMPLEXITY_LIMIT;e&&t.hideAll(!0),t.associations.forEach((o=>{const s=e||o.child.options.vectorPath.length>t.PATH_COMPLEXITY_LIMIT;o.child.relationships.hideAll(s)}))}}hideAll(t){(this.slate.isAlt&&this.slate.isShift||t)&&this._visibility("hide")}hideOwn(){this.associations.forEach((t=>{t.line.hide()}))}showOwn(){this.associations.forEach((t=>{t.line.show()}))}showAll(t){(this._isLastAlt&&this._isLastShift||t)&&this._visibility("show")}refreshOwnRelationships(){T({relationships:this.associations,nodes:[this.node]})}wireDragEvents(){const t=this;function e(){t.slate.events?.onTextPaneRequested?.apply(this,[t.node,()=>{}])}!t.slate.isReadOnly()&&(!t.slate.isCommentOnly()||t.slate.isCommentOnly()&&t.node.options.isComment)&&(t.node.vect.drag(t.dragEvents.move,t.dragEvents.dragger,t.dragEvents.up),t.node.text.mousedown((e=>{t.node.vect.start(e)})),t.node.vect.dblclick((()=>{e()})),t.node.text.dblclick((()=>{e()})))}}class O{static getRotationAngle(t,e,o){const s=t.x-o.x,i=t.y-o.y,n=e.x-o.x,a=e.y-o.y,r=Math.sqrt(s**2+i**2),l=Math.sqrt(n**2+a**2);let d;if(0===s&&0===i||0===n&&0===a||s===n&&i===a);else{const t=(s*n+i*a)/(r*l);d=180*Math.acos(t)/Math.PI;s*a-i*n<0&&(d=-d)}return d}set(t){const e=this,o=t||e.rotationAngle;e.rotate.transform(`R${e.rotationAngle}, ${e.origCenter.x}, ${e.origCenter.y}`);const s={rotate:{rotationAngle:(e.node.options.rotate.rotationAngle+o)%360,point:e.origCenter}},i=e.node.getTransformString(s);e.node.vect.transform(i),e.node.text.transform(i)}constructor(t,e){const o=this;function s(){const t=o.node.snappedAt||o.rotationAngle;if(t){const e={rotationAngle:(o.node.options.rotate.rotationAngle+t)%360,point:o.origCenter};Object.assign(o.node.options.rotate,e);const s=o.node.vect.getBBox();o.node.options.width=s.width,o.node.options.height=s.height,o.rotateTemp.remove(),o.node.relationships.updateAssociationsWith({rotationAngle:o.node.options.rotate.rotationAngle}),o.node.gridLines.clear(),delete o.foreignPoints,delete o.kdTree,delete o.node.snappedAt}o.slate.isBeingResized=!1,o.node.menu.hide(),o._isResizing=!1,o.slate.enable(!1,!0),o.node.setEndDrag(),o.node.relationships.refreshOwnRelationships(),o.node.relationships.showOwn(),o.rotate.remove(),o.node.events?.onRotated?.apply?o.node.events?.onRotated?.apply(o,[_self.send]):o.send()}o.slate=t,o.node=e,o.rotate=null,o.rotateTemp=null,o._dragAllowed=!1,o._isResizing=!1,o._initPosFix=!1,o.origCenter={},o.rotationAngle=null,o.relationshipsToTranslate=[],o.relationshipsToRefresh=[],o.selectedNodes=[],o.rotateEvents={start(){o.selectedNodes=o.node.relationships.getSelectedNodes();const t=o.slate.nodes.getRelevantAssociationsWith(o.selectedNodes);o.relationshipsToTranslate=t.relationshipsToTranslate,o.relationshipsToRefresh=t.relationshipsToRefresh,o.slate.isBeingResized=!0,o._initPosFix=!1,o.rotateTemp.attr({x:o.rotateTemp.attr("x")-1e3,y:o.rotateTemp.attr("y")-1e3,width:1e4,height:1e4}),o.rotate.ox=o.rotate.attr("x"),o.rotate.oy=o.rotate.attr("y"),o.node.relationships.updateAssociationsWith({activeNode:o.node.options.id,currentDx:0,currentDy:0,action:"rotate"}),o._isResizing=!0;const e=o.slate.paper.path(o.node.vect.attr("path")),s=e.getBBox();o.node.options.rotate?.point&&0!==Object.entries(o.node.options.rotate.point).length||(o.node.options.rotate.point={x:s.cx,y:s.cy}),e.remove(),o.slate.multiSelection?.end(),this.ox=s.x,this.oy=s.y,o.origCenter=o.node.options.rotate.point,o.foreignPoints=o.slate.nodes.allNodes.filter((t=>t.options.id!==o.node.options.id)).map((t=>({id:t.options.id,bbox:t.vect.getBBox(),point:[t.options.xPos,t.options.yPos]}))),o.kdTree=i(o.foreignPoints.map((t=>t.point))),o.node.setStartDrag(),o.node.connectors.remove(),o.node.resize.hide(),o._dragAllowed=o.slate.options.allowDrag,o.slate.disable(!1,!0),o.slate.toggleFilters(!0,o.node.options.id)},move(t,i){const n=this;try{o.kdTree.knn([e.options.xPos,e.options.yPos],5).forEach((e=>{o.node.gridLines.draw(o.foreignPoints[e].id,t,i,o.foreignPoints[e].bbox,!1,200)})),o.rotationAngle=O.getRotationAngle({x:n.ox,y:n.oy},{x:n.ox+t,y:n.oy+i},o.origCenter),o.rotationAngle&&(o.node.snappedAt||o.set())}catch(t){s()}},up(){s(),o.slate.toggleFilters(!1,o.node.options.id)}}}show(t,e){const o=this;if(o.node.options.allowResize){o.rotateTemp?.remove();const s=o.slate.paper;o.rotate=s.path("M16.659,24c-5.078,0-9.213-3.987-9.475-9h2.975l-4.5-5l-4.5,5h3.025 c0.264,6.671,5.74,12,12.475,12c3.197,0,6.104-1.21,8.315-3.185l-2.122-2.122C21.188,23.127,19.027,24,16.659,24z M29.133,14c-0.265-6.669-5.74-12-12.475-12c-3.197,0-6.104,1.21-8.315,3.185   l2.122,2.122C12.129,5.873,14.29,5,16.659,5c5.077,0,9.213,3.987,9.475,9h-2.975l4.5,5l4.5-5H29.133z").attr({fill:"#fff",stroke:"#000",x:t-5,y:e-5});let i=o.rotate.getBBox();const n=u._transformPath(o.rotate.attr("path"),`T${t-i.x-15},${e-i.y-15}`);o.rotate.attr({path:n}),i=o.rotate.getBBox(),o.rotateTemp=s.rect(i.x,i.y,i.width,i.height).attr({fill:"#f00",opacity:1e-8}).toFront(),o.rotate.mouseover((t=>{o.rotate.attr({cursor:"alias"})})),o.rotateTemp.mouseover((t=>{o.rotateTemp.attr({cursor:"alias"})})),o.rotateTemp.drag(o.rotateEvents.move,o.rotateEvents.start,o.rotateEvents.up)}return o.rotate}hide(){this.rotate?.remove(),this.rotateTemp?.remove()}send(){const t={type:"onNodeRotated",data:{id:this.node.options.id,rotate:this.node.options.rotate,textOffset:this.node.options.textOffset,imageOrigWidth:this.node.options.imageOrigWidth,imageOrigHeight:this.node.options.imageOrigHeight,associations:this.node.relationships.associations.map((t=>({parentId:t.parent.options.id,childId:t.child.options.id,linePath:t.line.attr("path").toString()})))}};this.slate.birdsEye?.nodeChanged(t),this.slate.collab?.send(t)}applyImageRotation(t={}){const{r:e}=this.slate.options.viewPort.zoom;this.node.vect.transform(""),this.node.text.transform("");const o=t.boundingClientRect||this.node.vect[0].getBoundingClientRect(),s=this.slate.paper.path(this.node.vect.attr("path")),i=s.getBBox(),n=this.node.getTransformString(t);if(this.node.vect.transform(n),this.node.text.transform(n),this.node.vect.pattern){const t=this.node.vect.pattern.getElementsByTagName("image")[0];t.setAttribute("y",(o.height/e-i.height)/2-4),t.setAttribute("x",(o.width/e-i.width)/2-4)}s.remove()}animateSet(t,e){const o=this,s=`...R${t.rotationAngle},${t.rotate.point.x}, ${t.rotate.point.y}`;o.node.vect.animate({transform:s},e.duration||500,e.easing||">",(()=>{const t=o.node.getTransformString();o.node.vect.transform(t),e.cb&&e.cb()})),o.node.text.animate({transform:s},e.duration||500,e.easing||">",(()=>{const t=o.node.getTransformString();o.node.text.transform(t)})),e.associations.forEach((t=>{const s=o.node.relationships.associations.find((e=>e.parent.options.id===t.parentId&&e.child.options.id===t.childId));s&&s.line.animate({path:t.linePath},e.duration||500,e.easing||">",(()=>{s.line.attr({path:t.linePath})}))}))}}class z{constructor(t,e){this.slate=t,this.node=e,this._m=null,this._isOpen=!1}isOpen(){return this._isOpen}show(){const t=this,e=t.slate.paper;t._m&&(s(t._m,"remove"),t._m=null);const o=t.node.vect.getBBox(),i=o.x,n=o.y;t._m=e.set(),t._isOpen=!0,t.node.connectors.show(i,n,t._m,(()=>{t.slate.events?.onMenuRequested&&t.slate.events?.onMenuRequested(t.node,(()=>{}))}))}hide(t){this._m&&(this._m.forEach((e=>{e.id!==t&&e.remove()})),this._m.items=t?null:this._m.items.filter((e=>e.id!==t)),this.node?.connectors?.iconBar?.remove()),this.node.rotate.hide(),this._isOpen=!1}}class N{constructor(t,e){this.slate=t,this.node=e,this.buttons=null,this.iconBar=null,this._lastUnpinned={options:{xPos:null,width:null,yPos:null}}}_broadcast(t,e,o,s){const i={type:"onNodeAdded",data:{id:this.node.options.id,skipCenter:t,options:e,targetXPos:o,targetYPos:s}};this.slate.collab&&this.slate.collab.send(i)}remove(){const t=this;t.buttons&&Object.keys(t.buttons).forEach((e=>{t.buttons[e].remove()})),t.iconBar?.remove(),t.node.menu._isOpen=!1}removeSettingsButton(){this.buttons.setting.remove()}show(t,e,o,s){const i=this,n=i.slate.paper,a=i.node.vect.getBBox(),r=a.width/2,l={fill:"#fff",stroke:"#000"};function d(o){switch(o){case"delete":if(i.node.options.showDelete)i.buttons.trash=n.trash().transform(["t",t+r-80,",",e-58].join()).attr({fill:"#fff",stroke:"#f00"});else if(i.node.options.showAddAndDeleteConditionally&&i.node.options.copiedFromId){const o=i.slate.nodes.allNodes.filter((t=>t.options.copiedFromId===i.node.options.copiedFromId)).map((t=>t.options.copiedAt));i.node.options.copiedAt>=Math.max(...o)&&(i.buttons.trash=n.trash().transform(["t",t+r-80,",",e-58].join()).attr({fill:"#fff",stroke:"#f00"}))}break;case"add":{const o=i.slate.nodes.allNodes.filter((t=>t.options.copiedFromId===i.node.options.id)).length;if(i.node.options.showAdd||0===o&&i.node.options.showAddAndDeleteConditionally&&!i.node.options.copiedFromId)i.buttons.unPinned=n.plus().transform(["t",t+r+40,",",e-58].join()).attr(l);else if(i.node.options.showAddAndDeleteConditionally&&i.node.options.copiedFromId){const o=i.slate.nodes.allNodes.filter((t=>t.options.copiedFromId===i.node.options.copiedFromId)).map((t=>t.options.copiedAt));i.node.options.copiedAt>=Math.max(...o)&&(i.buttons.unPinned=n.plus().transform(["t",t+r+40,",",e-58].join()).attr(l))}break}}}if(i.buttons={},(i.slate.isCommentOnly()&&i.node.options.isComment||!i.slate.isCommentOnly())&&(i.node.options.showMenu&&(i.buttons.setting=n.setting().transform(["t",t+r,",",e-58].join()).attr(l)),i.node.options.isComment&&i.slate.canRemoveComments()&&d("delete")),i.node.options.isLocked||i.node.options.isComment||i.slate.isCommentOnly()||(d("add"),d("delete"),i.node.options.showRelationshipConnector&&(i.buttons.handle=n.handle().transform(["t",t+r-40,",",e-58].join()).attr(l))),["mousedown"].forEach((t=>{i.buttons.setting&&i.buttons.setting[t]((t=>{i.slate.unglow(),s.apply(i),u.stopEvent(t),i.slate.multiSelection&&i.slate.multiSelection.end(),i.node.context&&i.node.context.remove(),i.node.links&&i.node.links.unset()})),i.buttons.unPinned&&i.buttons.unPinned[t]((function(t){u.stopEvent(t),this.loop(),i.slate.unglow(),i.node.connectors?.addNode(),i.node.menu?.hide(),i.node.context?.remove()})),i.buttons.trash&&i.buttons.trash[t]((t=>{const e=i.node.options.groupId;u.stopEvent(t),i.node.del(),i.slate.unglow();const o={type:"onNodeDeleted",data:{id:i.node.options.id,isComment:i.node.options.isComment}};i.slate.collab?.send(o),i.slate.birdsEye?.nodeDeleted(o),e&&i.slate.multiSelection.showGroup(e)})),i.buttons.handle&&i.buttons.handle[t]((t=>{u.stopEvent(t),i.slate.unglow(),i.node.relationships.initiateTempNode(t,i.node,!0)}))})),Object.keys(i.buttons).length>1){const o=40*Object.keys(i.buttons).length;i.iconBar=n.rect(t+r-85,e-63,o,43,3).attr({stroke:"#000",fill:"#fff"}).toFront()}if(Object.keys(i.buttons).forEach((t=>{const e=i.buttons[t];e.toFront(),o.push(e),e.mouseover((function(){i.slate.glow(this)})),e.mouseout((()=>{i.slate.unglow()}))})),!i.node.options.isLocked&&!i.node.options.isComment&&!i.slate.isCommentOnly()){if(i.node.options.showResize){const s=i.node.resize.show(t+a.width,e+a.height);o.push(s)}if(i.node.options.showRotate){const s=i.node.rotate.show(t,e);o.push(s)}}return i}reset(){this._lastUnpinned={options:{xPos:null,width:null,yPos:null}}}createNode(t,e,o,s,i){const n=this,a=new C(e);return n.slate.nodes.add(a),u.transformPath(a,`T${o-a.options.xPos}, ${s-a.options.yPos}`),a.options.xPos=o,a.options.yPos=s,a.editor.set(),n._lastUnpinned=a.options,n.slate.options.mindMapMode&&n.node.relationships.addAssociation(a),n.slate.birdsEye?.refresh(!1),i&&n._broadcast(t,e,o,s),i&&a.options.showMenu&&void 0===t&&a.position("center",(()=>{n.slate.events?.onTextPaneRequested?.apply(this,[a,t=>{}])})),a}addNode(t){const e=this;1===e.slate.nodes.allNodes.filter((t=>t.options.copiedFromId===e.node.options.copiedFromId&&t.options.copiedAt>=e.node.options.copiedAt)).length&&e.reset();const s=JSON.parse(JSON.stringify(e.node.options)),i=u.guid();if(!e.node.options.width){const t=e.node.vect.getBBox();e.node.options.width=t.width,e.node.options.height=t.height}s.id=i;const n=(e._lastUnpinned.xPos||e.node.options.xPos)+(e._lastUnpinned.width||e.node.options.width||220)+e.node.options.spaceBetweenNodesWhenAdding||30,a=e._lastUnpinned.yPos||e.node.options.yPos;if(1===s.opacity&&(s.text=""),s.copiedFromId=e.node.options.copiedFromId||e.node.options.id,s.copiedAt=(new Date).valueOf(),!e.slate.options.basedOnThemeId)return e.createNode(t,s,n,a,!0);e.slate.events.onThemeRequired({themeId:e.slate.options.basedOnThemeId},((i,r)=>{if(i)console.error("Unable to apply theme",i);else{let t=e.slate.findChildren([s.id]).length+1;t>Object.keys(r.styles).length&&(t=1);const i=r.styles[`child_${t}`];i&&Object.assign(s,o(i,"vectorPath"))}return e.createNode(t,s,n,a,!0)}))}}class M{constructor(t,e){const o=this;function s(){o.node.vect.attr({path:o.node.options.vectorPath}),o.node.relationships.showAll(!0),o.slate.isBeingResized=!1,o._isResizing=!1,o.slate.enable(!1,!0),o.resize.remove(),o.resizeTemp.remove(),o.node.setEndDrag();const t=o.node.vect.getBBox();o.node.toggleImage({active:!1,width:t.width,height:t.height}),o.node.options.width=t.width,o.node.options.height=t.height,o.node.options.xPos=t.x,o.node.options.yPos=t.y,o.node.editor.setTextOffset(),o.node.text.attr(o.node.textCoords({x:o.node.options.xPos,y:o.node.options.yPos})),o.node.gridLines.clear(),delete o.foreignPoints,delete o.kdTree,o.node.events&&o.node.events?.onResized?o.node.events.onResized.apply(o,[o.send]):o.send()}o.slate=t,o.node=e,o.resize=null,o.resizeTemp=null,o.origX=null,o.origY=null,o.lastDx=null,o.lastDy=null,o._minWidth=5,o._minHeight=5,o._dragAllowed=!1,o._origWidth=null,o._origHeight=null,o._isResizing=!1,o.origPath=null,o.origPoint={},o.resizeEvents={start(){const t=this;o.node.toggleImage({active:!0,keepResizerOpen:!0}),o.origPath=o.node.options.vectorPath,o.origPoint=o.node.options.rotate.point,o.origX=o.resizeTemp.attr("x"),o.origY=o.resizeTemp.attr("y"),o.node.options.hasResized=!0,o.resizeTemp.attr({x:o.resizeTemp.attr("x")-1e3,y:o.resizeTemp.attr("y")-1e3,width:1e4,height:1e4}),o.slate.isBeingResized=!0,o.node.relationships.updateAssociationsWith({activeNode:o.node.options.id,currentDx:0,currentDy:0,action:"resize"}),o.lastDx=0,o.lastDy=0;const e=o.resize.getBBox();o.resize.ox=e.x,o.resize.oy=e.y,o._isResizing=!0,o.slate.multiSelection?.end(),t.ox=t.attr("x"),t.oy=t.attr("y"),o.node.setStartDrag(),o.node.connectors.remove(),o.node.rotate.hide(),o._dragAllowed=o.slate.options.allowDrag,o.slate.disable(!1,!0)," "!==o.node.options.text&&(o._minWidth=10,o._minHeight=10),o._origWidth=o.node.options.width,o._origHeight=o.node.options.height,o.foreignPoints=o.slate.nodes.allNodes.filter((t=>t.options.id!==o.node.options.id)).map((t=>({id:t.options.id,bbox:t.vect.getBBox(),point:[t.options.xPos,t.options.yPos]}))),o.kdTree=i(o.foreignPoints.map((t=>t.point))),o.node.relationships.conditionallyHideAll(),o.slate.toggleFilters(!1)},move(t,i){const n=this;try{const s=o.slate.options.viewPort.zoom.r;if(o.slate.options.viewPort.showGrid&&o.slate.options.viewPort.snapToGrid){const e=o.slate.options.viewPort.gridSize||10;t=Math.round(t/e)*e,i=Math.round(i/e)*e}t+=t/s-t,i+=i/s-i;o.kdTree.knn([e.options.xPos,e.options.yPos],5).forEach((e=>{o.node.gridLines.draw(o.foreignPoints[e].id,t,i,o.foreignPoints[e].bbox,!1,200)}));let a=o._origWidth+2*t,r=o._origHeight+2*i;if(o.slate.isCtrl&&o.node.options.origVectWidth&&o.node.options.origVectHeight){Math.max(a,r)===a?a=o.node.options.origVectWidth*r/o.node.options.origVectHeight:r=o.node.options.origVectHeight*a/o.node.options.origVectWidth}a>o._minWidth?n.attr({x:n.ox+t}):n.attr({x:n.ox}),r>o._minHeight?n.attr({y:n.oy+i}):n.attr({y:n.oy});const l=`T${t}, ${i}`;o.resize.transform(l),o.node.events?.onResizing?.apply(o,[a,r]),o.set(a,r,{isMoving:!0,getRotationPoint:o.node.options.rotate.rotationAngle}),o.node.images.imageSizeCorrection(),o.lastDx=2*t,o.lastDy=2*i}catch(t){s()}},async up(){o.slate.toggleFilters(!1),s()}}}show(t,e){const o=this;if(o.node.options.allowResize){o.resizeTemp?.remove();const s=o.slate.paper,i=u._transformPath(g.icons.resize,`t${t-5},${e-5} r95`);return o.resize=s.path(i).attr({fill:"#fff",stroke:"#000"}),o.resizeTemp=s.rect(t-6,e-6,20,20).attr({fill:"#f00",opacity:1e-8}).toFront(),o.resizeTemp.mouseover((t=>{o.node.overMenuButton=!0,o.resizeTemp.attr({cursor:"pointer"})})),o.resizeTemp.mouseout((t=>{o.node.overMenuButton=!1})),o.resizeTemp.drag(o.resizeEvents.move,o.resizeEvents.start,o.resizeEvents.up),o.resize}}hide(){this.resizeTemp?.remove(),this.resize?.remove()}send(){const t=this.node.text.attrs,e={type:"onNodeResized",data:{id:this.node.options.id,textPosition:{x:t.x,y:t.y},rotate:this.node.options.rotate,vectorPath:this.node.options.vectorPath,associations:this.node.relationships.associations.map((t=>({parentId:t.parent.options.id,childId:t.child.options.id,linePath:t.line.attr("path").toString()})))}},o=r(this.node.options.rotate.point);this.slate.birdsEye?.nodeChanged(e),this.node.options.rotate.point=o,this.slate.collab?.send(e)}lazySend(){n(this.send,700)}animateSet(t,e){const o=this;o.node.text.animate(t.textPosition,e.duration||500,e.easing||">"),o.node.vect.animate({path:t.vectorPath,transform:`R${t.rotate.rotationAngle}, ${t.rotate.point.x}, ${t.rotate.point.y}`},e.duration||500,e.easing||">",(()=>{const{image:t,imageOrigHeight:e,imageOrigWidth:s}=o.node.options;t&&e&&s&&o.node.images.imageSizeCorrection()})),e.associations.forEach((t=>{const s=o.node.relationships.associations.find((e=>e.parent.options.id===t.parentId&&e.child.options.id===t.childId));e.animate?s&&s.line.animate({path:t.linePath},e.duration||500,e.easing||">",(()=>{s.line.attr({path:t.linePath})})):s&&s.line.attr({path:t.linePath})}))}set(t,e,o={}){const s=this;let i=s.node.vect.attr("path").toString();o.getRotationPoint&&(s.origPoint=s.node.options.rotate.point),s.origPoint&&Object.entries(s.origPoint).length>0&&s.node.options.rotate.rotationAngle>0&&(i=p.transformPath(i,`R${s.node.options.rotate.rotationAngle}, ${s.origPoint.x}, ${s.origPoint.y}`)),s.node.vect.transform(""),s.node.text.transform(""),s.node.vect.attr({path:i}),s.node.text.attr({path:i});const n=s.node.vect.getBBox();let a=1,r=1;t>s._minWidth?(a=t/n.width,s.node.options.width=t):(a=s._minWidth/n.width,s.node.options.width=s._minWidth),e>s._minHeight?(r=e/n.height,s.node.options.height=e):(r=s._minHeight/n.height,s.node.options.height=s._minHeight);const l=`s${a}, ${r}`,d=p.transformPath(s.node.vect.attr("path").toString(),l).toString();i=d,s.node.vect.attr({path:d}),s.origPoint&&Object.entries(s.origPoint).length>0&&s.node.options.rotate.rotationAngle>0&&(i=p.transformPath(i,`R${-s.node.options.rotate.rotationAngle}, ${s.origPoint.x}, ${s.origPoint.y}`).toString()),s.node.vect.attr({path:i}),s.node.options.vectorPath=i;const c=s.node.vect.getBBox();s.node.options.rotate.point={x:c.cx,y:c.cy},s.node.setPosition({x:c.x,y:c.y},!0),s.node.rotate.applyImageRotation();const h=s.node.linkCoords();s.node.link.transform(["t",h.x,",",h.y,"s",".8",",",".8","r","180"].join()),s.node.relationships.refreshOwnRelationships(),s.node.editor.setTextOffset(),s.node.text.attr(s.node.textCoords({x:s.node.options.xPos,y:s.node.options.yPos}))}}class ${constructor(t,e){this.slate=t,this.node=e}getTargetImageDimensions(){let t,e;const o=this.node.options.imageOrigWidth/this.node.options.imageOrigHeight,s=this.slate.paper.path(this.node.vect.attr("path")),i=s.getBBox(),n=i.width/i.height;return o<n?(e=i.width,t=i.width/o):o>n?(t=i.height,e=i.height*o):(e=i.width,t=i.height),s.remove(),{width:e,height:t}}imageSizeCorrection(){if(this.node.vect.pattern){const t=this.getTargetImageDimensions(),e=this.node.vect.pattern.getElementsByTagName("image")[0];e.setAttribute("height",t.height),e.setAttribute("width",t.width)}}set(t,e,o,s){this.node.vect.data({relativeFill:!0}),this.node.options.image=t,this.node.options.origImage={w:e,h:o},this.node.options.imageOrigHeight=o,this.node.options.imageOrigWidth=e,this.node.options["fill-opacity"]=1;const i={fill:`url(${this.node.options.image})`,"stroke-width":this.node.options.borderWidth,stroke:"#000"},n=this.getTargetImageDimensions();this.node.vect.imageOrigHeight=n.height,this.node.vect.imageOrigWidth=n.width,this.node.vect.attr({"fill-opacity":1}),this.node.vect.attr(i);const a=this.node.vect.getBBox();this.node.options.width=a.width,this.node.options.height=a.height,this.node.relationships.refreshOwnRelationships(),s?(this.node.setPosition({x:a.x,y:a.y},!0),this.node.menu?.hide(),this.node.rotate?.hide()):this.node.setPosition({x:a.x,y:a.y}),this.node.connectors?.remove()}}class R{constructor(t,e){this.slate=t,this.node=e}async set(t={sendCollab:!1}){this.slate.unglow();let e="";switch(t.shape){case"ellipse":e=u._transformPath(`M${this.node.options.xPos+75},${this.node.options.yPos+50} m -75,0 a75,50 0 1,0 150,0 a 75,50 0 1,0 -150,0Z`),this.node.options.isEllipse=!0;break;case"rect":e=t.rx>0?u._transformPath(`M${this.node.options.xPos},${this.node.options.yPos} h130 a10,10 0 0 1 10,10 v80 a10,10 0 0 1 -10,10 h-130 a10,10 0 0 1 -10,-10 v-80 a10,10 0 0 1 10,-10 z`):u._transformPath(`M${this.node.options.xPos},${this.node.options.yPos} h150 v100 h-150 v-100 z`),this.node.options.isEllipse=!1;break;default:e=u._transformPath(t.shape,`T${this.node.options.xPos},${this.node.options.yPos}`),this.node.options.isEllipse=!1}if(this.node.options.vectorPath=e,this.node.options.origVectWidth=t.width,this.node.options.origVectHeight=t.height,this.node.options.width=t.width,this.node.options.height=t.height,this.node.vect.attr({path:e}),this.node.editor.setTextOffset(),this.node.text.attr(this.node.textCoords({x:this.node.options.xPos,y:this.node.options.yPos})),this.node.vect.pattern&&(this.node.images.imageSizeCorrection(),this.node.rotate.applyImageRotation()),this.node.text.toFront(),this.node.link.toFront(),this.node.relationships.refreshOwnRelationships(),t.keepResizerOpen&&(this.node.menu?.hide(),this.node.rotate?.hide()),this.node.vect.data({id:this.node.options.id}),this.node.context.create(),t.sendCollab){const e={type:"onNodeShapeChanged",data:{id:this.node.options.id,shape:t.shape,width:t.width,height:t.height,sendCollab:!1,rx:t.rx}};this.slate.collab?.send(e),this.slate.birdsEye?.nodeChanged(e)}}}class L{constructor(t,e){this.slate=t,this.node=e}set(t,e,o,s){let i=t;if(e&&o){const s=Math.max(this.node.options.width,this.node.options.height)/Math.max(e,o);i=u._transformPath(t,["s",s,",",s].join(""))}this.node.shapes.set({shape:i.toString(),sendCollab:null==s||s})}}class I{constructor(t,e){this.slate=t,this.node=e}set(t){this.node.options.backgroundColor=t.color,null!=t.opacity&&(this.node.options.opacity=t.opacity),this.node.vect.attr({fill:t.color,"fill-opacity":this.node.options.opacity}),""===t.color&&""!==this.node.options.text?(this.node.vect.attr({stroke:this.node.options.borderColor||"#000"}),this.node.options.borderWidth=0):this.node.vect.attr({stroke:this.node.options.borderColor||"#000","stroke-width":this.node.options.borderWidth}),this.node.relationships.refreshOwnRelationships()}}class F{constructor(t,e){this.slate=t,this.node=e,this._contextMenu=null,this._priorAllowDrag=!0}ctx(t){return this._priorAllowDrag=this.node.options.allowDrag,this.node.options.allowDrag=!1,this.remove(),this.buildContext(t),setTimeout((()=>{this.node.options.allowDrag=this._priorAllowDrag}),2),u.stopEvent(t)}create(){this.node.text&&this.node.text.node&&this.node.options.allowContext&&!this.node.slate.isAlt&&!this.node.slate.isShift&&(this.node.text.node.oncontextmenu=this.ctx,this.node.vect.node.oncontextmenu=this.ctx)}buildContext(t){this._contextMenu=document.createElement("div"),this._contextMenu.setAttribute("id",`contextMenu_${this.node.options.id}`),this._contextMenu.setAttribute("class","sb_cm"),document.body.appendChild(this._contextMenu),this.setContext(t)}menuItems(){const t="<div style='padding:5px;' class='sbthis._contextMenuItem' rel='{func}'>{text}</div>";let e=t.replace(/{func}/g,"tofront").replace(/{text}/g,"to front");return e+=t.replace(/{func}/g,"toback").replace(/{text}/g,"to back"),this._priorAllowDrag?e+=t.replace(/{func}/g,"lock").replace(/{text}/g,"lock"):e+=t.replace(/{func}/g,"unlock").replace(/{text}/g,"unlock"),e+=t.replace(/{func}/g,"close").replace(/{text}/g,"close"),e}setContext(t){const e=this;this._contextMenu.innerHTML=this.menuItems();const o=u.select("div.contextMenuItem");for(let t=o.length;t<o.length;t+=1){o[t].onclick=()=>{const t=this.getAttribute("rel");let o=!1;const s={type:"",data:{id:e.node.options.id}};switch(t){case"tofront":e.node.toFront(),o=!0,s.type="onNodeToFront";break;case"toback":e.node.toBack(),o=!0,s.type="onNodeToBack";break;case"lock":e.node.options.isLocked=!0,e.node.disable(),s.type="onNodeLocked";break;case"unlock":e.node.options.isLocked=!1,e.node.enable(),s.type="onNodeUnlocked"}if(o){let t=0;for(let o=e.node.slate.paper.bottom;null!=o;o=o.next)if("ellipse"===o.type||"rect"===o.type){t+=1;const s=o.data("id");if(s){e.node.slate.nodes.allNodes.find((t=>t.options.id===s)).sortorder=t}}e.node.slate.nodes.allNodes.sort(((t,e)=>t.sortorder<e.sortorder?-1:1))}""!==s.type&&e.broadcast(s),this.remove()}}const s=u.mousePos(t),i=s.x,n=s.y;this._contextMenu.style.left=`${i}px`,this._contextMenu.style.top=`${n}px`}broadcast(t){this.node.slate.collab&&this.node.slate.collab.send(t),this.node.slate.birdsEye&&this.node.slate.birdsEye.nodeChanged(t)}remove(){this.node.slate?.removeContextMenus(),this._contextMenu=null}isVisible(){return null!==this._contextMenu}}class D{constructor(t,e){this.slate=t,this.node=e,this.m={}}broadcast(t){t.data.id=this.node.options.id,this.slate.collab?.send(t)}set(t){const e=this.node.relationships.associations[t.index];t.updateChild?e.child.options[t.prop]=t.val:this.node.options[t.prop]=t.val,"toggle"===t.val?e[t.prop]=!e[t.prop]||(t.prop,!1):e[t.prop]=t.val,T({relationships:[e],nodes:[this.node]})}show(t,e){const o=this;o.hideAll(),o.slate.nodes.closeAllLineOptions(e.id);const s=o.node.relationships.associations.find((t=>t.id===e.id)),i=o.slate.paper,n=u.mousePos(t),a=u.positionedOffset(o.slate.options.container),r=o.slate.options.viewPort.zoom.r;let l=(n.x+o.slate.options.viewPort.left-a.left-90)/r,d=(n.y+o.slate.options.viewPort.top-a.top-30)/r;const c=s.line.getBBox();l=c.cx,d=c.cy,o.m[e.id]=i.set();const h=(t,e)=>["t",l+t,",",d+e].join(),p={fill:"#fff","fill-opacity":"1.0",stroke:"#333","stroke-width":1,cursor:"pointer"},f=[],g=o.node.options.showRelationshipReassign?i.handle().attr(p).transform(h(15,0)):null,m=o.node.options.showRelationshipProperties?i.setting().attr(p).transform(h(-15,0)):null,y=o.node.options.showRelationshipDelete?i.trash().transform(h(-45,0)).attr({fill:"#fff",stroke:"#f00"}):null;g&&f.push(g),f&&f.push(m),y&&f.push(y);const x=[];function b(t){if(x.forEach((t=>{t.remove()})),u.stopEvent(t),o.slate.options.enabled){const t={type:"removeRelationship",data:{parent:e.parent.options.id,child:e.child.options.id}};o.slate.nodes.removeRelationship(t.data),o.slate.birdsEye?.relationshipsChanged(t),o.broadcast(t),o.hide(e.id)}}return f.forEach((e=>{e.mouseover((function(){x.push(this.glow()),u.stopEvent(t)})),e.mouseout((()=>{x.forEach((t=>{t.remove()})),u.stopEvent(t)}))})),m&&m.mousedown((t=>{u.stopEvent(t),x.forEach((t=>{t.remove()}));const s=o.node.relationships.associations.find((t=>t.id===e.id));o.slate.events?.onLineMenuRequested&&(o.hideAll(),o.slate.events?.onLineMenuRequested(o.node,s,(()=>{})))})),g&&g.mousedown((()=>{b(),o.node.relationships.initiateTempNode(t,e.parent,{showChildArrow:s.showChildArrow,showParentArrow:s.showParentArrow})})),y&&y.mousedown((()=>{b()})),f.forEach((t=>{o.m[e.id].push(t)})),o}hide(t){this.m[t]&&(s(this.m[t],"remove"),this.m[t]=null)}hideAll(){const t=this;t.node.relationships.associations.map((t=>t.id)).forEach((e=>{t.hide(e)}))}}class j{constructor(t,e){this.slate=t,this.node=e,this.guideWings=2e4,this.guideAttrs={"stroke-dasharray":"--",stroke:"#000"},this.guideLines={rightVerticals:{},leftVerticals:{},topHorizontals:{},bottomHorizontals:{}}}clear(){const t=this;["rightVerticals","leftVerticals","topHorizontals","bottomHorizontals"].forEach((e=>{t.guideLines[e]&&Object.keys(t.guideLines[e]).forEach((o=>t.guideLines[e][o].remove())),t.guideLines[e]={}}))}draw(t,e,o,s,i=!0,n=100,a=20){const r=this,l=null==r.slate.options.viewPort.snapToObjects||r.slate.options.viewPort.snapToObjects;let d=!1,c=!1;const h=r.node.vect.getBBox();return r.guideAttrs.stroke=u.whiteOrBlack(r.slate.options.containerStyle.backgroundColor),h.x-s.x2<n&&h.x-s.x2>=0||s.x2-h.x2<n&&s.x2-h.x2>=0?(r.guideLines.rightVerticals[t]||(r.guideLines.rightVerticals[t]=r.slate.paper.path(`M ${s.x2} ${s.y-r.guideWings} L ${s.x2} ${s.y2+r.guideWings}`).attr(r.guideAttrs)),c=h.x-s.x2<a&&h.x-s.x2>=0||s.x2-h.x2<a&&s.x2-h.x2>=0,c&&l&&(h.x-s.x2<a&&h.x-s.x2>=0?e-=h.x-s.x2:e+=s.x2-h.x2)):(r.guideLines?.rightVerticals[t]?.remove(),delete r.guideLines?.rightVerticals[t]),!c&&(s.x-h.x2<n&&s.x-h.x2>=0||h.x-s.x<n&&h.x-s.x>=0)?(r.guideLines.leftVerticals[t]||(r.guideLines.leftVerticals[t]=r.slate.paper.path(`M ${s.x} ${s.y-r.guideWings} L ${s.x} ${s.y2+r.guideWings}`).attr(r.guideAttrs)),c=s.x-h.x2<a&&s.x-h.x2>=0||h.x-s.x<a&&h.x-s.x>=0,c&&l&&(s.x-h.x2<a&&s.x-h.x2>=0?e+=s.x-h.x2:e-=h.x-s.x)):(r.guideLines?.leftVerticals[t]?.remove(),delete r.guideLines?.leftVerticals[t]),s.y-h.y2<n&&s.y-h.y2>=0||h.y-s.y<n&&h.y-s.y>=0?(r.guideLines.topHorizontals[t]||(r.guideLines.topHorizontals[t]=r.slate.paper.path(`M ${s.x-r.guideWings} ${s.y} L ${s.x2+r.guideWings} ${s.y}`).attr(r.guideAttrs)),d=s.y-h.y2<a&&s.y-h.y2>=0||h.y-s.y<a&&h.y-s.y>=0,d&&l&&(s.y-h.y2<a&&s.y-h.y2>=0?o+=s.y-h.y2:o-=h.y-s.y)):(r.guideLines?.topHorizontals[t]?.remove(),delete r.guideLines?.topHorizontals[t]),!d&&(h.y-s.y2<n&&h.y-s.y2>=0||s.y2-h.y2<n&&s.y2-h.y2>=0)?(r.guideLines.bottomHorizontals[t]||(r.guideLines.bottomHorizontals[t]=r.slate.paper.path(`M ${s.x-r.guideWings} ${s.y2} L ${s.x2+r.guideWings} ${s.y2}`).attr(r.guideAttrs)),d=h.y-s.y2<a&&h.y-s.y2>=0||s.y2-h.y2<a&&s.y2-h.y2>=0,d&&l&&(h.y-s.y2<a&&h.y-s.y2>=0?o-=h.y-s.y2:o+=s.y2-h.y2)):(r.guideLines?.bottomHorizontals[t]?.remove(),delete r.guideLines?.bottomHorizontals[t]),i&&(c||d)&&r.node.translateWith({dx:e,dy:o}),{dx:e,dy:o}}}class W{constructor(t,e){this.slate=t,this.node=e,this.node.link.click((t=>{this.click()}))}set(t,e){if(this.node.options.link=t,e){const e={type:"onNodeLinkAdded",data:t};this.slate.collab&&this.slate.collab.send(e)}}unset(t){if(this.node.options.link=null,t){const t={type:"onNodeLinkRemoved",data:pkg};this.slate.collab&&this.slate.collab.send(t)}}click(){const t=this;switch(this.node.options.link.type){case"url":window.open(t.node.options.link.data,"sb_external");break;case"externalSlate":break;case"currentSlate":{const e=t.slate.nodes.one(t.node.options.link.data);console.log("pos ",e),e.position("center",(()=>{}),"swingTo",500);break}}}}class H{constructor(t){this.slate=t,this.ensureBe=null,this.allNodes=[]}_refreshBe(){const t=this;window.clearTimeout(t.ensureBe),t.ensureBe=window.setTimeout((()=>{t.slate.birdsEye?.refresh(!1)}),10)}_getParentChild(t){let e,o;return this.allNodes.forEach((s=>{s.options.id===t.parent?e=s:s.options.id===t.child&&(o=s)})),{p:e,c:o}}static remove(t,e){return t.filter((t=>t.options.id!==e.options.id))}copyNodePositions(t,e=!1){const o=this;t.forEach((t=>{let s=o.allNodes.find((e=>e.options.id===t.options.id));s||(o.add(t),s=o.allNodes.find((e=>e.options.id===t.options.id))),s.setPosition({x:t.options.xPos,y:t.options.yPos});const i={};if(e){const t=o.slate.paper.path(s.vect.attr("path"));i.boundingClientRect=t[0].getBoundingClientRect(),t.remove()}s.rotate.applyImageRotation(i)})),s(o.allNodes.map((t=>t.relationships)),"refresh")}addRange(t){const e=this;return t.forEach((t=>{e.add(t)})),e}removeRange(t){const e=this;return t.forEach((t=>{e.allNodes=H.remove(e.allNodes,t)})),e}add(t,e){const o=this;Array.isArray(t)||(t=[t]),t.forEach((t=>{t.slate=o.slate,o.allNodes.push(t),o.addToCanvas(t,e)}))}remove(t){const e=this;Array.isArray(t)||(t=[t]),t.forEach((t=>{e.allNodes=H.remove(e.allNodes,t),t.slate=null,e.removeFromCanvas(t)}))}nodeMovePackage(e={}){let o=this.slate,s=null;if(e&&e.moves){s=document.createElement("div");const t=`copy_${u.guid()}`;s.setAttribute("id",t),s.setAttribute("style","width:1px;height:1px;display:none;"),document.body.appendChild(s),o=this.slate.copy({container:t,moves:e.moves})}const i=e?.nodes||o.nodes.allNodes,n={dur:e?e.dur:300,easing:e?e.easing:">",textPositions:i.map((t=>({id:t.options.id,textPosition:{x:t.text.attrs.x,y:t.text.attrs.y,transform:t.getTransformString()}}))),nodeOptions:i.map((t=>t.options)),associations:(()=>{const s=[];return e.relationships&&e.nodes?e.relationships.forEach((t=>{s.push({parentId:t.parent.options.id,childId:t.child.options.id,linePath:t.line.attr("path").toString(),id:t.line.id})})):o.nodes.allNodes.forEach((t=>{t.relationships.associations.forEach((t=>{s.push({parentId:t.parent.options.id,childId:t.child.options.id,linePath:t.line.attr("path").toString(),id:t.line.id})}))})),t(s,(t=>t.id))})()};return s&&document.removeChild(s),n}moveNodes(e,o={}){this.closeAllLineOptions(),this.closeAllMenus();const s=[];this.allNodes.forEach((t=>{t.relationships.associations.forEach((t=>{s.push(t)}))}));const i=t(s,(t=>t.id)),n=e.data||e,a=n.dur||300,r=n.easing||">",{associations:l,nodeOptions:d,textPositions:c}=n;let h=0;function p(){h+=1,h===d.length&&o.cb&&(o.cb(),delete o.cb)}d.forEach((t=>{const e=this.allNodes.find((e=>e.options.id===t.id));if(e){Object.assign(e.options,t);const s=function(t,e){let o=t.x-5,s=t.x+e.width/2,i=t.y+e.height/2;return"ellipse"===e.vectorPath&&(o=t.cx-5,s=t.cx,i=t.cy),{lx:o,tx:s,ty:i}}({x:t.xPos,y:t.yPos},e.options),{lx:i,ty:n}=s,l=c.find((e=>e.id===t.id));if(o.animate?(e.text.animate(l.textPosition,a,r),e.link.animate({x:i,y:n},a,r)):(e.text.attr(l.textPosition),e.link.attr({x:i,y:n})),o.animate)e&&e.vect.animate({path:t.vectorPath,transform:e.getTransformString()},a,r,(()=>{e.vect.attr({path:t.vectorPath}),e.images.imageSizeCorrection(),p()}));else{e&&e.vect.attr({path:t.vectorPath});let s={};if(o.useMainCanvas){const t=this.slate.paper.path(e.vect.attr("path"));s={boundingClientRect:t[0].getBoundingClientRect()},t.remove()}e.rotate.applyImageRotation(s),e.images.imageSizeCorrection(),p()}}})),l.forEach((t=>{const e=i.find((e=>e.parent.options.id===t.parentId&&e.child.options.id===t.childId));o.animate?e&&e.line.animate({path:t.linePath},a,r,(()=>{e.line.attr({path:t.linePath}),p()})):(e&&e.line.attr({path:t.linePath}),p())})),this.slate.birdsEye?.refresh(!0)}getRelevantAssociationsWith(t){const e=[],o=[];return t.forEach((s=>{const i=t.filter((t=>t.options.id!==s.options.id));s.relationships.associations.forEach((t=>{i.map((t=>t.relationships.associations)).some((e=>e.find((e=>e.id===t.id))))?e.some((e=>e.id===t.id))||e.push(t):o.some((e=>e.id===t.id))||o.push(t)}))})),{relationshipsToRefresh:o,relationshipsToTranslate:e}}translateRelationships(t,{dx:e,dy:o}){t.forEach((t=>{t.line.transform(`T${e}, ${o}`)}))}saveRelationships(t,{dx:e,dy:o}){t.forEach((t=>{const s=u._transformPath(t.line.attr("path").toString(),`T${e},${o}`).toString();t.line.attr({path:s}),t.line.transform("")}))}removeRelationship(t){const e=this._getParentChild(t),o=e.p,s=e.c;o&&s&&(o.relationships.removeAssociation(s),s.relationships.removeAssociation(o))}refreshAllRelationships(){this.allNodes.forEach((t=>{t.relationships.refreshOwnRelationships()}))}addRelationship(t){const e=this._getParentChild(t),o=e.p,s=e.c;if(o&&s&&"association"===t.type)o.relationships.addAssociation(s,t.options)}closeAllLineOptions(t){this.allNodes.forEach((e=>{e.relationships.associations.forEach((o=>{o.id!==t&&e.lineOptions?.hide(o.id)}))}))}closeAllMenus({exception:t,nodes:e}={}){(e||this.allNodes).forEach((e=>{e.options.id!==t&&(e.menu.hide(),e.lineOptions?.hideAll(),e.resize?.hide(),e.rotate?.hide())}))}closeAllConnectors(){this.allNodes.forEach((t=>{t.connectors?.remove(),t.resize?.hide(),t.rotate?.hide()}))}one(t){let e=null;return this.allNodes.forEach((o=>{o.options.id===t&&(e=o)})),e}removeFromCanvas(t){["vect","text","link"].forEach((e=>{t[e].remove()})),this._refreshBe()}addToCanvas(t,e){t.slate=this.slate;let o=null,s=null;const i={fill:t.options.backgroundColor||"#fff","fill-opacity":null!=t.options.opacity?t.options.opacity:1};Object.assign(i,t.applyBorder());const n=t.options.xPos,a=t.options.yPos,r=this.slate.paper,l=[`T${1*n}, ${1*a}`,`s${t.options.width/150*1}, ${t.options.height/100*1}, ${n}, ${a}`];switch(t.options.isEllipse=t.options.isEllipse||"ellipse"===t.options.vectorPath,t.options.vectorPath){case"ellipse":t.options.vectorPath=f("M150,50 a75,50 0 1,1 0,-1 z",l);break;case"rectangle":t.options.vectorPath=f("M1,1 h150 v100 h-150 v-100 z",l);break;case"roundedrectangle":t.options.vectorPath=f("M1,1 h130 a10,10 0 0 1 10,10 v80 a10,10 0 0 1 -10,10 h-130 a10,10 0 0 1 -10,-10 v-80 a10,10 0 0 1 10,-10 z",l)}"M2,12 L22,12"===t.options.vectorPath&&(i["stroke-dasharray"]="2px"),o=r.path(t.options.vectorPath).attr(i),o.node.style.cursor="pointer",o.node.setAttribute("rel",t.options.id),o.data({id:t.options.id}),t.vect=o,t.vect.transform(t.getTransformString());const d=o.getBBox();t.options.xPos=d.x,t.options.yPos=d.y;const c=t.linkCoords();return s=r.linkArrow().transform(["t",c.x,",",c.y,"s",".8",",",".8","r","180"].join()).attr({cursor:"pointer"}),t.editor=new S(this.slate,t),t.editor.set(),t.text.transform(t.getTransformString()),t.link=s,t.both=new t.slate.paper.set,t.both.push(t.vect),t.both.push(t.text),t.relationships=new B(this.slate,t),t.relationships.wireDragEvents(),t.rotate=new O(this.slate,t),t.connectors=new N(this.slate,t),t.menu=new z(this.slate,t),t.resize=new M(this.slate,t),t.images=new $(this.slate,t),t.context=new F(this.slate,t),t.lineOptions=new D(this.slate,t),t.shapes=new R(this.slate,t),t.customShapes=new L(this.slate,t),t.colorPicker=new I(this.slate,t),t.gridLines=new j(this.slate,t),t.links=new W(this.slate,t),t.options.image&&!t.options.imageOrigHeight&&(t.options.imageOrigHeight=t.options.height),t.options.image&&!t.options.imageOrigWidth&&(t.options.imageOrigWidth=t.options.width),t.options.image&&""!==t.options.image&&t.images.set(t.options.image,t.options.imageOrigWidth,t.options.imageOrigHeight,e),t.options.link&&t.options.link.show||t.link.hide(),t.applyFilters(),this._refreshBe(),o}}class G{constructor(t){const e=this;e.slate=t,e.selRect=null,e.ox=null,e.oy=null,e._init=null,e.marker=null,e.selectedNodes=[],e.relationshipsToTranslate=[],e.relationshipsToRefresh=[],e.origPos=null,e.resizer=null,e.minSize=100,e._icons=[],e.iconBg=null,e.moveX=0,e.moveY=0,e.attrs={create:{fill:"#fff",stroke:"#000"},mouseOut:{fill:"#fff",stroke:"#000"},mouseOver:{fill:"#ccc",cursor:"pointer"}}}init(){const t=this;if(t.slate.options.isbirdsEye)return;function e(){t.slate.options.allowDrag=!0,t.slate.birdsEye?.refresh(!0),t.selectedNodes.forEach((e=>{u.transformPath(e,`T${t.moveX},${t.moveY}`),e.vect.currentDx=0,e.vect.currentDy=0})),T({relationships:t.relationshipsToRefresh,nodes:t.selectedNodes,moveX:t.moveX,moveY:t.moveY}),t.slate.nodes.saveRelationships(t.relationshipsToTranslate,{dx:t.moveX,dy:t.moveY}),G.showConnections(t.relationshipsToTranslate.concat(t.relationshipsToRefresh)),t.broadcastMove(),t.showIcons(),t.origPos=t.marker.getBBox(),t.marker.toBack(),t.slate?.grid.toBack(),t.slate?.canvas.bgToBack()}const o=t.slate.options.container;t.slate.options.showMultiSelect&&(t._init=document.createElement("div"),t._init.setAttribute("class","slateMultiSelect"),t._init.style.position="absolute",t._init.style.height="30px",t._init.style.left="10px",t._init.style.color="#081272",t._init.style.fontSize="11pt",t._init.style.fontFamily="trebuchet ms",t._init.style.top="5px",t._init.style.display="block",t._init.style.padding="5px",t._init.style.margin="5px;",t._init.style.backgroundColor="#fff",t._init.style.cursor="pointer",t._init.style["user-select"]="none",t._init.innerHTML="[multi-select]",t._init.style.zIndex="0",o.appendChild(t._init),t.markerEvents={init(){t.hideIcons(),G.hideConnections(t.relationshipsToTranslate.concat(t.relationshipsToRefresh)),t.moveX=0,t.moveY=0,t.slate.options.allowDrag=!1,t.marker.ox=t.marker.attr("x"),t.marker.oy=t.marker.attr("y"),t.selectedNodes.forEach((t=>{const e=t.vect.getBBox();t.vect.ox=e.x,t.vect.oy=e.y}))},move(o,s){try{const e=t.slate.options.viewPort.zoom.r;o+=o/e-o,s+=s/e-s,t.moveX=o,t.moveY=s;const i={x:t.marker.ox+o,y:t.marker.oy+s};t.marker.attr(i),t.selectedNodes.forEach((t=>{t.vect.currentDx=o,t.vect.currentDy=s,t.translateWith({dx:o,dy:s})}));const n=t.origPos.x+t.origPos.width+o-5,a=t.origPos.y+t.origPos.height+s-5;t.resizer.transform(["t",n,",",a," r95 s1.5,1.5"].join(""))}catch(t){e()}},up(t){e()}},t.resizeEvents={init(){t.hideIcons(),G.hideConnections(t.relationshipsToTranslate.concat(t.relationshipsToRefresh)),t.moveX=0,t.moveY=0,t.slate.options.allowDrag=!1,t.selectedNodes.forEach((t=>{const e=t.vect.getBBox();t.vect.ox=e.x,t.vect.oy=e.y})),t.marker.toBack(),t.slate?.grid.toBack(),t.slate?.canvas.bgToBack()},move(e,o){const s=t.slate.options.viewPort.zoom.r;e+=e/s-e,o+=o/s-o,t.moveX=e,t.moveY=o;let i=t.origPos.width+2*e,n=t.origPos.height+2*o;const a=t.origPos.x+t.origPos.width+e-5,r=t.origPos.y+t.origPos.height+o-5;let l=!0,d=!0;i<t.minSize&&(i=t.minSize,l=!1),n<t.minSize&&(n=t.minSize,d=!1),t.resizer.transform(["t",a,",",r," r95 s1.5,1.5"].join(""));const c={width:i,height:n};l&&Object.assign(c,{x:t.origPos.x-e}),d&&Object.assign(c,{y:t.origPos.y-o}),t.marker.attr(c)},up(){G.showConnections(t.relationshipsToTranslate.concat(t.relationshipsToRefresh)),t.selectedNodes.forEach((e=>{const o=e.options.width+t.moveX,s=e.options.height+t.moveY;e.resize.set(o,s,{isMoving:!0,getRotationPoint:e.options.rotate.rotationAngle}),e.images.imageSizeCorrection()})),T({relationships:t.relationshipsToRefresh.concat(t.relationshipsToTranslate),nodes:t.selectedNodes,dx:0,dy:0}),t.broadcastMove(),t.origPos=t.marker.getBBox();const e=t.origPos.x+t.origPos.width,o=t.origPos.y+t.origPos.height;t.resizer.transform(["t",e-5,",",o-5].join("")),t.refreshMarker(),t.showIcons(),t.marker.toBack(),t.slate?.grid.toBack(),t.slate?.canvas.bgToBack(),t.slate.enable()}},u.addEvent(t._init,"click",(e=>{switch(t._init.innerHTML){case"[multi-select]":t.start();break;case"selecting [click to stop]...":t.end(!1),t.endSelection()}})))}hide(){this._init&&(this._init.style.display="none")}show(){this._init&&(this._init.style.display="block")}start(){const t=this;t.slate.disable(),t._init&&(t._init.innerHTML="selecting [click to stop]..."),document.head.insertAdjacentHTML("beforeend","<style id='svg-no-select-text'>.slatebox-text { -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; }</style>");t.slate.options.container;t.slate.onSelectionStart=e=>{if(t.slate.options.showMultiSelect){t.end();const o=t.xy(e);t.selRect=t.slate.paper.rect(o.x,o.y,10,10).attr({"stroke-dasharray":"-"}),u.addEvent(t.slate.canvas.get(),"mousemove",t._move.bind(t),null),u.addEvent(t.slate.canvas.get(),"mouseup",t._mouseUp.bind(t),null,!0),u.addEvent(t.slate.canvas.get(),"mouseleave",t._select.bind(t),null,!0),window.addEventListener("beforeunload",t._enableOnRefresh),t.ox=o.x,t.oy=o.y}}}_enableOnRefresh(){const t=this;t.relationshipsToTranslate=[],t.relationshipsToRefresh=[],t.selectedNodes=[],t.slate.enable(),t.broadcastMove()}createCopiedNodes(t,e){const o=this;t.forEach((t=>{const e=new et.node(t);o.slate.nodes.add(e)})),e.forEach((t=>{const e=o.slate.nodes.one(t.parentNodeId),s=o.slate.nodes.one(t.childNodeId),i=t.assocPkg;i.child=o.slate.nodes.one(t.assocPkg.childId),i.parent=o.slate.nodes.one(t.assocPkg.parentId),delete i.childId,delete i.parentId,e.relationships.addAssociation(s,i)}))}showIcons(){const e=this;if(null!==e.marker){const s=t(e.selectedNodes.map((t=>t.options.groupId))),i=1===s.length&&null!==s[0],n=e.marker.getBBox(),a=n.x+n.width+45,r=!1,d=200/4;e.iconBg?.remove(),e.iconBg=e.slate.paper.rect(a-10,n.y+d-10,50,3*d,5).attr({...e.attrs.create,opacity:.3}).toBack();const c=e.slate.paper.trash().attr({fill:"#fff",stroke:"#f00"}).transform(["t",a,",",n.y+3*d,"s",",","1.25","1.25"].join());c.mouseover((t=>{c.attr(e.attrs.mouseOver),u.stopEvent(t)})),c.mouseout((t=>{c.attr({fill:"#fff",stroke:"#f00"}),u.stopEvent(t)})),c.mousedown((t=>{u.stopEvent(t),e.del()}));const h=e.slate.paper.copy().attr(e.attrs.create).transform(["t",a,",",n.y+2*d,"s",",","1.25","1.25"].join());if(h.mouseover((t=>{h.attr(e.attrs.mouseOver),u.stopEvent(t)})),h.mouseout((t=>{h.attr(e.attrs.mouseOut),u.stopEvent(t)})),h.mousedown((t=>{u.stopEvent(t);e.slate.snapshot();const s=e.selectedNodes[0].options.groupId?u.guid().replace(/-/gi,"").substring(0,8).toUpperCase():null,i=e.slate.getOrientation(e.selectedNodes),n={},a=[],r=[];e.selectedNodes.forEach((t=>{const o=l(t.options);o.xPos+=i.width+75,o.groupId=s,o.id=u.guid().replace(/-/gi,"").substring(0,12),n[t.options.id]=o.id,o.vectorPath=u._transformPath(o.vectorPath,`T${i.width+75},0`),a.push(o);const r=new et.node(o);e.slate.nodes.add(r)}));const d=e.slate.nodes.allNodes;e.selectedNodes.forEach((t=>{const e=d.find((e=>e.options.id===n[t.options.id]));t.relationships.associations.filter((e=>e.parent.options.id===t.options.id)).forEach((t=>{const s=l(t);delete s.line,s.id=u.guid().replace(/-/gi,"").substring(0,12),s.activeNode=n[s.activeNode];let i=d.find((e=>e.options.id===n[t.child.options.id]));i||(i=d.find((e=>e.options.id===t.child.options.id)));const a=o(s,["child","parent"]);a.childId=s.child.options.id,a.parentId=s.parent.options.id,r.push({parentNodeId:e.options.id,childNodeId:i.options.id,assocPkg:a}),e.relationships.addAssociation(i,s)}))})),console.log("sending multiSelect collab",a,r);const c={type:"onNodeAdded",data:{multiSelectCopy:!0,nodeOptions:a,assocDetails:r}};e.slate.collab.send(c)})),e._icons.push(h),i){const t=e.slate.paper.minus().attr(e.attrs.create).transform(["t",a,",",n.y+d,"s",",","1.25","1.25"].join());if(t.mouseover((o=>{t.attr(e.attrs.mouseOver),u.stopEvent(o)})),t.mouseout((o=>{t.attr(e.attrs.mouseOut),u.stopEvent(o)})),t.mousedown((t=>{e.selectedNodes.forEach((t=>{t.options.groupId=null})),u.stopEvent(t),e.hideIcons(),e.showIcons()})),e._icons.push(t),r){const t=e.slate.paper.setting().attr(e.attrs.create).transform(["t",a,",",n.y+4*d,"s",",","1.25","1.25"].join());t.mouseover((o=>{t.attr(e.attrs.mouseOver),u.stopEvent(o)})),t.mouseout((o=>{t.attr(e.attrs.mouseOut),u.stopEvent(o)})),t.mousedown((t=>{u.stopEvent(t),e.selectedNodes[0].menu.show()})),e._icons.push(t)}}else{const t=e.slate.paper.plus().attr(e.attrs.create).transform(["t",a,",",n.y+d,"s",",","1.25","1.25"].join());t.mouseover((o=>{t.attr(e.attrs.mouseOver),u.stopEvent(o)})),t.mouseout((o=>{t.attr(e.attrs.mouseOut),u.stopEvent(o)})),t.mousedown((t=>{const o=u.guid().replace(/-/gi,"").substring(0,8).toUpperCase();e.selectedNodes.forEach((t=>{t.options.groupId=o})),u.stopEvent(t),e.endSelection(),e.end(),e.showGroup(o)})),e._icons.push(t)}e._icons.push(c)}}hideIcons(){this.iconBg?.remove(),this._icons?.forEach((t=>t.remove()))}isSelecting(){return null!==this.marker}del(){const t=this;t.slate.events.onConfirmRequested("Confirm Deletion",`Are you sure you want to remove these ${t.selectedNodes.length} node(s)?`,(e=>{e&&(t.selectedNodes.forEach((e=>{e.del(),t.slate.unglow();const o={type:"onNodeDeleted",data:{id:e.options.id}};t.slate.collab?.send(o),t.slate.birdsEye?.nodeDeleted(o)})),t.end())}))}end(t=!0){const e=this;null===e.marker&&t||(e.marker?.remove(),e.resizer?.remove(),e.marker=null,e.slate.enable(),e.hideIcons(),window.removeEventListener("beforeunload",e._enableOnRefresh)),e._init&&(e._init.innerHTML="[multi-select]")}endSelection(){const t=this;t.selRect?.remove(),t.showIcons(),t.slate.options.allowDrag=!0,t.slate.onSelectionStart=null,u.removeEvent(t.slate.canvas.get(),"mousemove",t._move.bind(t))}xy(t){const e=this,o=u.mousePos(t),s=u.positionedOffset(e.slate.options.container),i=o.x+e.slate.options.viewPort.left-s.left,n=o.y+e.slate.options.viewPort.top-s.top,a=e.slate.options.viewPort.zoom.r;return{x:i/a,y:n/a}}_move(t){const e=this;if(!e.slate.draggingNode){const o=e.xy(t),s=o.y-e.oy,i=o.x-e.ox;s>0?e.selRect.attr({height:s}):e.selRect.attr({y:o.y,height:e.oy-o.y}),i>0?e.selRect.attr({width:i}):e.selRect.attr({x:o.x,width:e.ox-o.x})}}showGroup(t){const e=this;e.selectedNodes=e.slate.nodes.allNodes.filter((e=>e.options.groupId===t)),e.prepSelectedNodes()&&(e.refreshMarker(),e.showIcons())}refreshMarker(){const t=this;t.marker?.remove(),t.resizer?.remove(),t.iconBg?.remove();const e=t.slate.options.viewPort.zoom.r,o=t.slate.getOrientation(t.selectedNodes);let s=o.width/e,i=o.height/e;s<t.minSize&&(s=t.minSize),i<t.minSize&&(i=t.minSize),t.marker=t.slate.paper.rect(o.left/e,o.top/e,s,i).attr({"stroke-dasharray":"-",fill:"#f8f8f8",opacity:.3}),t.marker.toBack(),t.slate?.grid.toBack(),t.slate?.canvas.bgToBack(),t.origPos=t.marker.getBBox();const n=t.origPos.x+t.origPos.width,a=t.origPos.y+t.origPos.height;t.resizer=t.slate.paper.resize().transform(["t",n-5,",",a-5,"r95 s1.5,1.5"].join()).attr({fill:"#fff",stroke:"#000"}),t.resizer.toFront(),t.resizer.mouseover((e=>{t.resizer.attr(t.attrs.mouseOver),u.stopEvent(e)})),t.resizer.mouseout((e=>{t.resizer.attr(t.attrs.mouseOut),u.stopEvent(e)})),t.marker.drag(t.markerEvents.move,t.markerEvents.init,t.markerEvents.up),t.resizer.drag(t.resizeEvents.move,t.resizeEvents.init,t.resizeEvents.up)}prepSelectedNodes(){const t=this;if(!(t.selectedNodes.length>1))return 1===t.selectedNodes.length?(t.selectedNodes[0].menu.show(),t.slate.enable(),t.endSelection(),t.end(),!1):(t.slate.enable(),t.endSelection(),t.end(),!0);{const e=t.slate.nodes.getRelevantAssociationsWith(t.selectedNodes);t.relationshipsToTranslate=e.relationshipsToTranslate,t.relationshipsToRefresh=e.relationshipsToRefresh,t.refreshMarker(),t.endSelection(),t.slate.nodes.closeAllMenus({nodes:t.selectedNodes})}return!1}_mouseUp(t){this._init&&(this._init.innerHTML="[multi-select]"),this._select(t)}_select(e){const o=this,s=o.selRect.getBBox();if(s){const e=o.slate.nodes.allNodes.filter((t=>t.options.xPos+t.options.width>s.x&&t.options.xPos<s.x+s.width&&t.options.yPos+t.options.height>s.y&&t.options.yPos<s.y+s.height&&!t.options.isLocked)),i=t(e.map((t=>t.options.groupId))).filter((t=>!!t)),n=e.map((t=>t.options.id));o.selectedNodes=o.slate.nodes.allNodes.filter((t=>n.includes(t.options.id)||i.includes(t.options.groupId))),o.prepSelectedNodes()}}static hideConnections(t){t.forEach((t=>{t.line.hide()}))}static showConnections(t){t.forEach((t=>{t.line.show()}))}broadcastMove(){const t=this,e={type:"onNodesMove",data:t.slate.nodes.nodeMovePackage({nodes:t.selectedNodes,relationships:t.relationshipsToTranslate.concat(t.relationshipsToRefresh)})};t.slate.collab?.send(e),t.slate.birdsEye?.nodeChanged(e)}}class U{constructor(t){this.slate=t,this.be=null,this.corner=null,this.handle=null,this.orx=null,this.sp=null,this.options={size:200,onHandleMove:null},this.parentDimen=null,this.lastX=null,this.lastY=null,this.wpadding=null,this.hpadding=null}setBe(){this.be&&(this.be.style.left=this.parentDimen.width-this.options.size+"px"),this.be&&(this.be.style.top="-2px")}_hideText(){this.corner.nodes.allNodes.forEach((t=>{t.text.hide()}))}_wireHandle(){const t=this;let e={};t.handle.drag((function(e,o){const s=t.corner.options.viewPort.originalWidth/t.sp;e+=e/s-e,o+=o/s-o;const i=t.handle.ox+e,n=t.handle.oy+o;t.handle.attr({x:i,y:n});const a=t.handle.getBBox(),r=a.x*t.slate.options.viewPort.zoom.r,l=a.y*t.slate.options.viewPort.zoom.r;t.options.onHandleMove?.apply(t,[r,l]),t.slate.canvas.move({x:r,y:l,dur:0,isAbsolute:!0}),t.lastX=a.x,t.lastY=a.y}),(function(){t.handle.ox=this.attr("x"),t.handle.oy=this.attr("y"),e=u.positionedOffset(t.slate.canvas.internal)}),(()=>{t.refresh();const o=u.positionedOffset(t.slate.canvas.internal);t.slate.canvas.broadcast({x:e.left-o.left,y:e.top-o.top})}))}show(t){const e=this;Object.assign(e.options,t);const o=e.slate.options.container;e.parentDimen=u.getDimensions(o),e.be=document.createElement("div"),e.be.setAttribute("id",`slatebirdsEye_${e.slate.options.id}`),e.be.setAttribute("class","slatebirdsEye"),e.be.style.position="absolute",e.be.style.height=`${e.options.size}px`,e.be.style.width=`${e.options.size}px`,e.be.style.border="2px inset #333",e.be.style.backgroundColor="#fff",o.appendChild(e.be),e.setBe(),e.corner=new tt({container:`slatebirdsEye_${e.slate.options.id}`,viewPort:{allowDrag:!1},collaboration:{allow:!1},showZoom:!1,showUndoRedo:!1,showMultiSelect:!1,showbirdsEye:!1,showLocks:!1,imageFolder:"",isbirdsEye:!0},{onNodeDragged(){e.slate.nodes.copyNodePositions(e.corner.nodes.allNodes)}}).init(),e.refresh(),u.addEvent(window,"resize",(()=>{const t=e.slate.options.container;e.parentDimen=u.getDimensions(t),e.setBe()}))}enabled(){return null!==this.corner}enable(){this.corner||this.show(),this.be.style.display="block"}disable(){this.be.style.display="none"}relationshipsChanged(t){if(this.corner)switch(t.type){case"removeRelationship":this.corner.nodes.removeRelationship(t.data);break;case"addRelationship":var e=JSON.parse(JSON.stringify(t));Object.assign(e.data,{options:{lineWidth:1}}),this.corner.nodes.addRelationship(e.data)}}nodeChanged(t){if(this.corner)if("onNodesMove"===t.type)this.corner.nodes.moveNodes(t,{useMainCanvas:!0});else{const e=this.corner.nodes.one(t.data.id);if(e){const s=!0;switch(t.type){case"onNodeShapeChanged":e.shapes.set(t.data);break;case"onNodeTextChanged":e.editor.set(t.data.text,t.data.fontSize,t.data.fontFamily,t.data.fontColor,t.data.textXAlign,t.data.textYAlign);break;case"onNodeColorChanged":e.colorPicker.set(t.data);break;case"onNodeImageChanged":e.images.set(t.data.img,t.data.w,t.data.h,s),this.refresh();break;case"onNodeResized":Object.assign(e.options,t.data),e.vect.attr({path:t.data.vectorPath}),e.vect.pattern&&e.images.imageSizeCorrection(),this.refresh();break;case"onNodeRotated":t.data.associations.forEach((t=>{const o=e.relationships.associations.find((e=>e.child.options.id===t.childId&&e.parent.options.id===t.parentId));o&&o.line.attr({path:t.linePath})})),Object.assign(e.options,o(t.data,"associations"));this.slate.paper.path(e.vect.attr("path")).remove(),e.rotate.applyImageRotation(),this.refresh();break;case"onNodeToFront":e.vect.toFront();break;case"onNodeToBack":e.vect.toBack();break;case"onNodeLocked":e.options.allowDrag=!1;break;case"onNodeUnlocked":e.options.allowDrag=!0;break;case"changeLineColor":e.lineOptions.set(t.data)}}}}nodeDeleted(t){if(this.corner){this.corner.nodes.one(t.data.id).del()}}nodeDetatched(t){if(this.corner){this.corner.nodes.one(t.data.id).relationships.detatch()}}reload(t){this.handle?.remove(),this.corner.loadJSON(t),this.refresh(!0)}refresh(t){if(this.corner){const e=this.slate.options.container;if(this.parentDimen=u.getDimensions(e),this.handle?.remove(),!0===t){this.corner.canvas.move({x:this.slate.options.viewPort.left,y:this.slate.options.viewPort.top,dur:0,isAbsolute:!0});const t=!0;this.corner.nodes.copyNodePositions(this.slate.nodes.allNodes,t)}else{const t=this.slate.exportDifference(this.corner,1);this.corner.loadJSON(t,!0,!0,!0,!0)}this.orx=this.slate.getOrientation(),this.slate.options.viewPort.left<this.orx.left?this.wpadding=this.slate.options.viewPort.left-this.orx.left:this.wpadding=this.slate.options.viewPort.left-this.orx.left+(this.parentDimen.width-this.orx.width),this.hpadding=this.slate.options.viewPort.top-this.orx.top;const o=Math.max(Math.abs(this.wpadding),this.orx.width<this.parentDimen.width?this.parentDimen.width-this.orx.width:0),s=Math.max(Math.abs(this.hpadding),this.orx.height<this.parentDimen.height?this.parentDimen.height-this.orx.height:0),i=(this.orx.width+o)/this.options.size*this.slate.options.viewPort.width,n=(this.orx.height+s)/this.options.size*this.slate.options.viewPort.height;this.sp=Math.max(i,n);const a=Math.max(this.slate.options.viewPort.width,this.slate.options.viewPort.height)/this.sp,r=(this.orx.left+(this.wpadding<0?this.wpadding:0))*a-5,l=(this.orx.top+(this.hpadding<0?this.hpadding:0))*a-5;this.corner.zoom(0,0,this.sp,this.sp,!0),this.corner.options.viewPort.zoom.r=this.corner.options.viewPort.originalWidth/this.sp,this.corner.canvas.move({x:r,y:l,dur:0,isAbsolute:!0}),this.corner.disable();const d=this.slate.options.viewPort.left/this.slate.options.viewPort.zoom.r,c=this.slate.options.viewPort.top/this.slate.options.viewPort.zoom.r,h=this.parentDimen.width/this.slate.options.viewPort.zoom.r,p=this.parentDimen.height/this.slate.options.viewPort.zoom.r;this.handle=this.corner.paper.rect(d,c,h,p).attr({stroke:"#000","stroke-width":2,fill:"#FFEB3A","fill-opacity":".5"}),this._hideText(),this._wireHandle()}}}class V{constructor(t){this.slate=t,this.scale=1,this.wheelEnd=null,this.xyOffset=null,t.options.viewPort.useInertiaScrolling&&this._init()}setScale(t){this.scale=t}_init(){const t=this,e=d({momentum:!0});e.observe(t.slate.canvas.internal);let o={};e.on("wheel",(e=>{if(t.slate.options.allowDrag)if(e.event.ctrlKey);else{const s=.8*e.event.deltaX,i=.8*e.event.deltaY;if(e.isStart&&(o=u.positionedOffset(t.slate.canvas.internal),t.slate.toggleFilters(!0)),t.slate.canvas.move({x:s,y:i,dur:0,isAbsolute:!1}),e.isEnding){const e=u.positionedOffset(t.slate.canvas.internal);t.slate.birdsEye?.refresh(!0),t.slate.canvas.broadcast({x:o.left-e.left,y:o.top-e.top}),t.slate.toggleFilters(!1)}}}))}}class q{constructor(t){this.slate=t}static perform(t,e,o,s){const i=o.split("@");let n=t.defaultDuration||300;const a=i[1];switch(i[0]){case"zoom":n=i.length>2?parseFloat(i[2],10):t.defaultDuration,e.zoom(a,n,s);break;case"position":{const o=i.length>2?i[2]:t.defaultEasing;n=i.length>3?parseFloat(i[3],10):t.defaultDuration,e.position(a,s,o,n);break}}}scaleToFitNodes(t){const e={nodes:null,dur:0,cb:null};Object.assign(e,t);const o=this.slate.getOrientation(e.nodes),s=u.getDimensions(this.slate.options.container),i=this.slate.options.viewPort.zoom.r||1,n=parseInt(s.width/(o.width/i)*100,10),a=parseInt(s.height/(o.height/i)*100,10);this.slate.canvas.zoom({dur:e.dur,callbacks:{after(){e.cb&&e.cb()}},easing:"easeFromTo",zoomPercent:Math.min(n,a)})}centerOnNodes(t){const e=this,o={nodes:null,dur:500,cb:null};Object.assign(o,t);const s=e.slate.getOrientation(o.nodes),i=u.getDimensions(e.slate.options.container),n=i.width,a=i.height,r=s.width,l=s.height,d=s.left-(n/2-r/2),c=s.top-(a/2-l/2);e.slate.canvas.move({x:d,y:c,isAbsolute:!0,dur:o.dur,easing:"swingFromTo",callbacks:{after(){setTimeout((()=>{e.slate.birdseye?.refresh(!0)}),100),o.cb&&o.cb()}}})}center(t){const e=this,o={previousWindowSize:{},dur:500,cb:null};Object.assign(o,t);const s=u.windowSize();return this.slate.canvas.move({x:(s.width-o.previousWindowSize.w)/2*-1,y:(s.height-o.previousWindowSize.h)/2*-1,duration:o.dur,isAbsolute:!1,easing:"swingFromTo",callbacks:{after:()=>{e.slate.birdseye?.refresh(!0),o.cb&&o.cb()}}}),s}bop(t){const e=t&&t.dur&&0!==t.dur?t.dur:300,o=_.map(this.slate.nodes.allNodes,(t=>({name:t.options.name,operations:[`position@center@easeTo@${e}`]})));this.slate.controller.present({nodes:o,nodeChanged:t=>{},opChanged:t=>{},complete:()=>{},sync:{zoom:!0,position:!0}})}shakeNodes(){const t=this;let e=0;!function o(){e+=1;const s={dur:500,moves:[{id:"*",x:e%2==0?20:-20,y:-20}]},i=t.slate.nodes.nodeMovePackage(s);t.slate.nodes.moveNodes(i,{animate:!0,cb:()=>{setTimeout((()=>{o()}),4e3)}})}()}pulse(t){let e,o,s=0,i=1e4;function n(){if(e=100*this.slate.options.viewPort.zoom.r,o={in:e+5,out:e-5},t){if("fast"===t.speed)i=3e3;if("trump"===t.subtlety)o={in:e+60,out:e-60}}}function a(t,e){this.slate.canvas.zoom({dur:i,callbacks:{after(){e&&e()}},easing:"easeFromTo",zoomPercent:t})}function r(){a(o.in,(()=>{a(o.out,(()=>{s+=1,t&&t.cycle&&s>=t.cycle?t.cb&&t.cb():r()}))}))}t&&t.center?this.scaleToFitAndCenter((()=>{n(),r()})):(n(),r())}scaleToFitAndCenter(t,e){this.slate.controller.scaleToFitNodes({dur:null!=e?e:0,cb:()=>{this.centerOnNodes({dur:0}),t&&t()}})}present(t){let e=[],o=null;!function s(){if(0===e.length&&t.nodes.length>0){const s=t.nodes.shift();o=this.slate.nodes.allNodes.find((t=>t.options.name===s.name)),e=s.operations,t.nodeChanged&&t.nodeChanged(s)}if(e.length>0){const i=e.shift();t.opChanged&&t.opChanged(i),q.perform(t,o,i,(e=>{const o=void 0!==t.sync&&t.sync[e.operation];switch(e.operation){case"zoom":o&&this.slate.collab?.send({type:"onZoom",data:{id:e.id,zoomLevel:e.zoomLevel}});break;case"position":o&&this.slate.collab?.send({type:"onNodePositioned",data:{id:e.id,location:e.location,easing:e.easing}})}s()}))}else t.complete&&t.complete()}()}}class Y{constructor(t){const e=this;e.slate=t,e.slider=null,e.sliderId=`sb-zoom-slider-${u.guid().substring(8)}`}setValue(t){this.slider&&this.slider.setValue(t)}hide(){}show(t){const e=this;if(console.log("showing zoom",e.slate.isReadOnly(),e.slate.isCommentOnly()),!e.slate.isReadOnly()&&!e.slate.isCommentOnly()){e.hide();const o={height:320,width:28,offset:{left:39,top:85},slider:{height:300,min:6e3,max:2e5,set:5e3}};Object.assign(o,t);const s=e.slate.options.container,i=document.createElement("div");i.setAttribute("id",`slateSlider_${e.slate.options.id}`),i.style.position="absolute",i.style.height=`${o.height}px`,i.style.width=`${o.width}px`,i.style.left=`${o.offset.left}px`,i.style.top=`${o.offset.top}px`,i.style.borderRadius="7px",i.style.border="1px solid #ccc",i.style.backgroundColor="#fff",s.appendChild(i),e.slider=document.createElement("input"),e.slider.setAttribute("orient","vertical"),e.slider.setAttribute("type","range"),e.slider.setAttribute("min","6000"),e.slider.setAttribute("step","50"),e.slider.setAttribute("max","200000"),e.slider.setAttribute("value",e.slate.options.viewPort.zoom.w||5e4),e.slider.setAttribute("id",e.sliderId),e.slider.style["writing-mode"]="bt-lr",e.slider.style["-webkit-appearance"]="slider-vertical",e.slider.style.width="20px",e.slider.style.height=o.height-5+"px",e.slider.style.padding="0 5px",e.slider.style.transform="rotate(180deg)",e.slider.addEventListener("input",(t=>{const o=parseFloat(t.target.value);e.set(o),e.slate.birdsEye?.refresh(!0)})),e.slider.addEventListener("change",(t=>{const o=parseFloat(t.target.value);e.set(o),e.slate.collab?.send({type:"onZoom",data:{zoomLevel:o}})})),i.appendChild(e.slider)}}set(t){const e=this;if(e.slider&&(e.slider.value=t),e.slate.canvas.resize(t)||!e.slate.canvas.completeInit){e.slate.zoom(0,0,t,t,!1);const o=e.slate.options.viewPort.zoom;e.slate.options.viewPort.width=o.w,e.slate.options.viewPort.height=o.h,e.slate.options.viewPort.left=o.l,e.slate.options.viewPort.top=o.t}}}class X{constructor(t){this.slate=t,this.stateSlate=null,this.actions=[],this.actionIndex=-1,this.toolbar=[]}setVisibility(){const t=this;t.toolbar[0].data({disabled:!1}),t.toolbar[1].data({disabled:!1}),this.actions[this.actionIndex-1]?t.toolbar[0].attr({"fill-opacity":"1.0"}):(t.toolbar[0].attr({"fill-opacity":"0.3"}),t.toolbar[0].data({disabled:!0})),this.actions[this.actionIndex+1]?t.toolbar[1].attr({"fill-opacity":"1.0"}):(t.toolbar[1].attr({"fill-opacity":"0.3"}),t.toolbar[1].data({disabled:!0}))}run(){const t=this.actions[this.actionIndex];this.slate.loadJSON(t),this.slate.birdsEye?.reload(t);this.slate.collaboration?.onCollaboration({type:"custom",slate:this.slate,pkg:{type:"onSaveRequested"}})}undo(){this.actions[this.actionIndex-1]?(this.actionIndex-=1,this.setVisibility(),this.run()):this.setVisibility()}redo(){this.actions[this.actionIndex+1]?(this.actionIndex+=1,this.setVisibility(),this.run()):this.setVisibility()}hide(){if(null!==u.el("slateUndoRedo"))try{this.slate.options.container.removeChild(u.el("slateUndoRedo"))}catch(t){}}show(t){const e=this;e.hide();const o={height:80,width:130,offset:{left:10,top:8}};Object.assign(o,t);const s=e.slate.options.container,i=document.createElement("div");i.setAttribute("id","slateUndoRedo"),i.style.position="absolute",i.style.height=`${o.height}px`,i.style.width=`${o.width}px`,i.style.left=`${o.offset.left}px`,i.style.top=`${o.offset.top}px`,s.appendChild(i);const n=o.offset.left,a=o.offset.top+30;o.paper=p("slateUndoRedo",o.width,o.height),e.toolbar=[o.paper.undo().data({msg:"Undo",width:50,height:22}).attr({fill:"#fff",cursor:"pointer"}).attr({fill:"#333",stroke:"#fff"}).transform(["t",n,",",a,"s","1.5","1.5"].join()),o.paper.redo().data({msg:"Redo",width:50,height:22}).attr({fill:"#fff",cursor:"pointer"}).attr({fill:"#333",stroke:"#fff"}).transform(["t",n+50,",",a,"s","-1.5","1.5"].join())],e.toolbar.forEach((t=>{t.mouseover((function(t){if(u.stopEvent(t),e.slate.multiSelection?.hide(),!this.data("disabled")){e.slate.glow(this);const t=this.data("msg");e.slate.addtip(this.tooltip({type:"text",msg:t},this.data("width"),this.data("height")))}})),t.mouseout((function(t){u.stopEvent(t),e.slate.multiSelection?.show(),e.slate.unglow(),this.untooltip()}))})),e.toolbar[0].mousedown((function(t){u.stopEvent(t),e.slate.unglow(),this.data("disabled")||e.undo()})),e.toolbar[1].mousedown((function(t){u.stopEvent(t),e.slate.unglow(),this.data("disabled")||e.redo()})),e.setVisibility(),setTimeout((()=>{e.snap(!0)}),500)}snap(t){const e=this;e.actionIndex+=1,e.actionIndex!==e.actions.length&&e.actions.splice(e.actionIndex);const o=e.slate.exportJSON();e.actions.push(o),clearTimeout(e.saveSnapshot),e.saveSnapshot=setTimeout((async()=>{e.slate.events.onTakeSnapshot&&await e.slate.events.onTakeSnapshot({slateId:e.slate.options.id,snapshot:o})}),3e3),t||e.setVisibility()}}class J{constructor(t){this.slate=t,this._grid=null,this.slate.options.viewPort.showGrid&&this.show()}setGrid(){const t=this.slate.options.containerStyle.backgroundColor,e=u.whiteOrBlack(t);this.slate.options.viewPort.gridSize||(this.slate.options.viewPort.gridSize=50);const{gridSize:o}=this.slate.options.viewPort;this.slate.paper.def({tag:"pattern",id:"sbSmallGrid",height:o,width:o,patternUnits:"userSpaceOnUse",inside:[{type:"path",attrs:{d:`M ${o} 0 L 0 0 0 ${o}`,fill:"none",stroke:e,"stroke-width":"0.5"}}]}),this.slate.paper.def({tag:"pattern",id:"sbGrid",height:10*o,width:10*o,patternUnits:"userSpaceOnUse",inside:[{type:"rect",attrs:{width:10*o,height:10*o,fill:"url(#sbSmallGrid)"}},{type:"path",attrs:{d:`M ${10*o} 0 L 0 0 0 ${10*o}`,fill:"none",stroke:e,"stroke-width":"0.5"}}]})}show(){const t=this;this.setGrid(),t._grid=t.slate.paper.rect(0,0,t.slate.options.viewPort.width,t.slate.options.viewPort.height).attr({fill:"url(#sbGrid)"}).toBack(),t.slate.canvas.bgToBack()}toBack(){this._grid?.toBack()}destroy(){this._grid?.remove()}}class Z{constructor(t){this.slate=t,this.engaged=!1}engage(){const t=this;if(!t.engaged){const e="M 14.4761 0 H 3.102 C 1.3888 0 0 1.3888 0 3.102 V 8.5307 c 0 1.7132 1.3888 3.102 3.102 3.102 H 9.8297 l 2.803 4.2412 l 0.9018 -4.2412 h 0.9418 c 1.7132 0 3.102 -1.3888 3.102 -3.102 V 3.102 C 17.5781 1.3888 16.1893 0 14.4761 0 z";t.slate.canvas.internal.querySelector("svg").addEventListener("mousedown",(o=>{const s=u.mousePos(o),i=s.x+t.slate.options.viewPort.left,n=s.y+t.slate.options.viewPort.top,a=u._transformPath(e,`T${i},${n}s2,2`),r=u.getBBox({path:a}),l={text:"",xPos:i,yPos:n,height:r.height,width:r.width,vectorPath:a,allowMenu:!1,allowDrag:!0,opacity:1,borderOpacity:1,textOpacity:1},d=new C(l);t.slate.nodes.add(d)})),t.engaged=!0}}}class K{constructor(t){const e=this;e.slate=t,e.bindGlobalUp=e.keyUp.bind(e),e.bindGlobalDown=e.keyDown.bind(e),e.bindGlobal()}bindGlobal(){u.addEvent(document,"keydown",this.bindGlobalDown),u.addEvent(document,"keyup",this.bindGlobalUp)}unbindGlobal(){u.removeEvent(document,"keydown",this.bindGlobalDown),u.removeEvent(document,"keyup",this.bindGlobalUp)}key(t,e){const o=this,s=o.slate.nodes.allNodes.find((t=>t.menu.isOpen())),i=u.getKey(t);switch(i){case 91:case 17:o.slate.isCtrl=e;break;case 16:o.slate.isShift=e;break;case 18:o.slate.isAlt=e}if(s)switch(i){case 37:case 38:case 39:case 40:if(e){let e=2;o.slate.options.viewPort.zoom.r>=1?e=1:o.slate.options.viewPort.zoom.r<=.5&&(e=5),s.relationships._initDrag(o,t),37===i?s.relationships.enactMove(-e,0,!0):38===i?s.relationships.enactMove(0,-e,!0):39===i?o.slate.isCtrl?s.connectors.addNode(!0):s.relationships.enactMove(e,0,!0):40===i&&s.relationships.enactMove(0,e,!0),s.relationships.showMenu()}else s.relationships.finishDrag(!0)}}keyUp(t){this.key(t,!1)}keyDown(t){this.key(t,!0)}}class Q{constructor(t){this.slate=t,this.exposeDefaults()}addDeps(t){const e=this;t.forEach((t=>{const o={id:u.guid().substring(10),tag:t.type,...t.attrs,inside:[]};t.nested.forEach((t=>{o.inside.push({type:t.type,attrs:t.attrs})})),e.slate.paper.def(o)}))}add(t,e){const o=this,s={id:t.id||u.guid().substring(10),tag:"filter",filterUnits:"userSpaceOnUse",...t.attrs,inside:[]};return t.filters.forEach((t=>{t.nested?s.inside.push({type:t.type,nested:t.nested}):s.inside.push({type:t.type,attrs:t.attrs})})),o.slate.paper.def(s),e||(o.slate.customFilters||(o.slate.customFilters=[]),o.slate.customFilters.push(s)),t.id}remove(t){return this.slate?.filters.splice(this.slate?.filters.findIndex((e=>e.id===t))),!0}exposeDefaults(){this.availableFilters={dropShadow:{levers:{feDropShadow:{stdDeviation:{label:"distance",default:1.5,range:[1,10]},dx:{label:"x-displacement",default:5,range:[1,50]},dy:{label:"y-displacement",default:5,range:[1,50]}}},types:["vect","line","image","text"],filters:[{type:"feGaussianBlur",attrs:{stdDeviation:"3",in:"SourceAlpha"}},{type:"feOffset",attrs:{dx:"5",dy:"5",result:"offsetblur"}},{type:"feComponentTransfer",nested:[{type:"feFuncA",attrs:{type:"linear",slope:"0.8"}}]},{type:"feMerge",nested:[{type:"feMergeNode",attrs:{}},{type:"feMergeNode",attrs:{in:"SourceGraphic"}}]}]},postItNote:{types:["vect","line","image","text"],filters:[{type:"feGaussianBlur",attrs:{stdDeviation:"2",in:"SourceAlpha"}},{type:"feOffset",attrs:{dx:"0",dy:"4",result:"offsetblur"}},{type:"feComponentTransfer",nested:[{type:"feFuncA",attrs:{type:"linear",slope:"0.5"}}]},{type:"feMerge",nested:[{type:"feMergeNode",attrs:{}},{type:"feMergeNode",attrs:{in:"SourceGraphic"}}]}]},tattered:{levers:{feDisplacementMap:{scale:{label:"torn",default:"10",range:[2,50]}}},types:["vect","line","image","text"],filters:[{type:"feTurbulence",attrs:{type:"turbulence",baseFrequency:".05 .05",numOctaves:"05",seed:"2",stitchTiles:"noStitch",result:"turbulence"}},{type:"feDisplacementMap",attrs:{in:"SourceGraphic",in2:"turbulence",scale:"10",xChannelSelector:"R",yChannelSelector:"B",result:"displacementMap"}}]},blur:{levers:{feGaussianBlur:{stdDeviation:{label:"displacement",default:2,range:[1,10]}}},types:["vect","line","image","text"],filters:[{type:"feGaussianBlur",attrs:{stdDeviation:"2",in:"SourceGraphic",edgeMode:"none"}}]},outline:{levers:{feMorphology:{radius:{label:"cutout",default:"1",range:[1,10]}}},types:["text","line"],filters:[{type:"feMorphology",attrs:{operator:"dilate",radius:"1",in:"SourceGraphic",result:"thickness"}},{type:"feComposite",attrs:{operator:"out",in:"thickness",in2:"SourceGraphic"}}]},pixelate:{levers:{feImage:{width:{label:"width",default:"8",range:[1,30]},height:{label:"height",default:"8",range:[1,30]}}},types:["image"],filters:[{type:"feGaussianBlur",attrs:{stdDeviation:"2",in:"SourceGraphic",result:"smoothed"}},{type:"feImage",attrs:{width:"8",height:"8","xlink:href":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAIAAAACDbGyAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAWSURBVAgdY1ywgOEDAwKxgJhIgFQ+AP/vCNK2s+8LAAAAAElFTkSuQmCC",result:"displacement-map"}},{type:"feTile",attrs:{in:"displacement-map",result:"pixelate-map"}},{type:"feDisplacementMap",attrs:{in:"smoothed",in2:"pixelate-map",xChannelSelector:"R",yChannelSelector:"G",scale:"30",result:"pre-final"}},{type:"feComposite",attrs:{operator:"in",in2:"SourceGraphic"}}]},posterize:{levers:{},types:["image"],filters:[{type:"feComponentTransfer",nested:{feFuncR:{type:"discrete",tableValues:".25 .4 .5 .75 1"},feFuncG:{type:"discrete",tableValues:".25 .4 .5 .75 1"},feFuncB:{type:"discrete",tableValues:".25 .4 .5 .75 1"}}}]},pencil:{levers:{},types:["vect","line","text","image"],filters:[{type:"feTurbulence",attrs:{type:"fractalNoise",baseFrequency:"0.03",numOctaves:"3",seed:"1",result:"f1"}},{type:"feDisplacementMap",attrs:{xChannelSelector:"R",yChannelSelector:"G",scale:"5",in:"SourceGraphic",in2:"f1",result:"f4"}},{type:"feTurbulence",attrs:{type:"fractalNoise",baseFrequency:"0.03",numOctaves:"3",seed:"10",result:"f2"}},{type:"feDisplacementMap",attrs:{xChannelSelector:"R",yChannelSelector:"G",scale:"5",in:"SourceGraphic",in2:"f2",result:"f5"}},{type:"feTurbulence",attrs:{type:"fractalNoise",baseFrequency:"1.2",numOctaves:"2",seed:"100",result:"f3"}},{type:"feDisplacementMap",attrs:{xChannelSelector:"R",yChannelSelector:"G",scale:"3",in:"SourceGraphic",in2:"f3",result:"f6"}},{type:"feBlend",attrs:{mode:"multiply",in2:"f4",in:"f5",result:"out1"}},{type:"feBlend",attrs:{mode:"multiply",in:"out1",in2:"f6",result:"out2"}}]}}}}class tt extends k{constructor(t,o,s){super(t),this.options={id:t.id||u.guid(),container:"",instance:"",name:"",description:"",basedOnThemeId:"",syncWithTheme:!1,containerStyle:{backgroundColor:"transparent",backgroundImage:"",backgroundSize:"",backgroundEffect:"",backgroundColorAsGradient:null,backgroundGradientType:null,backgroundGradientColors:[],backgroundGradientStrategy:null},viewPort:{useInertiaScrolling:!0,showGrid:!1,snapToObjects:!0,gridSize:50,width:5e4,height:5e4,left:5e3,top:5e3},enabled:!0,allowDrag:!0,showbirdsEye:!0,sizeOfbirdsEye:200,showMultiSelect:!0,showZoom:!0,showUndoRedo:!0,showStatus:!0,showLocks:!0,mindMapMode:!0,isPublic:!0,isUnlisted:!1,autoEnableDefaultFilters:!0,autoResizeNodesBasedOnText:!1,followMe:!1,huddleType:"disabled"},this.options=e(this.options,t),this.events=o||{onNodeDragged:null,onCanvasClicked:null,onImagesRequested:null,onRequestSave:null,isReadOnly:null},this.collaboration=s||{allow:!0,localizedOnly:!1,userIdOverride:null,onCollaboration:null},u.isElement(this.options.container)||(this.options.container=u.el(this.options.container)),this.constants={statusPanelAtRest:33,statusPanelExpanded:200},this.glows=[],this.tips=[],this.tempNodeId=u.guid(),this.allLines=[]}init(){const t=this;return t.nodes=new H(t),t.collab=new P(t),t.birdsEye=new U(t),t.zoomSlider=new Y(t),t.isReadOnly()||t.isCommentOnly()||(t.undoRedo=new X(t),t.multiSelection=new G(t)),t.controller=new q(t),t.filters=new Q(t),t.canvas=new v(t),t.canvas.init(),t.multiSelection&&t.multiSelection.init(),t.inertia=new V(t),t.grid=new J(t),t.comments=new Z(t),t.keyboard=new K(t),t.autoLoadFilters(),t.options.onInitCompleted&&t.options.onInitCompleted.apply(t),t}url(t){return this.options.ajax.rootUrl+this.options.ajax.urlFlavor+t}glow(t){this.glows.push(t.glow())}unglow(){this.glows.forEach((t=>{t.remove()})),this.glows=[]}addtip(t){t&&this.tips.push(t)}untooltip(){this.tips.forEach((t=>{t&&t.remove()}))}toggleFilters(t,e,o){this.nodes.allNodes.length>20&&(this.nodes.allNodes.forEach((o=>{e&&o.options.id!==e||o.toggleFilters(t)})),this.allLines.filter((t=>t.lineEffect)).forEach((e=>{t?e.line.attr("filter",""):e.line.attr("filter",`url(#${e.lineEffect})`)})),t&&this.canvas.hideBg(),o&&setTimeout((()=>{this.toggleFilters(!t),this.canvas.hideBg(1)}),500))}removeContextMenus(){u.select("div.sb_cm").forEach((t=>{document.body.removeChild(t)}))}remove(){this.nodes.allNodes.forEach((t=>{t.del()})),this.paper.remove()}zoom(t,e,o,s,i){this.nodes.closeAllLineOptions(),this.paper.setViewBox(t,e,o,s,i)}png(t,e){const o=this;o.svg({useDataImageUrls:!0,backgroundOnly:t?.backgroundOnly},(s=>{if(o.events.onCreateImage)o.events.onCreateImage({svg:s.svg,orient:s.orient,type:"png"},((s,i)=>{if(s)console.error("Unable to create png server side",svg,s);else if(t?.base64)e(i);else{const t=new Image;t.src=i,t.onload=()=>{const s=document.createElement("canvas");s.width=t.naturalWidth,s.height=t.naturalHeight;const i=s.getContext("2d");i.imageSmoothingEnabled=!1,i.drawImage(t,0,0);const n=document.createElement("a");n.setAttribute("download",`${(o.options.name||"slate").replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${o.options.id}.png`),s.toBlob((t=>{n.href=URL.createObjectURL(t);const o=new MouseEvent("click");n.dispatchEvent(o),e&&e()}))}}}));else{const i=document.createElement("canvas");i.width=s.orient.width,i.height=s.orient.height;const n=new Blob([s.svg],{type:"image/svg+xml;charset=utf8"}),a=URL.createObjectURL(n),r=i.getContext("2d"),l=document.createElement("img");l.src=a,l.onload=()=>{r.drawImage(l,0,0);const s=i.toDataURL("image/png");if(t?.base64)console.log("sending back dataurl",s),e(s),URL.revokeObjectURL(l.src);else{const t=document.createElement("a");t.download=`${(o.options.name||"slate").replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${o.options.id}.png`,t.href=s,t.click(),URL.revokeObjectURL(l.src),e&&e()}},l.onerror=t=>{console.log("error loading image",t)}}}))}copy(t){const e=this;e.copySlate||(e.copySlate=new tt({container:t.container,containerStyle:this.options.containerStyle,defaultLineColor:this.options.defaultLineColor,viewPort:this.options.viewPort,name:this.options.name,description:this.options.description,showbirdsEye:!1,showMultiSelect:!1,showUndoRedo:!1,showZoom:!1}).init());const o=JSON.parse(this.exportJSON());return o.nodes.forEach((e=>{const o=t.moves?t.moves.find((t=>t.id===e.options.id||"*"===t.id)):null;if(o){e.options.xPos+=o.x,e.options.yPos+=o.y;const t=[`t${o.x}, ${o.y}`];e.options.vectorPath=f(C.options.vectorPath,t)}})),e.copySlate.loadJSON(JSON.stringify(o)),e.copySlate.nodes.refreshAllRelationships(),e.copySlate}svg(t,o){const s=this,i=t?.nodes?s.nodes.allNodes.filter((e=>t?.nodes.indexOf(e.options.id)>-1)):null,n=s.getOrientation(i,!0),a=1,r=JSON.parse(s.exportJSON());t?.backgroundOnly&&(r.nodes=[]),r.nodes.forEach((t=>{const e=t.options.yPos*a,o=t.options.xPos*a,s=t.options.width,i=t.options.height;t.options.yPos=e-n.top,t.options.xPos=o-n.left,t.options.width=s*a,t.options.height=i*a,t.options.rotate&&t.options.rotate.point&&(t.options.rotate.point.x=t.options.rotate.point.x*a-n.left,t.options.rotate.point.y=t.options.rotate.point.y*a-n.top);const r=u._transformPath(t.options.vectorPath,["T",n.left/a*-1,",",n.top/a*-1,"s",",",a,",",a].join(""));t.options.vectorPath=r}));const l=document.createElement("div");l.setAttribute("id","tempSvgSlate"),l.style.width=`${n.width}px`,l.style.height=`${n.height}px`,l.style.visibility="hidden",document.body.appendChild(l);const d=e(r.options,{container:"tempSvgSlate",containerStyle:{backgroundColor:r.options.containerStyle.backgroundColor,backgroundColorAsGradient:r.options.containerStyle.backgroundColorAsGradient,backgroundGradientType:r.options.containerStyle.backgroundGradientType,backgroundGradientColors:r.options.containerStyle.backgroundGradientColors,backgroundGradientStrategy:r.options.containerStyle.backgroundGradientStrategy},defaultLineColor:r.options.defaultLineColor,viewPort:{allowDrag:!1,originalWidth:n.width,width:n.width,height:n.height,left:0,top:0,zoom:{w:1.5*n.width,h:1.5*n.height},showGrid:!1},name:r.options.name,description:r.options.description,showbirdsEye:!1,showMultiSelect:!1,showUndoRedo:!1,showZoom:!1,showLocks:!1,isEmbedding:!0}),c=new tt(d).init();c.loadJSON(JSON.stringify({options:d,nodes:r.nodes}),!1,!0),c.events=s.events,c.nodes.refreshAllRelationships();let h=null;if(r.options.containerStyle.backgroundImage){const t=document.createElement("img");t.setAttribute("src",r.options.containerStyle.backgroundImage),t.style.visibility="hidden",document.body.appendChild(t);let e=t.naturalWidth,o=t.naturalHeight;if("cover"===s.options.containerStyle.backgroundSize){const t=s.canvas.internal.parentElement.offsetWidth/e;e*=t,o*=t}t.remove();const i=Math.max(e,n.width),a=Math.max(o,n.height);h=c.paper.image(r.options.containerStyle.backgroundImage,0,0,i,a)}else h=c.paper.rect(0,0,n.width,n.height).attr({fill:r.options.containerStyle.backgroundColor,stroke:"none"});h.toBack(),setTimeout((async()=>{c.canvas.rawSVG((e=>{if(t)o&&o({svg:e,orient:n});else{const t=new Blob([e],{type:"image/svg+xml;charset=utf-8"}),i=URL.createObjectURL(t),n=document.createElement("a");n.href=i,n.download=`${(s.options.name||"slate").replace(/[^a-z0-9]/gi,"_").toLowerCase()}_${s?.shareId}.svg`,n.click(),o&&o()}l.remove()}))}),100)}autoLoadFilters(){const t=this;t.options.autoEnableDefaultFilters&&t.filters?.availableFilters&&Object.keys(t.filters.availableFilters).forEach((e=>{t.filters.add({id:e,filters:t.filters.availableFilters[e].filters},!0),t.filters.availableFilters[e].deps&&t.filters.addDeps(t.filters.availableFilters[e].deps)}))}loadJSON(t,e,o,s=!1){const i=this;void 0===e&&(i.paper&&i.paper.clear(),i.nodes&&(i.nodes.allNodes=[]));const n=JSON.parse(t);Object.assign(i.options,n.options),i.autoLoadFilters(),i.canvas?.refreshBackground(),i.options.viewPort.showGrid?i.grid?.show():i.grid?.destroy(),o||i.zoomSlider?.set(i.options.viewPort.zoom.w||5e4),n.nodes.sort(((t,e)=>{const o=n.options.nodeOrder?.findIndex((e=>e===t.options.id)),s=n.options.nodeOrder?.findIndex((t=>t===e.options.id));return o-s}));const a=[];n.nodes.forEach((t=>{t.options.allowDrag=!0,t.options.allowMenu=!0;const e=new C(t.options);i.nodes.add(e,s),a.push({bt:e,json:t})})),a.forEach((t=>{const e=t;e.bt.addRelationships(e.json)})),i.options.showLocks&&i.displayLocks(),i.nodes.allNodes.forEach((t=>{t.relationships.updateAssociationsWith({activeNode:t.options.id,currentDx:0,currentDy:0})})),i.nodes.refreshAllRelationships(),i.nodes.allNodes.forEach((t=>t.toFront())),i.paper.def({tag:"style",type:"text/css",id:`embeddedSBStyles_${i.options.id}`}),i.paper.def({tag:"path",id:"raphael-marker-classic","stroke-linecap":"round",d:"M5,0 0,2.5 5,5 3.5,3 3.5,2z"}),i.loadAllFonts(),o||i.controller.centerOnNodes({dur:0})}loadAllFonts(){const e=t(this.nodes.allNodes.map((t=>t.options.fontFamily))).join("|");if(document.getElementById("googleFonts"))document.getElementById("googleFonts").setAttribute("href",`https://fonts.googleapis.com/css?family=${e}`);else{const t=document.createElement("link");t.setAttribute("src","https://fonts.googleapis.com/css?family=${fonts}"),t.setAttribute("id","googleFonts"),t.setAttribute("rel","stylesheet"),t.setAttribute("type","text/css"),document.head.appendChild(t)}}displayLocks(){this.nodes.allNodes.forEach((t=>{t.initLock()}))}hideLocks(){this.nodes.allNodes.forEach((t=>{t.hideLock()}))}isReadOnly(){return!this.events.isReadOnly||this.events.isReadOnly&&this.events.isReadOnly()}isCommentOnly(){return!this.events.isCommentOnly||this.events.isCommentOnly&&this.events.isCommentOnly()}canRemoveComments(){return!this.events.canRemoveComments||this.events.canRemoveComments&&this.events.canRemoveComments()}exportDifference(t,e){const o={...this.options};delete o.container,o.showLocks=t.options.showLocks;const s={options:JSON.parse(JSON.stringify(o)),nodes:[]},i=this.tempNodeId;return this.nodes.allNodes.forEach((o=>{let n=!1;const a=o;a.options.id!==i&&(t.nodes.allNodes.forEach((t=>{t.options.id===a.options.id&&(n=!0)})),n||s.nodes.push(a.serialize(e)))})),JSON.stringify(s)}exportJSON(){const t=this.options.container,e=this.collaboration.panelContainer||null,o=this.collaboration.callbacks||null,s=this.options;delete s.container;const i={options:JSON.parse(JSON.stringify(s)),nodes:[]};this.options.container=t,this.collaboration.panelContainer=e,this.collaboration.callbacks=o,delete i.options.ajax,delete i.options.container;const n=this.tempNodeId;return this.nodes.allNodes.forEach((t=>{t.options.id!==n&&i.nodes.push(t.serialize())})),i.shareId=this.shareId,JSON.stringify(i)}snapshot(){const t=JSON.parse(this.exportJSON());return t.nodes.allNodes=t.nodes,t}getOrientation(t,e){let o="landscape",s=this.options.viewPort.width,i=this.options.viewPort.height;const n=[];n.left=99999,n.right=0,n.top=99999,n.bottom=0;const a=t||this.nodes.allNodes;if(a.length>0){for(let t=0;t<a.length;t+=1){const o=10,s=a[t].vect.getBBox(),i=e?1:this.options.viewPort.zoom.r||1,r=s.x*i,l=s.y*i,d=s.width*i,c=s.height*i;n.left=Math.abs(Math.min(n.left,r-o)),n.right=Math.abs(Math.max(n.right,r+d+o)),n.top=Math.abs(Math.min(n.top,l-o)),n.bottom=Math.abs(Math.max(n.bottom,l+c+o))}s=n.right-n.left,i=n.bottom-n.top,i>s&&(o="portrait")}return{orientation:o,height:i,width:s,left:n.left,top:n.top}}resize(t,e,o){let s=o||0;s<6&&(s=6),t-=2*s||0;const i=this.getOrientation(),n=i.width/t*this.options.viewPort.width,a=i.height/t*this.options.viewPort.height,r=Math.max(n,a),l=Math.max(this.options.viewPort.width,this.options.viewPort.height)/r,d=i.left*l-s,c=i.top*l-s;this.zoom(0,0,r,r,!0),this.options.viewPort.zoom={w:r,h:r,l:parseInt(-1*d,10),t:parseInt(-1*c,10),r:this.options.viewPort.originalWidth/r},this.canvas.move({x:d,y:c,dur:e,isAbsolute:!0})}disable(t,e,o){e||this.nodes.allNodes.forEach((t=>{t.disable()})),t||(this.options.enabled=!1,this.options.allowDrag=!1,o&&(this.multiSelection?.hideIcons(),this.undoRedo?.hide(),this.birdsEye?.disable(),this.zoomSlider?.hide()))}enable(t,e){e||this.nodes.allNodes.forEach((t=>{!t.options.isLocked&&t.enable()})),t||(this.options.enabled=!0,this.options.allowDrag=!0)}reorderNodes(){const t=Array.from(this.canvas.internal.querySelector("svg").querySelectorAll("path")).map((t=>t.getAttribute("rel"))).filter((t=>!!t));this.options.nodeOrder=t}findChildren(t,e=[]){const o=this.nodes.allNodes.filter((e=>t.includes(e.options.id)));e=e.concat(o.map((t=>t.options.id)));const s=[];return o.forEach((t=>{t.relationships.associations.filter((e=>e.parent.options.id===t.options.id)).forEach((t=>s.push(t.child.options.id)))})),s.length?this.findChildren(s,e):e}applyTheme(t,e,o){const s=this;o?(s.options.basedOnThemeId=null,s.options.syncWithTheme=null):(s.options.basedOnThemeId=t._id,s.options.syncWithTheme=e);const i={},n={},a=[];if(t.containerStyle.backgroundImage?s.collab.invoke({type:"onSlateBackgroundImageChanged",data:{bg:{size:t.containerStyle.backgroundSize,url:t.containerStyle.backgroundImage}}}):t.containerStyle.backgroundEffect?s.collab.invoke({type:"onSlateBackgroundEffectChanged",data:{effect:t.containerStyle.backgroundEffect}}):s.collab.invoke({type:"onSlateBackgroundColorChanged",data:{color:t.containerStyle.backgroundColor,asGradient:t.containerStyle.backgroundColorAsGradient,gradientType:t.containerStyle.backgroundGradientType,gradientColors:t.containerStyle.backgroundGradientColors,gradientStrategy:t.containerStyle.backgroundGradientStrategy}}),s.collab.invoke({type:"onLineColorChanged",data:{color:t.defaultLineColor}}),s.nodes.allNodes.forEach((t=>{if(s.options.mindMapMode||e){const e=s.findChildren([t.options.id]);a.push(e)}else n[t.options.backgroundColor]||(n[t.options.backgroundColor]=[]),n[t.options.backgroundColor].push(t.options.id)})),s.options.mindMapMode||e)a.sort(((t,e)=>t.length-e.length)),a.forEach((t=>{t.forEach(((t,e)=>{i[t]=0===e?"parent":`child_${e}`}))}));else{const e=Object.keys(n).sort(((t,e)=>n[e].length-n[t].length));let o=-1;e.forEach(((e,s)=>{Object.keys(t.styles).length<s&&(o=-1),o+=1,n[e].forEach((t=>{i[t]=0===o?"parent":`child_${o}`}))}))}Object.keys(i).forEach((o=>{!function(o){const n=Object.keys(t.styles),a=t.styles[n[n.length-1]],r=t.styles[i[o]]||a;s.collab.invoke({type:"onNodeBorderPropertiesChanged",data:{id:o,prop:"borderWidth",val:r.borderWidth}}),s.collab.invoke({type:"onNodeBorderPropertiesChanged",data:{id:o,prop:"borderColor",val:r.borderColor}}),s.collab.invoke({type:"onNodeBorderPropertiesChanged",data:{id:o,prop:"borderOpacity",val:r.borderOpacity}}),s.collab.invoke({type:"onNodeBorderPropertiesChanged",data:{id:o,prop:"borderStyle",val:r.borderStyle}}),r.vectorPath&&e&&s.collab.invoke({type:"onNodeShapeChanged",data:{id:o,shape:r.vectorPath}}),s.collab.invoke({type:"onNodeTextChanged",data:{id:o,fontSize:r.fontSize,fontFamily:r.fontFamily,fontColor:r.foregroundColor,textOpacity:r.textOpacity}}),s.collab.invoke({type:"onNodeEffectChanged",data:{id:o,filter:{apply:"text",id:r.filters.text}}}),s.collab.invoke({type:"onNodeColorChanged",data:{id:o,opacity:r.opacity,color:r.backgroundColor}}),s.collab.invoke({type:"onNodeEffectChanged",data:{id:o,filter:{apply:"vect",id:r.filters.vect}}}),s.nodes.one(o).relationships.associations.forEach(((t,e)=>{s.collab.invoke({type:"onLineColorChanged",data:{id:o,color:r.lineColor}}),s.collab.invoke({type:"onLinePropertiesChanged",data:{id:o,prop:"lineOpacity",val:r.lineOpacity,associationId:t.id,index:e}}),s.collab.invoke({type:"onLinePropertiesChanged",data:{id:o,prop:"lineEffect",val:r.lineEffect,associationId:t.id,index:e}}),s.collab.invoke({type:"onLinePropertiesChanged",data:{id:o,prop:"lineWidth",val:r.lineWidth,associationId:t.id,index:e}})}))}(o)}))}}const et={slate:tt,node:C,base:k,utils:u};export{et as Slatebox};
//# sourceMappingURL=index.js.map
